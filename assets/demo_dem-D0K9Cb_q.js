const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./raw-in9isEBO.js","./basedecoder-B2c5_Eok.js","./lzw-_aCqfs4w.js","./jpeg-vtRboCKw.js","./deflate-B9JhHpvg.js","./pako.esm-Cram60i4.js","./packbits-DDWKfGV_.js","./lerc-BAwR5Ujp.js","./_commonjsHelpers-CqkleIqs.js","./modulepreload-polyfill-B5Qt9EMX.js","./zstd-CoMYBbf0.js","./webimage-DBgUwIbt.js"])))=>i.map(i=>d[i]);
import"./modulepreload-polyfill-B5Qt9EMX.js";function re(r){return(e,...t)=>Wo(r,e,t)}function Mt(r,e){return re(li(r,e).get)}const{apply:Wo,getOwnPropertyDescriptor:li,getPrototypeOf:Vr,ownKeys:Yo}=Reflect,{iterator:un,toStringTag:Xo}=Symbol,Zo=Object,{create:Lr,defineProperty:Qo}=Zo,Jo=Array,ea=Jo.prototype,ci=ea[un],ta=re(ci),ui=ArrayBuffer,na=ui.prototype;Mt(na,"byteLength");const ws=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;ws&&Mt(ws.prototype,"byteLength");const hi=Vr(Uint8Array);hi.from;const ce=hi.prototype;ce[un];re(ce.keys);re(ce.values);re(ce.entries);re(ce.set);re(ce.reverse);re(ce.fill);re(ce.copyWithin);re(ce.sort);re(ce.slice);re(ce.subarray);Mt(ce,"buffer");Mt(ce,"byteOffset");Mt(ce,"length");Mt(ce,Xo);const ra=Uint8Array,pi=Uint16Array,Dr=Uint32Array,sa=Float32Array,tn=Vr([][un]()),di=re(tn.next),ia=re((function*(){})().next),oa=Vr(tn),aa=DataView.prototype,la=re(aa.getUint16),Mr=WeakMap,fi=Mr.prototype,mi=re(fi.get),ca=re(fi.set),vi=new Mr,ua=Lr(null,{next:{value:function(){const e=mi(vi,this);return di(e)}},[un]:{value:function(){return this}}});function ha(r){if(r[un]===ci&&tn.next===di)return r;const e=Lr(ua);return ca(vi,e,ta(r)),e}const pa=new Mr,da=Lr(oa,{next:{value:function(){const e=mi(pa,this);return ia(e)},writable:!0,configurable:!0}});for(const r of Yo(tn))r!=="next"&&Qo(da,r,li(tn,r));const gi=new ui(4),fa=new sa(gi),ma=new Dr(gi),Ae=new pi(512),Ve=new ra(512);for(let r=0;r<256;++r){const e=r-127;e<-24?(Ae[r]=0,Ae[r|256]=32768,Ve[r]=24,Ve[r|256]=24):e<-14?(Ae[r]=1024>>-e-14,Ae[r|256]=1024>>-e-14|32768,Ve[r]=-e-1,Ve[r|256]=-e-1):e<=15?(Ae[r]=e+15<<10,Ae[r|256]=e+15<<10|32768,Ve[r]=13,Ve[r|256]=13):e<128?(Ae[r]=31744,Ae[r|256]=64512,Ve[r]=24,Ve[r|256]=24):(Ae[r]=31744,Ae[r|256]=64512,Ve[r]=13,Ve[r|256]=13)}const Or=new Dr(2048);for(let r=1;r<1024;++r){let e=r<<13,t=0;for(;(e&8388608)===0;)e<<=1,t-=8388608;e&=-8388609,t+=947912704,Or[r]=e|t}for(let r=1024;r<2048;++r)Or[r]=939524096+(r-1024<<13);const Ot=new Dr(64);for(let r=1;r<31;++r)Ot[r]=r<<23;Ot[31]=1199570944;Ot[32]=2147483648;for(let r=33;r<63;++r)Ot[r]=2147483648+(r-32<<23);Ot[63]=3347054592;const bi=new pi(64);for(let r=1;r<64;++r)r!==32&&(bi[r]=1024);function va(r){const e=r>>10;return ma[0]=Or[bi[e]+(r&1023)]+Ot[e],fa[0]}function _i(r,e,...t){return va(la(r,e,...ha(t)))}function Jn(r,e,t){const n=typeof r=="object"?r.outer:r,s=n.slice(0,n.indexOf(">")+1),i=['"',"'"];for(let a=0;a<i.length;a++){const o=i[a],l=e+"\\="+o+"([^"+o+"]*)"+o,c=new RegExp(l).exec(s);if(c)return c[1]}}function ga(r,e,t){const s=new RegExp(e).exec(r.slice(t));return s?t+s.index:-1}function er(r,e,t){const s=new RegExp(e).exec(r.slice(t));return s?t+s.index+s[0].length-1:-1}function xs(r,e){const t=new RegExp(e,"g"),n=r.match(t);return n?n.length:0}function ba(r,e,t){const n=t&&t.debug||!1,s=!(t&&typeof t.nested===!1),i=t&&t.startIndex||0;n&&console.log("[xml-utils] starting findTagByName with",e," and ",t);const a=ga(r,`<${e}[ 
>/]`,i);if(n&&console.log("[xml-utils] start:",a),a===-1)return;const o=r.slice(a+e.length);let l=er(o,"^[^<]*[ /]>",0);const u=l!==-1&&o[l-1]==="/";if(n&&console.log("[xml-utils] selfClosing:",u),u===!1)if(s){let f=0,w=1,k=0;for(;(l=er(o,"[ /]"+e+">",f))!==-1;){const y=o.substring(f,l+1);if(w+=xs(y,"<"+e+`[ 
	>]`),k+=xs(y,"</"+e+">"),k>=w)break;f=l}}else l=er(o,"[ /]"+e+">",0);const c=a+e.length+l+1;if(n&&console.log("[xml-utils] end:",c),c===-1)return;const h=r.slice(a,c);let m;return u?m=null:m=h.slice(h.indexOf(">")+1,h.lastIndexOf("<")),{inner:m,outer:h,start:a,end:c}}function _a(r,e,t){const n=[];let i=0,a;for(;a=ba(r,e,{debug:!1,startIndex:i});)i=a.start+1+e.length,n.push(a);return n}const Qt={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34412:"CZ_LSMINFO",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},Le={};for(const r in Qt)Qt.hasOwnProperty(r)&&(Le[Qt[r]]=parseInt(r,10));const wa=[Le.BitsPerSample,Le.ExtraSamples,Le.SampleFormat,Le.StripByteCounts,Le.StripOffsets,Le.StripRowCounts,Le.TileByteCounts,Le.TileOffsets,Le.SubIFDs],tr={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},D={};for(const r in tr)tr.hasOwnProperty(r)&&(D[tr[r]]=parseInt(r,10));const me={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,CMYK:5,YCbCr:6,CIELab:8},xa={Unspecified:0},Ud={AddCompression:1},Nd={None:0,Deflate:1,Zstandard:2},ya={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function ka(r,e){const{width:t,height:n}=r,s=new Uint8Array(t*n*3);let i;for(let a=0,o=0;a<r.length;++a,o+=3)i=256-r[a]/e*256,s[o]=i,s[o+1]=i,s[o+2]=i;return s}function Ca(r,e){const{width:t,height:n}=r,s=new Uint8Array(t*n*3);let i;for(let a=0,o=0;a<r.length;++a,o+=3)i=r[a]/e*256,s[o]=i,s[o+1]=i,s[o+2]=i;return s}function Ea(r,e){const{width:t,height:n}=r,s=new Uint8Array(t*n*3),i=e.length/3,a=e.length/3*2;for(let o=0,l=0;o<r.length;++o,l+=3){const u=r[o];s[l]=e[u]/65536*256,s[l+1]=e[u+i]/65536*256,s[l+2]=e[u+a]/65536*256}return s}function Ia(r){const{width:e,height:t}=r,n=new Uint8Array(e*t*3);for(let s=0,i=0;s<r.length;s+=4,i+=3){const a=r[s],o=r[s+1],l=r[s+2],u=r[s+3];n[i]=255*((255-a)/256)*((255-u)/256),n[i+1]=255*((255-o)/256)*((255-u)/256),n[i+2]=255*((255-l)/256)*((255-u)/256)}return n}function Ta(r){const{width:e,height:t}=r,n=new Uint8ClampedArray(e*t*3);for(let s=0,i=0;s<r.length;s+=3,i+=3){const a=r[s],o=r[s+1],l=r[s+2];n[i]=a+1.402*(l-128),n[i+1]=a-.34414*(o-128)-.71414*(l-128),n[i+2]=a+1.772*(o-128)}return n}const Pa=.95047,Sa=1,Aa=1.08883;function Va(r){const{width:e,height:t}=r,n=new Uint8Array(e*t*3);for(let s=0,i=0;s<r.length;s+=3,i+=3){const a=r[s+0],o=r[s+1]<<24>>24,l=r[s+2]<<24>>24;let u=(a+16)/116,c=o/500+u,h=u-l/200,m,f,w;c=Pa*(c*c*c>.008856?c*c*c:(c-16/116)/7.787),u=Sa*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),h=Aa*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),m=c*3.2406+u*-1.5372+h*-.4986,f=c*-.9689+u*1.8758+h*.0415,w=c*.0557+u*-.204+h*1.057,m=m>.0031308?1.055*m**(1/2.4)-.055:12.92*m,f=f>.0031308?1.055*f**(1/2.4)-.055:12.92*f,w=w>.0031308?1.055*w**(1/2.4)-.055:12.92*w,n[i]=Math.max(0,Math.min(1,m))*255,n[i+1]=Math.max(0,Math.min(1,f))*255,n[i+2]=Math.max(0,Math.min(1,w))*255}return n}const La="modulepreload",Da=function(r,e){return new URL(r,e).href},ys={},at=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){let u=function(c){return Promise.all(c.map(h=>Promise.resolve(h).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};const a=document.getElementsByTagName("link"),o=document.querySelector("meta[property=csp-nonce]"),l=o?.nonce||o?.getAttribute("nonce");s=u(t.map(c=>{if(c=Da(c,n),c in ys)return;ys[c]=!0;const h=c.endsWith(".css"),m=h?'[rel="stylesheet"]':"";if(n)for(let w=a.length-1;w>=0;w--){const k=a[w];if(k.href===c&&(!h||k.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${m}`))return;const f=document.createElement("link");if(f.rel=h?"stylesheet":La,h||(f.as="script"),f.crossOrigin="",f.href=c,l&&f.setAttribute("nonce",l),document.head.appendChild(f),h)return new Promise((w,k)=>{f.addEventListener("load",w),f.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${c}`)))})}))}function i(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return s.then(a=>{for(const o of a||[])o.status==="rejected"&&i(o.reason);return e().catch(i)})},wi=new Map,Ma=new Map;function We(r,e,t=!0){Array.isArray(r)||(r=[r]),r.forEach(n=>{wi.set(n,e),Ma.set(n,t)})}async function Oa(r){const e=wi.get(r.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${r.Compression}`);const t=await e();return new t(r)}We([void 0,1],()=>at(()=>import("./raw-in9isEBO.js"),__vite__mapDeps([0,1]),import.meta.url).then(r=>r.default),!1);We(5,()=>at(()=>import("./lzw-_aCqfs4w.js"),__vite__mapDeps([2,1]),import.meta.url).then(r=>r.default));We(6,()=>{throw new Error("old style JPEG compression is not supported.")});We(7,()=>at(()=>import("./jpeg-vtRboCKw.js"),__vite__mapDeps([3,1]),import.meta.url).then(r=>r.default));We([8,32946],()=>at(()=>import("./deflate-B9JhHpvg.js"),__vite__mapDeps([4,5,1]),import.meta.url).then(r=>r.default));We(32773,()=>at(()=>import("./packbits-DDWKfGV_.js"),__vite__mapDeps([6,1]),import.meta.url).then(r=>r.default));We(34887,()=>at(()=>import("./lerc-BAwR5Ujp.js"),__vite__mapDeps([7,5,8,1,9]),import.meta.url).then(async r=>(await r.zstd.init(),r)).then(r=>r.default));We(5e4,()=>at(()=>import("./zstd-CoMYBbf0.js"),__vite__mapDeps([10,1]),import.meta.url).then(async r=>(await r.zstd.init(),r)).then(r=>r.default));We(50001,()=>at(()=>import("./webimage-DBgUwIbt.js"),__vite__mapDeps([11,1]),import.meta.url).then(r=>r.default),!1);function jn(r,e,t,n=1){return new(Object.getPrototypeOf(r)).constructor(e*t*n)}function Ba(r,e,t,n,s){const i=e/n,a=t/s;return r.map(o=>{const l=jn(o,n,s);for(let u=0;u<s;++u){const c=Math.min(Math.round(a*u),t-1);for(let h=0;h<n;++h){const m=Math.min(Math.round(i*h),e-1),f=o[c*e+m];l[u*n+h]=f}}return l})}function Pt(r,e,t){return(1-t)*r+t*e}function Ua(r,e,t,n,s){const i=e/n,a=t/s;return r.map(o=>{const l=jn(o,n,s);for(let u=0;u<s;++u){const c=a*u,h=Math.floor(c),m=Math.min(Math.ceil(c),t-1);for(let f=0;f<n;++f){const w=i*f,k=w%1,y=Math.floor(w),T=Math.min(Math.ceil(w),e-1),P=o[h*e+y],E=o[h*e+T],I=o[m*e+y],A=o[m*e+T],L=Pt(Pt(P,E,k),Pt(I,A,k),c%1);l[u*n+f]=L}}return l})}function Na(r,e,t,n,s,i="nearest"){switch(i.toLowerCase()){case"nearest":return Ba(r,e,t,n,s);case"bilinear":case"linear":return Ua(r,e,t,n,s);default:throw new Error(`Unsupported resampling method: '${i}'`)}}function Fa(r,e,t,n,s,i){const a=e/n,o=t/s,l=jn(r,n,s,i);for(let u=0;u<s;++u){const c=Math.min(Math.round(o*u),t-1);for(let h=0;h<n;++h){const m=Math.min(Math.round(a*h),e-1);for(let f=0;f<i;++f){const w=r[c*e*i+m*i+f];l[u*n*i+h*i+f]=w}}}return l}function $a(r,e,t,n,s,i){const a=e/n,o=t/s,l=jn(r,n,s,i);for(let u=0;u<s;++u){const c=o*u,h=Math.floor(c),m=Math.min(Math.ceil(c),t-1);for(let f=0;f<n;++f){const w=a*f,k=w%1,y=Math.floor(w),T=Math.min(Math.ceil(w),e-1);for(let P=0;P<i;++P){const E=r[h*e*i+y*i+P],I=r[h*e*i+T*i+P],A=r[m*e*i+y*i+P],L=r[m*e*i+T*i+P],K=Pt(Pt(E,I,k),Pt(A,L,k),c%1);l[u*n*i+f*i+P]=K}}}return l}function za(r,e,t,n,s,i,a="nearest"){switch(a.toLowerCase()){case"nearest":return Fa(r,e,t,n,s,i);case"bilinear":case"linear":return $a(r,e,t,n,s,i);default:throw new Error(`Unsupported resampling method: '${a}'`)}}function Ra(r,e,t){let n=0;for(let s=e;s<t;++s)n+=r[s];return n}function vr(r,e,t){switch(r){case 1:if(e<=8)return new Uint8Array(t);if(e<=16)return new Uint16Array(t);if(e<=32)return new Uint32Array(t);break;case 2:if(e===8)return new Int8Array(t);if(e===16)return new Int16Array(t);if(e===32)return new Int32Array(t);break;case 3:switch(e){case 16:case 32:return new Float32Array(t);case 64:return new Float64Array(t)}break}throw Error("Unsupported data format/bitsPerSample")}function Ga(r,e){return(r===1||r===2)&&e<=32&&e%8===0?!1:!(r===3&&(e===16||e===32||e===64))}function ja(r,e,t,n,s,i,a){const o=new DataView(r),l=t===2?a*i:a*i*n,u=t===2?1:n,c=vr(e,s,l),h=parseInt("1".repeat(s),2);if(e===1){let m;t===1?m=n*s:m=s;let f=i*m;(f&7)!==0&&(f=f+7&-8);for(let w=0;w<a;++w){const k=w*f;for(let y=0;y<i;++y){const T=k+y*u*s;for(let P=0;P<u;++P){const E=T+P*s,I=(w*i+y)*u+P,A=Math.floor(E/8),L=E%8;if(L+s<=8)c[I]=o.getUint8(A)>>8-s-L&h;else if(L+s<=16)c[I]=o.getUint16(A)>>16-s-L&h;else if(L+s<=24){const K=o.getUint16(A)<<8|o.getUint8(A+2);c[I]=K>>24-s-L&h}else c[I]=o.getUint32(A)>>32-s-L&h}}}}return c.buffer}class qa{constructor(e,t,n,s,i,a){this.fileDirectory=e,this.geoKeys=t,this.dataView=n,this.littleEndian=s,this.tiles=i?{}:null,this.isTiled=!e.StripOffsets;const o=e.PlanarConfiguration;if(this.planarConfiguration=typeof o>"u"?1:o,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=a}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let t=0;t<this.fileDirectory.BitsPerSample.length;++t)e+=this.getSampleByteSize(t);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,n=this.fileDirectory.BitsPerSample[e];switch(t){case 1:if(n<=8)return DataView.prototype.getUint8;if(n<=16)return DataView.prototype.getUint16;if(n<=32)return DataView.prototype.getUint32;break;case 2:if(n<=8)return DataView.prototype.getInt8;if(n<=16)return DataView.prototype.getInt16;if(n<=32)return DataView.prototype.getInt32;break;case 3:switch(n){case 16:return function(s,i){return _i(this,s,i)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,t){const n=this.getSampleFormat(e),s=this.getBitsPerSample(e);return vr(n,s,t)}async getTileOrStrip(e,t,n,s,i){const a=Math.ceil(this.getWidth()/this.getTileWidth()),o=Math.ceil(this.getHeight()/this.getTileHeight());let l;const{tiles:u}=this;this.planarConfiguration===1?l=t*a+e:this.planarConfiguration===2&&(l=n*a*o+t*a+e);let c,h;if(this.isTiled?(c=this.fileDirectory.TileOffsets[l],h=this.fileDirectory.TileByteCounts[l]):(c=this.fileDirectory.StripOffsets[l],h=this.fileDirectory.StripByteCounts[l]),h===0){const w=this.getBlockHeight(t)*this.getTileWidth(),k=this.planarConfiguration===2?this.getSampleByteSize(n):this.getBytesPerPixel(),y=new ArrayBuffer(w*k);return this.getArrayForSample(n,y).fill(this.getGDALNoData()||0),{x:e,y:t,sample:n,data:y}}const m=(await this.source.fetch([{offset:c,length:h}],i))[0];let f;return u===null||!u[l]?(f=(async()=>{let w=await s.decode(this.fileDirectory,m);const k=this.getSampleFormat(),y=this.getBitsPerSample();return Ga(k,y)&&(w=ja(w,k,this.planarConfiguration,this.getSamplesPerPixel(),y,this.getTileWidth(),this.getBlockHeight(t))),w})(),u!==null&&(u[l]=f)):f=u[l],{x:e,y:t,sample:n,data:await f}}async _readRaster(e,t,n,s,i,a,o,l,u){const c=this.getTileWidth(),h=this.getTileHeight(),m=this.getWidth(),f=this.getHeight(),w=Math.max(Math.floor(e[0]/c),0),k=Math.min(Math.ceil(e[2]/c),Math.ceil(m/c)),y=Math.max(Math.floor(e[1]/h),0),T=Math.min(Math.ceil(e[3]/h),Math.ceil(f/h)),P=e[2]-e[0];let E=this.getBytesPerPixel();const I=[],A=[];for(let z=0;z<t.length;++z)this.planarConfiguration===1?I.push(Ra(this.fileDirectory.BitsPerSample,0,t[z])/8):I.push(0),A.push(this.getReaderForSample(t[z]));const L=[],{littleEndian:K}=this;for(let z=y;z<T;++z)for(let ne=w;ne<k;++ne){let he;this.planarConfiguration===1&&(he=this.getTileOrStrip(ne,z,0,i,u));for(let R=0;R<t.length;++R){const Ce=R,pe=t[R];this.planarConfiguration===2&&(E=this.getSampleByteSize(pe),he=this.getTileOrStrip(ne,z,pe,i,u));const j=he.then(Ee=>{const xn=Ee.data,zt=new DataView(xn),_t=this.getBlockHeight(Ee.y),Xe=Ee.y*h,lt=Ee.x*c,yn=Xe+_t,Rt=(Ee.x+1)*c,Gt=A[Ce],Yn=Math.min(_t,_t-(yn-e[3]),f-Xe),Xn=Math.min(c,c-(Rt-e[2]),m-lt);for(let Ze=Math.max(0,e[1]-Xe);Ze<Yn;++Ze)for(let Ie=Math.max(0,e[0]-lt);Ie<Xn;++Ie){const kn=(Ze*c+Ie)*E,Zn=Gt.call(zt,kn+I[Ce],K);let ct;s?(ct=(Ze+Xe-e[1])*P*t.length+(Ie+lt-e[0])*t.length+Ce,n[ct]=Zn):(ct=(Ze+Xe-e[1])*P+Ie+lt-e[0],n[Ce][ct]=Zn)}});L.push(j)}}if(await Promise.all(L),a&&e[2]-e[0]!==a||o&&e[3]-e[1]!==o){let z;return s?z=za(n,e[2]-e[0],e[3]-e[1],a,o,t.length,l):z=Na(n,e[2]-e[0],e[3]-e[1],a,o,l),z.width=a,z.height=o,z}return n.width=a||e[2]-e[0],n.height=o||e[3]-e[1],n}async readRasters({window:e,samples:t=[],interleave:n,pool:s=null,width:i,height:a,resampleMethod:o,fillValue:l,signal:u}={}){const c=e||[0,0,this.getWidth(),this.getHeight()];if(c[0]>c[2]||c[1]>c[3])throw new Error("Invalid subsets");const h=c[2]-c[0],m=c[3]-c[1],f=h*m,w=this.getSamplesPerPixel();if(!t||!t.length)for(let P=0;P<w;++P)t.push(P);else for(let P=0;P<t.length;++P)if(t[P]>=w)return Promise.reject(new RangeError(`Invalid sample index '${t[P]}'.`));let k;if(n){const P=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,E=Math.max.apply(null,this.fileDirectory.BitsPerSample);k=vr(P,E,f*t.length),l&&k.fill(l)}else{k=[];for(let P=0;P<t.length;++P){const E=this.getArrayForSample(t[P],f);Array.isArray(l)&&P<l.length?E.fill(l[P]):l&&!Array.isArray(l)&&E.fill(l),k.push(E)}}const y=s||await Oa(this.fileDirectory);return await this._readRaster(c,t,k,n,y,i,a,o,u)}async readRGB({window:e,interleave:t=!0,pool:n=null,width:s,height:i,resampleMethod:a,enableAlpha:o=!1,signal:l}={}){const u=e||[0,0,this.getWidth(),this.getHeight()];if(u[0]>u[2]||u[1]>u[3])throw new Error("Invalid subsets");const c=this.fileDirectory.PhotometricInterpretation;if(c===me.RGB){let T=[0,1,2];if(this.fileDirectory.ExtraSamples!==xa.Unspecified&&o){T=[];for(let P=0;P<this.fileDirectory.BitsPerSample.length;P+=1)T.push(P)}return this.readRasters({window:e,interleave:t,samples:T,pool:n,width:s,height:i,resampleMethod:a,signal:l})}let h;switch(c){case me.WhiteIsZero:case me.BlackIsZero:case me.Palette:h=[0];break;case me.CMYK:h=[0,1,2,3];break;case me.YCbCr:case me.CIELab:h=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const m={window:u,interleave:!0,samples:h,pool:n,width:s,height:i,resampleMethod:a,signal:l},{fileDirectory:f}=this,w=await this.readRasters(m),k=2**this.fileDirectory.BitsPerSample[0];let y;switch(c){case me.WhiteIsZero:y=ka(w,k);break;case me.BlackIsZero:y=Ca(w,k);break;case me.Palette:y=Ea(w,f.ColorMap);break;case me.CMYK:y=Ia(w);break;case me.YCbCr:y=Ta(w);break;case me.CIELab:y=Va(w);break;default:throw new Error("Unsupported photometric interpretation.")}if(!t){const T=new Uint8Array(y.length/3),P=new Uint8Array(y.length/3),E=new Uint8Array(y.length/3);for(let I=0,A=0;I<y.length;I+=3,++A)T[A]=y[I],P[A]=y[I+1],E[A]=y[I+2];y=[T,P,E]}return y.width=w.width,y.height=w.height,y}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e}getGDALMetadata(e=null){const t={};if(!this.fileDirectory.GDAL_METADATA)return null;const n=this.fileDirectory.GDAL_METADATA;let s=_a(n,"Item");e===null?s=s.filter(i=>Jn(i,"sample")===void 0):s=s.filter(i=>Number(Jn(i,"sample"))===e);for(let i=0;i<s.length;++i){const a=s[i];t[Jn(a,"name")]=a.inner}return t}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,t=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(t)return[t[3],t[7],t[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const t=this.fileDirectory.ModelPixelScale,n=this.fileDirectory.ModelTransformation;if(t)return[t[0],-t[1],t[2]];if(n)return n[1]===0&&n[4]===0?[n[0],-n[5],n[10]]:[Math.sqrt(n[0]*n[0]+n[4]*n[4]),-Math.sqrt(n[1]*n[1]+n[5]*n[5]),n[10]];if(e){const[s,i,a]=e.getResolution();return[s*e.getWidth()/this.getWidth(),i*e.getHeight()/this.getHeight(),a*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(e=!1){const t=this.getHeight(),n=this.getWidth();if(this.fileDirectory.ModelTransformation&&!e){const[s,i,a,o,l,u,c,h]=this.fileDirectory.ModelTransformation,f=[[0,0],[0,t],[n,0],[n,t]].map(([y,T])=>[o+s*y+i*T,h+l*y+u*T]),w=f.map(y=>y[0]),k=f.map(y=>y[1]);return[Math.min(...w),Math.min(...k),Math.max(...w),Math.max(...k)]}else{const s=this.getOrigin(),i=this.getResolution(),a=s[0],o=s[1],l=a+i[0]*n,u=o+i[1]*t;return[Math.min(a,l),Math.min(o,u),Math.max(a,l),Math.max(o,u)]}}}class Ha{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,t){const n=this.getUint32(e,t),s=this.getUint32(e+4,t);let i;if(t){if(i=n+2**32*s,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}if(i=2**32*n+s,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}getInt64(e,t){let n=0;const s=(this._dataView.getUint8(e+(t?7:0))&128)>0;let i=!0;for(let a=0;a<8;a++){let o=this._dataView.getUint8(e+(t?a:7-a));s&&(i?o!==0&&(o=~(o-1)&255,i=!1):o=~o&255),n+=o*256**a}return s&&(n=-n),n}getUint8(e,t){return this._dataView.getUint8(e,t)}getInt8(e,t){return this._dataView.getInt8(e,t)}getUint16(e,t){return this._dataView.getUint16(e,t)}getInt16(e,t){return this._dataView.getInt16(e,t)}getUint32(e,t){return this._dataView.getUint32(e,t)}getInt32(e,t){return this._dataView.getInt32(e,t)}getFloat16(e,t){return _i(this._dataView,e,t)}getFloat32(e,t){return this._dataView.getFloat32(e,t)}getFloat64(e,t){return this._dataView.getFloat64(e,t)}}class Ka{constructor(e,t,n,s){this._dataView=new DataView(e),this._sliceOffset=t,this._littleEndian=n,this._bigTiff=s}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,t){return this.sliceOffset<=e&&this.sliceTop>=e+t}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const t=this.readUint32(e),n=this.readUint32(e+4);let s;if(this._littleEndian){if(s=t+2**32*n,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}if(s=2**32*t+n,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}readInt64(e){let t=0;const n=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let s=!0;for(let i=0;i<8;i++){let a=this._dataView.getUint8(e+(this._littleEndian?i:7-i));n&&(s?a!==0&&(a=~(a-1)&255,s=!1):a=~a&255),t+=a*256**i}return n&&(t=-t),t}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}class Wa{async fetch(e,t=void 0){return Promise.all(e.map(n=>this.fetchSlice(n,t)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class Ya extends Wa{constructor(e){super(),this.file=e}async fetchSlice(e,t){return new Promise((n,s)=>{const i=this.file.slice(e.offset,e.offset+e.length),a=new FileReader;a.onload=o=>n(o.target.result),a.onerror=s,a.onabort=s,a.readAsArrayBuffer(i),t&&t.addEventListener("abort",()=>a.abort())})}}function Xa(r){return new Ya(r)}function gr(r){switch(r){case D.BYTE:case D.ASCII:case D.SBYTE:case D.UNDEFINED:return 1;case D.SHORT:case D.SSHORT:return 2;case D.LONG:case D.SLONG:case D.FLOAT:case D.IFD:return 4;case D.RATIONAL:case D.SRATIONAL:case D.DOUBLE:case D.LONG8:case D.SLONG8:case D.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${r}`)}}function Za(r){const e=r.GeoKeyDirectory;if(!e)return null;const t={};for(let n=4;n<=e[3]*4;n+=4){const s=ya[e[n]],i=e[n+1]?Qt[e[n+1]]:null,a=e[n+2],o=e[n+3];let l=null;if(!i)l=o;else{if(l=r[i],typeof l>"u"||l===null)throw new Error(`Could not get value of geoKey '${s}'.`);typeof l=="string"?l=l.substring(o,o+a-1):l.subarray&&(l=l.subarray(o,o+a),a===1&&(l=l[0]))}t[s]=l}return t}function wt(r,e,t,n){let s=null,i=null;const a=gr(e);switch(e){case D.BYTE:case D.ASCII:case D.UNDEFINED:s=new Uint8Array(t),i=r.readUint8;break;case D.SBYTE:s=new Int8Array(t),i=r.readInt8;break;case D.SHORT:s=new Uint16Array(t),i=r.readUint16;break;case D.SSHORT:s=new Int16Array(t),i=r.readInt16;break;case D.LONG:case D.IFD:s=new Uint32Array(t),i=r.readUint32;break;case D.SLONG:s=new Int32Array(t),i=r.readInt32;break;case D.LONG8:case D.IFD8:s=new Array(t),i=r.readUint64;break;case D.SLONG8:s=new Array(t),i=r.readInt64;break;case D.RATIONAL:s=new Uint32Array(t*2),i=r.readUint32;break;case D.SRATIONAL:s=new Int32Array(t*2),i=r.readInt32;break;case D.FLOAT:s=new Float32Array(t),i=r.readFloat32;break;case D.DOUBLE:s=new Float64Array(t),i=r.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===D.RATIONAL||e===D.SRATIONAL)for(let o=0;o<t;o+=2)s[o]=i.call(r,n+o*a),s[o+1]=i.call(r,n+(o*a+4));else for(let o=0;o<t;++o)s[o]=i.call(r,n+o*a);return e===D.ASCII?new TextDecoder("utf-8").decode(s):s}class Qa{constructor(e,t,n,s){this.fileDirectory=e,this.rawFileDirectory=t,this.geoKeyDirectory=n,this.nextIFDByteOffset=s}}class Cn extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class Ja{async readRasters(e={}){const{window:t,width:n,height:s}=e;let{resX:i,resY:a,bbox:o}=e;const l=await this.getImage();let u=l;const c=await this.getImageCount(),h=l.getBoundingBox();if(t&&o)throw new Error('Both "bbox" and "window" passed.');if(n||s){if(t){const[w,k]=l.getOrigin(),[y,T]=l.getResolution();o=[w+t[0]*y,k+t[1]*T,w+t[2]*y,k+t[3]*T]}const f=o||h;if(n){if(i)throw new Error("Both width and resX passed");i=(f[2]-f[0])/n}if(s){if(a)throw new Error("Both width and resY passed");a=(f[3]-f[1])/s}}if(i||a){const f=[];for(let w=0;w<c;++w){const k=await this.getImage(w),{SubfileType:y,NewSubfileType:T}=k.fileDirectory;(w===0||y===2||T&1)&&f.push(k)}f.sort((w,k)=>w.getWidth()-k.getWidth());for(let w=0;w<f.length;++w){const k=f[w],y=(h[2]-h[0])/k.getWidth(),T=(h[3]-h[1])/k.getHeight();if(u=k,i&&i>y||a&&a>T)break}}let m=t;if(o){const[f,w]=l.getOrigin(),[k,y]=u.getResolution(l);m=[Math.round((o[0]-f)/k),Math.round((o[1]-w)/y),Math.round((o[2]-f)/k),Math.round((o[3]-w)/y)],m=[Math.min(m[0],m[2]),Math.min(m[1],m[3]),Math.max(m[0],m[2]),Math.max(m[1],m[3])]}return u.readRasters({...e,window:m})}}class Br extends Ja{constructor(e,t,n,s,i={}){super(),this.source=e,this.littleEndian=t,this.bigTiff=n,this.firstIFDOffset=s,this.cache=i.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,t){const n=this.bigTiff?4048:1024;return new Ka((await this.source.fetch([{offset:e,length:typeof t<"u"?t:n}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const t=this.bigTiff?20:12,n=this.bigTiff?8:2;let s=await this.getSlice(e);const i=this.bigTiff?s.readUint64(e):s.readUint16(e),a=i*t+(this.bigTiff?16:6);s.covers(e,a)||(s=await this.getSlice(e,a));const o={},l=new Map;let u=e+(this.bigTiff?8:2);for(let m=0;m<i;u+=t,++m){const f=s.readUint16(u),w=s.readUint16(u+2),k=this.bigTiff?s.readUint64(u+4):s.readUint32(u+4);let y,T;const P=gr(w),E=u+(this.bigTiff?12:8);if(P*k<=(this.bigTiff?8:4))y=wt(s,w,k,E);else{const A=s.readOffset(E),L=gr(w)*k;if(s.covers(A,L))y=wt(s,w,k,A);else{const K=await this.getSlice(A,L);y=wt(K,w,k,A)}}k===1&&wa.indexOf(f)===-1&&!(w===D.RATIONAL||w===D.SRATIONAL)?T=y[0]:T=y;const I=Qt[f];I&&(o[I]=T),l.set(f,T)}const c=Za(o),h=s.readOffset(e+n+t*i);return new Qa(o,l,c,h)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(t){throw t instanceof Cn?new Cn(e):t}return this.ifdRequests[e]=(async()=>{const t=await this.ifdRequests[e-1];if(t.nextIFDByteOffset===0)throw new Cn(e);return this.parseFileDirectoryAt(t.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const t=await this.requestIFD(e);return new qa(t.fileDirectory,t.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,t=!0;for(;t;)try{await this.requestIFD(e),++e}catch(n){if(n instanceof Cn)t=!1;else throw n}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const t="GDAL_STRUCTURAL_METADATA_SIZE=",n=t.length+100;let s=await this.getSlice(e,n);if(t===wt(s,D.ASCII,t.length,e)){const a=wt(s,D.ASCII,n,e).split(`
`)[0],o=Number(a.split("=")[1].split(" ")[0])+a.length;o>n&&(s=await this.getSlice(e,o));const l=wt(s,D.ASCII,o,e);this.ghostValues={},l.split(`
`).filter(u=>u.length>0).map(u=>u.split("=")).forEach(([u,c])=>{this.ghostValues[u]=c})}return this.ghostValues}static async fromSource(e,t,n){const s=(await e.fetch([{offset:0,length:1024}],n))[0],i=new Ha(s),a=i.getUint16(0,0);let o;if(a===18761)o=!0;else if(a===19789)o=!1;else throw new TypeError("Invalid byte order value.");const l=i.getUint16(2,o);let u;if(l===42)u=!1;else if(l===43){if(u=!0,i.getUint16(4,o)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const c=u?i.getUint64(8,o):i.getUint32(4,o);return new Br(e,o,u,c,t)}close(){return typeof this.source.close=="function"?this.source.close():!1}}async function el(r,e){return Br.fromSource(Xa(r),e)}var nr=1e-6,it=typeof Float32Array<"u"?Float32Array:Array;function Yt(){var r=new it(16);return it!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function tl(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function nl(r,e){var t=e[0],n=e[1],s=e[2],i=e[3],a=e[4],o=e[5],l=e[6],u=e[7],c=e[8],h=e[9],m=e[10],f=e[11],w=e[12],k=e[13],y=e[14],T=e[15],P=t*o-n*a,E=t*l-s*a,I=t*u-i*a,A=n*l-s*o,L=n*u-i*o,K=s*u-i*l,z=c*k-h*w,ne=c*y-m*w,he=c*T-f*w,R=h*y-m*k,Ce=h*T-f*k,pe=m*T-f*y,j=P*pe-E*Ce+I*R+A*he-L*ne+K*z;return j?(j=1/j,r[0]=(o*pe-l*Ce+u*R)*j,r[1]=(s*Ce-n*pe-i*R)*j,r[2]=(k*K-y*L+T*A)*j,r[3]=(m*L-h*K-f*A)*j,r[4]=(l*he-a*pe-u*ne)*j,r[5]=(t*pe-s*he+i*ne)*j,r[6]=(y*I-w*K-T*E)*j,r[7]=(c*K-m*I+f*E)*j,r[8]=(a*Ce-o*he+u*z)*j,r[9]=(n*he-t*Ce-i*z)*j,r[10]=(w*L-k*I+T*P)*j,r[11]=(h*I-c*L-f*P)*j,r[12]=(o*ne-a*R-l*z)*j,r[13]=(t*R-n*ne+s*z)*j,r[14]=(k*E-w*A-y*P)*j,r[15]=(c*A-h*E+m*P)*j,r):null}function rl(r,e,t){var n=t[0],s=t[1],i=t[2],a,o,l,u,c,h,m,f,w,k,y,T;return e===r?(r[12]=e[0]*n+e[4]*s+e[8]*i+e[12],r[13]=e[1]*n+e[5]*s+e[9]*i+e[13],r[14]=e[2]*n+e[6]*s+e[10]*i+e[14],r[15]=e[3]*n+e[7]*s+e[11]*i+e[15]):(a=e[0],o=e[1],l=e[2],u=e[3],c=e[4],h=e[5],m=e[6],f=e[7],w=e[8],k=e[9],y=e[10],T=e[11],r[0]=a,r[1]=o,r[2]=l,r[3]=u,r[4]=c,r[5]=h,r[6]=m,r[7]=f,r[8]=w,r[9]=k,r[10]=y,r[11]=T,r[12]=a*n+c*s+w*i+e[12],r[13]=o*n+h*s+k*i+e[13],r[14]=l*n+m*s+y*i+e[14],r[15]=u*n+f*s+T*i+e[15]),r}function sl(r,e,t,n,s){var i=1/Math.tan(e/2);if(r[0]=i/t,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=i,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,s!=null&&s!==1/0){var a=1/(n-s);r[10]=(s+n)*a,r[14]=2*s*n*a}else r[10]=-1,r[14]=-2*n;return r}var il=sl;function ks(r,e,t,n){var s,i,a,o,l,u,c,h,m,f,w=e[0],k=e[1],y=e[2],T=n[0],P=n[1],E=n[2],I=t[0],A=t[1],L=t[2];return Math.abs(w-I)<nr&&Math.abs(k-A)<nr&&Math.abs(y-L)<nr?tl(r):(c=w-I,h=k-A,m=y-L,f=1/Math.sqrt(c*c+h*h+m*m),c*=f,h*=f,m*=f,s=P*m-E*h,i=E*c-T*m,a=T*h-P*c,f=Math.sqrt(s*s+i*i+a*a),f?(f=1/f,s*=f,i*=f,a*=f):(s=0,i=0,a=0),o=h*a-m*i,l=m*s-c*a,u=c*i-h*s,f=Math.sqrt(o*o+l*l+u*u),f?(f=1/f,o*=f,l*=f,u*=f):(o=0,l=0,u=0),r[0]=s,r[1]=o,r[2]=c,r[3]=0,r[4]=i,r[5]=l,r[6]=h,r[7]=0,r[8]=a,r[9]=u,r[10]=m,r[11]=0,r[12]=-(s*w+i*k+a*y),r[13]=-(o*w+l*k+u*y),r[14]=-(c*w+h*k+m*y),r[15]=1,r)}function br(){var r=new it(3);return it!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function En(r,e,t){var n=new it(3);return n[0]=r,n[1]=e,n[2]=t,n}function ol(r,e,t,n){return r[0]=e,r[1]=t,r[2]=n,r}function al(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r}function ll(r,e,t,n){var s=[],i=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],i[0]=s[0],i[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),i[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),r[0]=i[0]+t[0],r[1]=i[1]+t[1],r[2]=i[2]+t[2],r}function cl(r,e,t,n){var s=[],i=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],i[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),i[1]=s[1],i[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),r[0]=i[0]+t[0],r[1]=i[1]+t[1],r[2]=i[2]+t[2],r}var ul=al;(function(){var r=br();return function(e,t,n,s,i,a){var o,l;for(t||(t=3),n||(n=0),s?l=Math.min(s*t+n,e.length):l=e.length,o=n;o<l;o+=t)r[0]=e[o],r[1]=e[o+1],r[2]=e[o+2],i(r,r,a),e[o]=r[0],e[o+1]=r[1],e[o+2]=r[2];return e}})();function Et(){var r=new it(4);return it!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function St(r,e,t,n){var s=new it(4);return s[0]=r,s[1]=e,s[2]=t,s[3]=n,s}function rr(r,e,t,n,s){return r[0]=e,r[1]=t,r[2]=n,r[3]=s,r}function hl(r,e,t){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r}function pl(r,e,t){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r[3]=e[3]-t[3],r}function dl(r,e,t){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r[3]=e[3]*t[3],r}function Fe(r,e,t){var n=e[0],s=e[1],i=e[2],a=e[3];return r[0]=t[0]*n+t[4]*s+t[8]*i+t[12]*a,r[1]=t[1]*n+t[5]*s+t[9]*i+t[13]*a,r[2]=t[2]*n+t[6]*s+t[10]*i+t[14]*a,r[3]=t[3]*n+t[7]*s+t[11]*i+t[15]*a,r}var fl=pl;(function(){var r=Et();return function(e,t,n,s,i,a){var o,l;for(t||(t=4),n||(n=0),s?l=Math.min(s*t+n,e.length):l=e.length,o=n;o<l;o+=t)r[0]=e[o],r[1]=e[o+1],r[2]=e[o+2],r[3]=e[o+3],i(r,r,a),e[o]=r[0],e[o+1]=r[1],e[o+2]=r[2],e[o+3]=r[3];return e}})();function G(r){return r==null}function Ur(r){return r!==null&&typeof r=="object"}function _r(r){return r!==null&&typeof r=="object"}function ml(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function pt(r,e){return Array.from(new Set([...Object.keys(r),...Object.keys(e)])).reduce((n,s)=>{const i=r[s],a=e[s];return _r(i)&&_r(a)?Object.assign(Object.assign({},n),{[s]:pt(i,a)}):Object.assign(Object.assign({},n),{[s]:s in e?a:i})},{})}function Nr(r){return Ur(r)?"target"in r:!1}const vl={alreadydisposed:()=>"View has been already disposed",invalidparams:r=>`Invalid parameters for '${r.name}'`,nomatchingcontroller:r=>`No matching controller for '${r.key}'`,nomatchingview:r=>`No matching view for '${JSON.stringify(r.params)}'`,notbindable:()=>"Value is not bindable",notcompatible:r=>`Not compatible with  plugin '${r.id}'`,propertynotfound:r=>`Property '${r.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class X{static alreadyDisposed(){return new X({type:"alreadydisposed"})}static notBindable(){return new X({type:"notbindable"})}static notCompatible(e,t){return new X({type:"notcompatible",context:{id:`${e}.${t}`}})}static propertyNotFound(e){return new X({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new X({type:"shouldneverhappen"})}constructor(e){var t;this.message=(t=vl[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}toString(){return this.message}}class Mn{constructor(e,t){this.obj_=e,this.key=t}static isBindable(e){return!(e===null||typeof e!="object"&&typeof e!="function")}read(){return this.obj_[this.key]}write(e){this.obj_[this.key]=e}writeProperty(e,t){const n=this.read();if(!Mn.isBindable(n))throw X.notBindable();if(!(e in n))throw X.propertyNotFound(e);n[e]=t}}class Q{constructor(){this.observers_={}}on(e,t,n){var s;let i=this.observers_[e];return i||(i=this.observers_[e]=[]),i.push({handler:t,key:(s=n?.key)!==null&&s!==void 0?s:t}),this}off(e,t){const n=this.observers_[e];return n&&(this.observers_[e]=n.filter(s=>s.key!==t)),this}emit(e,t){const n=this.observers_[e];n&&n.forEach(s=>{s.handler(t)})}}class gl{constructor(e,t){var n;this.constraint_=t?.constraint,this.equals_=(n=t?.equals)!==null&&n!==void 0?n:((s,i)=>s===i),this.emitter=new Q,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const n=t??{forceEmit:!1,last:!0},s=this.constraint_?this.constraint_.constrain(e):e,i=this.rawValue_;this.equals_(i,s)&&!n.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=s,this.emitter.emit("change",{options:n,previousRawValue:i,rawValue:s,sender:this}))}}class bl{constructor(e){this.emitter=new Q,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const n=t??{forceEmit:!1,last:!0},s=this.value_;s===e&&!n.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:n,previousRawValue:s,rawValue:this.value_,sender:this}))}}class _l{constructor(e){this.emitter=new Q,this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_)}get rawValue(){return this.value_.rawValue}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function q(r,e){const t=e?.constraint,n=e?.equals;return!t&&!n?new bl(r):new gl(r,e)}function wl(r){return[new _l(r),(e,t)=>{r.setRawValue(e,t)}]}class M{constructor(e){this.emitter=new Q,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((n,s)=>Object.assign(n,{[s]:q(e[s])}),{})}static fromObject(e){const t=this.createCore(e);return new M(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}}class hn{constructor(e){this.values=M.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),n=this.values.get("min");return Math.min(Math.max(e,n),t)}}class xl{constructor(e){this.values=M.fromObject({max:e.max,min:e.min})}constrain(e){const t=this.values.get("max"),n=this.values.get("min");let s=e;return G(n)||(s=Math.max(s,n)),G(t)||(s=Math.min(s,t)),s}}class yl{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,n=Math.round((e-t)/this.step);return t+n*this.step}}class kl{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}}const Cl={"**":(r,e)=>Math.pow(r,e),"*":(r,e)=>r*e,"/":(r,e)=>r/e,"%":(r,e)=>r%e,"+":(r,e)=>r+e,"-":(r,e)=>r-e,"<<":(r,e)=>r<<e,">>":(r,e)=>r>>e,">>>":(r,e)=>r>>>e,"&":(r,e)=>r&e,"^":(r,e)=>r^e,"|":(r,e)=>r|e};class El{constructor(e,t,n){this.left=t,this.operator=e,this.right=n}evaluate(){const e=Cl[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Il={"+":r=>r,"-":r=>-r,"~":r=>~r};class Tl{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=Il[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function Fr(r){return(e,t)=>{for(let n=0;n<r.length;n++){const s=r[n](e,t);if(s!=="")return s}return""}}function nn(r,e){var t;const n=r.substr(e).match(/^\s+/);return(t=n&&n[0])!==null&&t!==void 0?t:""}function Pl(r,e){const t=r.substr(e,1);return t.match(/^[1-9]$/)?t:""}function rn(r,e){var t;const n=r.substr(e).match(/^[0-9]+/);return(t=n&&n[0])!==null&&t!==void 0?t:""}function Sl(r,e){const t=rn(r,e);if(t!=="")return t;const n=r.substr(e,1);if(e+=1,n!=="-"&&n!=="+")return"";const s=rn(r,e);return s===""?"":n+s}function $r(r,e){const t=r.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const n=Sl(r,e);return n===""?"":t+n}function xi(r,e){const t=r.substr(e,1);if(t==="0")return t;const n=Pl(r,e);return e+=n.length,n===""?"":n+rn(r,e)}function Al(r,e){const t=xi(r,e);if(e+=t.length,t==="")return"";const n=r.substr(e,1);if(e+=n.length,n!==".")return"";const s=rn(r,e);return e+=s.length,t+n+s+$r(r,e)}function Vl(r,e){const t=r.substr(e,1);if(e+=t.length,t!==".")return"";const n=rn(r,e);return e+=n.length,n===""?"":t+n+$r(r,e)}function Ll(r,e){const t=xi(r,e);return e+=t.length,t===""?"":t+$r(r,e)}const Dl=Fr([Al,Vl,Ll]);function Ml(r,e){var t;const n=r.substr(e).match(/^[01]+/);return(t=n&&n[0])!==null&&t!==void 0?t:""}function Ol(r,e){const t=r.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const n=Ml(r,e);return n===""?"":t+n}function Bl(r,e){var t;const n=r.substr(e).match(/^[0-7]+/);return(t=n&&n[0])!==null&&t!==void 0?t:""}function Ul(r,e){const t=r.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const n=Bl(r,e);return n===""?"":t+n}function Nl(r,e){var t;const n=r.substr(e).match(/^[0-9a-f]+/i);return(t=n&&n[0])!==null&&t!==void 0?t:""}function Fl(r,e){const t=r.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const n=Nl(r,e);return n===""?"":t+n}const $l=Fr([Ol,Ul,Fl]),zl=Fr([$l,Dl]);function Rl(r,e){const t=zl(r,e);return e+=t.length,t===""?null:{evaluable:new kl(t),cursor:e}}function Gl(r,e){const t=r.substr(e,1);if(e+=t.length,t!=="(")return null;const n=ki(r,e);if(!n)return null;e=n.cursor,e+=nn(r,e).length;const s=r.substr(e,1);return e+=s.length,s!==")"?null:{evaluable:n.evaluable,cursor:e}}function jl(r,e){var t;return(t=Rl(r,e))!==null&&t!==void 0?t:Gl(r,e)}function yi(r,e){const t=jl(r,e);if(t)return t;const n=r.substr(e,1);if(e+=n.length,n!=="+"&&n!=="-"&&n!=="~")return null;const s=yi(r,e);return s?(e=s.cursor,{cursor:e,evaluable:new Tl(n,s.evaluable)}):null}function ql(r,e,t){t+=nn(e,t).length;const n=r.filter(s=>e.startsWith(s,t))[0];return n?(t+=n.length,t+=nn(e,t).length,{cursor:t,operator:n}):null}function Hl(r,e){return(t,n)=>{const s=r(t,n);if(!s)return null;n=s.cursor;let i=s.evaluable;for(;;){const a=ql(e,t,n);if(!a)break;n=a.cursor;const o=r(t,n);if(!o)return null;n=o.cursor,i=new El(a.operator,i,o.evaluable)}return i?{cursor:n,evaluable:i}:null}}const Kl=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((r,e)=>Hl(r,e),yi);function ki(r,e){return e+=nn(r,e).length,Kl(r,e)}function Wl(r){const e=ki(r,0);return!e||e.cursor+nn(r,e.cursor).length!==r.length?null:e.evaluable}function He(r){var e;const t=Wl(r);return(e=t?.evaluate())!==null&&e!==void 0?e:null}function Ci(r){if(typeof r=="number")return r;if(typeof r=="string"){const e=He(r);if(!G(e))return e}return 0}function Yl(r){return String(r)}function fe(r){return e=>e.toFixed(Math.max(Math.min(r,20),0))}function $(r,e,t,n,s){const i=(r-e)/(t-e);return n+i*(s-n)}function Cs(r){return String(r.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function ee(r,e,t){return Math.min(Math.max(r,e),t)}function Ei(r,e){return(r%e+e)%e}function Xl(r,e){return G(r.step)?Math.max(Cs(e),2):Cs(r.step)}function Ii(r){var e;return(e=r.step)!==null&&e!==void 0?e:1}function Ti(r,e){var t;const n=Math.abs((t=r.step)!==null&&t!==void 0?t:e);return n===0?.1:Math.pow(10,Math.floor(Math.log10(n))-1)}function Pi(r,e){return G(r.step)?null:new yl(r.step,e)}function Si(r){return!G(r.max)&&!G(r.min)?new hn({max:r.max,min:r.min}):!G(r.max)||!G(r.min)?new xl({max:r.max,min:r.min}):null}function Ai(r,e){var t,n,s;return{formatter:(t=r.format)!==null&&t!==void 0?t:fe(Xl(r,e)),keyScale:(n=r.keyScale)!==null&&n!==void 0?n:Ii(r),pointerScale:(s=r.pointerScale)!==null&&s!==void 0?s:Ti(r,e)}}function Vi(r){return{format:r.optional.function,keyScale:r.optional.number,max:r.optional.number,min:r.optional.number,pointerScale:r.optional.number,step:r.optional.number}}function zr(r){return{constraint:r.constraint,textProps:M.fromObject(Ai(r.params,r.initialValue))}}class gt{constructor(e){this.controller=e}get element(){return this.controller.view.element}get disabled(){return this.controller.viewProps.get("disabled")}set disabled(e){this.controller.viewProps.set("disabled",e)}get hidden(){return this.controller.viewProps.get("hidden")}set hidden(e){this.controller.viewProps.set("hidden",e)}dispose(){this.controller.viewProps.set("disposed",!0)}importState(e){return this.controller.importState(e)}exportState(){return this.controller.exportState()}}class qn{constructor(e){this.target=e}}class pn extends qn{constructor(e,t,n){super(e),this.value=t,this.last=n??!0}}class Zl extends qn{constructor(e,t){super(e),this.expanded=t}}class Ql extends qn{constructor(e,t){super(e),this.index=t}}class Jl extends qn{constructor(e,t){super(e),this.native=t}}class sn extends gt{constructor(e){super(e),this.onValueChange_=this.onValueChange_.bind(this),this.emitter_=new Q,this.controller.value.emitter.on("change",this.onValueChange_)}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get key(){return this.controller.value.binding.target.key}get tag(){return this.controller.tag}set tag(e){this.controller.tag=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,s=>{n(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}refresh(){this.controller.value.fetch()}onValueChange_(e){const t=this.controller.value;this.emitter_.emit("change",new pn(this,t.binding.target.read(),e.options.last))}}class ec{constructor(e,t){this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=t,this.value_=e,this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.emitter=new Q}get rawValue(){return this.value_.rawValue}set rawValue(e){this.value_.rawValue=e}setRawValue(e,t){this.value_.setRawValue(e,t)}fetch(){this.value_.rawValue=this.binding.read()}push(){this.binding.write(this.value_.rawValue)}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.push(),this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function tc(r){if(!("binding"in r))return!1;const e=r.binding;return Nr(e)&&"read"in e&&"write"in e}function nc(r,e){const n=Object.keys(e).reduce((s,i)=>{if(s===void 0)return;const a=e[i],o=a(r[i]);return o.succeeded?Object.assign(Object.assign({},s),{[i]:o.value}):void 0},{});return n}function rc(r,e){return r.reduce((t,n)=>{if(t===void 0)return;const s=e(n);if(!(!s.succeeded||s.value===void 0))return[...t,s.value]},[])}function sc(r){return r===null?!1:typeof r=="object"}function $e(r){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const n=r(t);return n!==void 0?{succeeded:!0,value:n}:{succeeded:!1,value:void 0}}}function Es(r){return{custom:e=>$e(e)(r),boolean:$e(e=>typeof e=="boolean"?e:void 0)(r),number:$e(e=>typeof e=="number"?e:void 0)(r),string:$e(e=>typeof e=="string"?e:void 0)(r),function:$e(e=>typeof e=="function"?e:void 0)(r),constant:e=>$e(t=>t===e?e:void 0)(r),raw:$e(e=>e)(r),object:e=>$e(t=>{if(sc(t))return nc(t,e)})(r),array:e=>$e(t=>{if(Array.isArray(t))return rc(t,e)})(r)}}const wr={optional:Es(!0),required:Es(!1)};function W(r,e){const t=e(wr),n=wr.required.object(t)(r);return n.succeeded?n.value:void 0}function ge(r,e,t,n){if(e&&!e(r))return!1;const s=W(r,t);return s?n(s):!1}function be(r,e){var t;return pt((t=r?.())!==null&&t!==void 0?t:{},e)}function ht(r){return"value"in r}function Li(r){if(!Ur(r)||!("binding"in r))return!1;const e=r.binding;return Nr(e)}const Me="http://www.w3.org/2000/svg";function On(r){r.offsetHeight}function ic(r,e){const t=r.style.transition;r.style.transition="none",e(),r.style.transition=t}function Rr(r){return r.ontouchstart!==void 0}function oc(){return globalThis}function ac(){return oc().document}function lc(r){const e=r.ownerDocument.defaultView;return e&&"document"in e?r.getContext("2d",{willReadFrequently:!0}):null}const cc={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function Hn(r,e){const t=r.createElementNS(Me,"svg");return t.innerHTML=cc[e],t}function Di(r,e,t){r.insertBefore(e,r.children[t])}function Gr(r){r.parentElement&&r.parentElement.removeChild(r)}function Mi(r){for(;r.children.length>0;)r.removeChild(r.children[0])}function uc(r){for(;r.childNodes.length>0;)r.removeChild(r.childNodes[0])}function Oi(r){return r.relatedTarget?r.relatedTarget:"explicitOriginalTarget"in r?r.explicitOriginalTarget:null}function qe(r,e){r.emitter.on("change",t=>{e(t.rawValue)}),e(r.rawValue)}function Be(r,e,t){qe(r.value(e),t)}const hc="tp";function B(r){return(t,n)=>[hc,"-",r,"v",t?`_${t}`:"",n?`-${n}`:""].join("")}const qt=B("lbl");function pc(r,e){const t=r.createDocumentFragment();return e.split(`
`).map(s=>r.createTextNode(s)).forEach((s,i)=>{i>0&&t.appendChild(r.createElement("br")),t.appendChild(s)}),t}class Bi{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(qt()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(qt("l")),Be(t.props,"label",i=>{G(i)?this.element.classList.add(qt(void 0,"nol")):(this.element.classList.remove(qt(void 0,"nol")),uc(n),n.appendChild(pc(e,i)))}),this.element.appendChild(n),this.labelElement=n;const s=e.createElement("div");s.classList.add(qt("v")),this.element.appendChild(s),this.valueElement=s}}class Ui{constructor(e,t){this.props=t.props,this.valueController=t.valueController,this.viewProps=t.valueController.viewProps,this.view=new Bi(e,{props:t.props,viewProps:this.viewProps}),this.view.valueElement.appendChild(this.valueController.view.element)}importProps(e){return ge(e,null,t=>({label:t.optional.string}),t=>(this.props.set("label",t.label),!0))}exportProps(){return be(null,{label:this.props.get("label")})}}function dc(){return["veryfirst","first","last","verylast"]}const Is=B(""),Ts={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class Kn{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{dc().forEach(n=>{t.classList.remove(Is(void 0,Ts[n]))}),this.blade.get("positions").forEach(n=>{t.classList.add(Is(void 0,Ts[n]))})}),this.viewProps.handleDispose(()=>{Gr(t)})}get parent(){return this.parent_}set parent(e){this.parent_=e,this.viewProps.set("parent",this.parent_?this.parent_.viewProps:null)}importState(e){return ge(e,null,t=>({disabled:t.required.boolean,hidden:t.required.boolean}),t=>(this.viewProps.importState(t),!0))}exportState(){return be(null,Object.assign({},this.viewProps.exportState()))}}class dt extends Kn{constructor(e,t){if(t.value!==t.valueController.value)throw X.shouldNeverHappen();const n=t.valueController.viewProps,s=new Ui(e,{blade:t.blade,props:t.props,valueController:t.valueController});super(Object.assign(Object.assign({},t),{view:new Bi(e,{props:t.props,viewProps:n}),viewProps:n})),this.labelController=s,this.value=t.value,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}importState(e){return ge(e,t=>{var n,s,i;return super.importState(t)&&this.labelController.importProps(t)&&((i=(s=(n=this.valueController).importProps)===null||s===void 0?void 0:s.call(n,e))!==null&&i!==void 0?i:!0)},t=>({value:t.optional.raw}),t=>(t.value&&(this.value.rawValue=t.value),!0))}exportState(){var e,t,n;return be(()=>super.exportState(),Object.assign(Object.assign({value:this.value.rawValue},this.labelController.exportProps()),(n=(t=(e=this.valueController).exportProps)===null||t===void 0?void 0:t.call(e))!==null&&n!==void 0?n:{}))}}function Ps(r){const e=Object.assign({},r);return delete e.value,e}class Ni extends dt{constructor(e,t){super(e,t),this.tag=t.tag}importState(e){return ge(e,t=>super.importState(Ps(e)),t=>({tag:t.optional.string}),t=>(this.tag=t.tag,!0))}exportState(){return be(()=>Ps(super.exportState()),{binding:{key:this.value.binding.target.key,value:this.value.binding.target.read()},tag:this.tag})}}function fc(r){return ht(r)&&Li(r.value)}class mc extends Ni{importState(e){return ge(e,t=>super.importState(t),t=>({binding:t.required.object({value:t.required.raw})}),t=>(this.value.binding.inject(t.binding.value),this.value.fetch(),!0))}}function vc(r){return ht(r)&&tc(r.value)}function Fi(r,e){for(;r.length<e;)r.push(void 0)}function gc(r){const e=[];return Fi(e,r),e}function bc(r){const e=r.indexOf(void 0);return e<0?r:r.slice(0,e)}function _c(r,e){const t=[...bc(r),e];return t.length>r.length?t.splice(0,t.length-r.length):Fi(t,r.length),t}class wc{constructor(e){this.emitter=new Q,this.onTick_=this.onTick_.bind(this),this.onValueBeforeChange_=this.onValueBeforeChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.binding=e.binding,this.value_=q(gc(e.bufferSize)),this.value_.emitter.on("beforechange",this.onValueBeforeChange_),this.value_.emitter.on("change",this.onValueChange_),this.ticker=e.ticker,this.ticker.emitter.on("tick",this.onTick_),this.fetch()}get rawValue(){return this.value_.rawValue}set rawValue(e){this.value_.rawValue=e}setRawValue(e,t){this.value_.setRawValue(e,t)}fetch(){this.value_.rawValue=_c(this.value_.rawValue,this.binding.read())}onTick_(){this.fetch()}onValueBeforeChange_(e){this.emitter.emit("beforechange",Object.assign(Object.assign({},e),{sender:this}))}onValueChange_(e){this.emitter.emit("change",Object.assign(Object.assign({},e),{sender:this}))}}function xc(r){if(!("binding"in r))return!1;const e=r.binding;return Nr(e)&&"read"in e&&!("write"in e)}class yc extends Ni{exportState(){return be(()=>super.exportState(),{binding:{readonly:!0}})}}function kc(r){return ht(r)&&xc(r.value)}class Cc extends gt{get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get title(){var e;return(e=this.controller.buttonController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.buttonController.props.set("title",e)}on(e,t){const n=t.bind(this);return this.controller.buttonController.emitter.on(e,i=>{n(new Jl(this,i.nativeEvent))}),this}off(e,t){return this.controller.buttonController.emitter.off(e,t),this}}function Ec(r,e,t){t?r.classList.add(e):r.classList.remove(e)}function Bt(r,e){return t=>{Ec(r,e,t)}}function jr(r,e){qe(r,t=>{e.textContent=t??""})}const sr=B("btn");class Ic{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(sr()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("button");n.classList.add(sr("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const s=e.createElement("div");s.classList.add(sr("t")),jr(t.props.value("title"),s),this.buttonElement.appendChild(s)}}class Tc{constructor(e,t){this.emitter=new Q,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new Ic(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}importProps(e){return ge(e,null,t=>({title:t.optional.string}),t=>(this.props.set("title",t.title),!0))}exportProps(){return be(null,{title:this.props.get("title")})}onClick_(e){this.emitter.emit("click",{nativeEvent:e,sender:this})}}class Ss extends Kn{constructor(e,t){const n=new Tc(e,{props:t.buttonProps,viewProps:t.viewProps}),s=new Ui(e,{blade:t.blade,props:t.labelProps,valueController:n});super({blade:t.blade,view:s.view,viewProps:t.viewProps}),this.buttonController=n,this.labelController=s}importState(e){return ge(e,t=>super.importState(t)&&this.buttonController.importProps(t)&&this.labelController.importProps(t),()=>({}),()=>!0)}exportState(){return be(()=>super.exportState(),Object.assign(Object.assign({},this.buttonController.exportProps()),this.labelController.exportProps()))}}class $i{constructor(e){const[t,n]=e.split("-"),s=t.split(".");this.major=parseInt(s[0],10),this.minor=parseInt(s[1],10),this.patch=parseInt(s[2],10),this.prerelease=n??null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}}const Ut=new $i("2.0.5");function ue(r){return Object.assign({core:Ut},r)}const Pc=ue({id:"button",type:"blade",accept(r){const e=W(r,t=>({title:t.required.string,view:t.required.constant("button"),label:t.optional.string}));return e?{params:e}:null},controller(r){return new Ss(r.document,{blade:r.blade,buttonProps:M.fromObject({title:r.params.title}),labelProps:M.fromObject({label:r.params.label}),viewProps:r.viewProps})},api(r){return r.controller instanceof Ss?new Cc(r.controller):null}});function Sc(r,e){return r.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function Ac(r,e){return r.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function Vc(r,e){return r.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}function Lc(r){return Ur(r)?"refresh"in r&&typeof r.refresh=="function":!1}function Dc(r,e){if(!Mn.isBindable(r))throw X.notBindable();return new Mn(r,e)}class Mc{constructor(e,t){this.onRackValueChange_=this.onRackValueChange_.bind(this),this.controller_=e,this.emitter_=new Q,this.pool_=t,this.controller_.rack.emitter.on("valuechange",this.onRackValueChange_)}get children(){return this.controller_.rack.children.map(e=>this.pool_.createApi(e))}addBinding(e,t,n){const s=n??{},i=this.controller_.element.ownerDocument,a=this.pool_.createBinding(i,Dc(e,t),s),o=this.pool_.createBindingApi(a);return this.add(o,s.index)}addFolder(e){return Ac(this,e)}addButton(e){return Sc(this,e)}addTab(e){return Vc(this,e)}add(e,t){const n=e.controller;return this.controller_.rack.add(n,t),e}remove(e){this.controller_.rack.remove(e.controller)}addBlade(e){const t=this.controller_.element.ownerDocument,n=this.pool_.createBlade(t,e),s=this.pool_.createApi(n);return this.add(s,e.index)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,s=>{n(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}refresh(){this.children.forEach(e=>{Lc(e)&&e.refresh()})}onRackValueChange_(e){const t=e.bladeController,n=this.pool_.createApi(t),s=Li(t.value)?t.value.binding:null;this.emitter_.emit("change",new pn(n,s?s.target.read():t.value.rawValue,e.options.last))}}class qr extends gt{constructor(e,t){super(e),this.rackApi_=new Mc(e.rackController,t)}refresh(){this.rackApi_.refresh()}}class Hr extends Kn{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}importState(e){return ge(e,t=>super.importState(t),t=>({children:t.required.array(t.required.raw)}),t=>this.rackController.rack.children.every((n,s)=>n.importState(t.children[s])))}exportState(){return be(()=>super.exportState(),{children:this.rackController.rack.children.map(e=>e.exportState())})}}function xr(r){return"rackController"in r}class Oc{constructor(e){this.emitter=new Q,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw X.shouldNeverHappen();const n=t!==void 0?t:this.items_.length;this.items_.splice(n,0,e),this.cache_.add(e);const s=this.extract_(e);s&&(s.emitter.on("add",this.onSubListAdd_),s.emitter.on("remove",this.onSubListRemove_),s.allItems().forEach(i=>{this.cache_.add(i)})),this.emitter.emit("add",{index:n,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const n=this.extract_(e);n&&(n.allItems().forEach(s=>{this.cache_.delete(s)}),n.emitter.off("add",this.onSubListAdd_),n.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}}function Bc(r,e){for(let t=0;t<r.length;t++){const n=r[t];if(ht(n)&&n.value===e)return n}return null}function Uc(r){return xr(r)?r.rackController.rack.bcSet_:null}class Nc{constructor(e){var t,n;this.emitter=new Q,this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onRackLayout_=this.onRackLayout_.bind(this),this.onRackValueChange_=this.onRackValueChange_.bind(this),this.blade_=(t=e.blade)!==null&&t!==void 0?t:null,(n=this.blade_)===null||n===void 0||n.value("positions").emitter.on("change",this.onBladePositionsChange_),this.viewProps=e.viewProps,this.bcSet_=new Oc(Uc),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){var n;(n=e.parent)===null||n===void 0||n.remove(e),e.parent=this,this.bcSet_.add(e,t)}remove(e){e.parent=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,root:t,sender:this}),!t)return;const n=e.item;if(n.viewProps.emitter.on("change",this.onChildViewPropsChange_),n.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),n.viewProps.handleDispose(this.onChildDispose_),ht(n))n.value.emitter.on("change",this.onChildValueChange_);else if(xr(n)){const s=n.rackController.rack;if(s){const i=s.emitter;i.on("layout",this.onRackLayout_),i.on("valuechange",this.onRackValueChange_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,root:t,sender:this}),!t)return;const n=e.item;if(ht(n))n.value.emitter.off("change",this.onChildValueChange_);else if(xr(n)){const s=n.rackController.rack;if(s){const i=s.emitter;i.off("layout",this.onRackLayout_),i.off("valuechange",this.onRackValueChange_)}}}updatePositions_(){const e=this.bcSet_.items.filter(s=>!s.viewProps.get("hidden")),t=e[0],n=e[e.length-1];this.bcSet_.items.forEach(s=>{const i=[];s===t&&(i.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&i.push("veryfirst")),s===n&&(i.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&i.push("verylast")),s.blade.set("positions",i)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildValueChange_(e){const t=Bc(this.find(ht),e.sender);if(!t)throw X.alreadyDisposed();this.emitter.emit("valuechange",{bladeController:t,options:e.options,sender:this})}onRackLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onRackValueChange_(e){this.emitter.emit("valuechange",{bladeController:e.bladeController,options:e.options,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Kr{constructor(e){this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.element=e.element,this.viewProps=e.viewProps;const t=new Nc({blade:e.root?void 0:e.blade,viewProps:e.viewProps});t.emitter.on("add",this.onRackAdd_),t.emitter.on("remove",this.onRackRemove_),this.rack=t,this.viewProps.handleDispose(()=>{for(let n=this.rack.children.length-1;n>=0;n--)this.rack.children[n].viewProps.set("disposed",!0)})}onRackAdd_(e){e.root&&Di(this.element,e.bladeController.view.element,e.index)}onRackRemove_(e){e.root&&Gr(e.bladeController.view.element)}}function Nt(){return new M({positions:q([],{equals:ml})})}class dn extends M{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},n=M.createCore(t);return new dn(n)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!G(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const n=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};Be(this,"expanded",n),Be(this,"temporaryExpanded",n)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function Fc(r,e){let t=0;return ic(e,()=>{r.set("expandedHeight",null),r.set("temporaryExpanded",!0),On(e),t=e.clientHeight,r.set("temporaryExpanded",null),On(e)}),t}function As(r,e){e.style.height=r.styleHeight}function Wr(r,e){r.value("expanded").emitter.on("beforechange",()=>{if(r.set("completed",!1),G(r.get("expandedHeight"))){const t=Fc(r,e);t>0&&r.set("expandedHeight",t)}r.set("shouldFixHeight",!0),On(e)}),r.emitter.on("change",()=>{As(r,e)}),As(r,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&r.cleanUpTransition()})}class zi extends qr{constructor(e,t){super(e,t),this.emitter_=new Q,this.controller.foldable.value("expanded").emitter.on("change",n=>{this.emitter_.emit("fold",new Zl(this,n.sender.rawValue))}),this.rackApi_.on("change",n=>{this.emitter_.emit("change",n)})}get expanded(){return this.controller.foldable.get("expanded")}set expanded(e){this.controller.foldable.set("expanded",e)}get title(){return this.controller.props.get("title")}set title(e){this.controller.props.set("title",e)}get children(){return this.rackApi_.children}addBinding(e,t,n){return this.rackApi_.addBinding(e,t,n)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,s=>{n(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}const Ri=B("cnt");class $c{constructor(e,t){var n;this.className_=B((n=t.viewName)!==null&&n!==void 0?n:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),Ri()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),Be(this.foldable_,"completed",Bt(this.element,this.className_(void 0,"cpl")));const s=e.createElement("button");s.classList.add(this.className_("b")),Be(t.props,"title",u=>{G(u)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s;const i=e.createElement("div");i.classList.add(this.className_("i")),this.element.appendChild(i);const a=e.createElement("div");a.classList.add(this.className_("t")),jr(t.props.value("title"),a),this.buttonElement.appendChild(a),this.titleElement=a;const o=e.createElement("div");o.classList.add(this.className_("m")),this.buttonElement.appendChild(o);const l=e.createElement("div");l.classList.add(this.className_("c")),this.element.appendChild(l),this.containerElement=l}}class yr extends Hr{constructor(e,t){var n;const s=dn.create((n=t.expanded)!==null&&n!==void 0?n:!0),i=new $c(e,{foldable:s,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Kr({blade:t.blade,element:i.containerElement,root:t.root,viewProps:t.viewProps}),view:i})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=s,Wr(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}importState(e){return ge(e,t=>super.importState(t),t=>({expanded:t.required.boolean,title:t.optional.string}),t=>(this.foldable.set("expanded",t.expanded),this.props.set("title",t.title),!0))}exportState(){return be(()=>super.exportState(),{expanded:this.foldable.get("expanded"),title:this.props.get("title")})}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const zc=ue({id:"folder",type:"blade",accept(r){const e=W(r,t=>({title:t.required.string,view:t.required.constant("folder"),expanded:t.optional.boolean}));return e?{params:e}:null},controller(r){return new yr(r.document,{blade:r.blade,expanded:r.params.expanded,props:M.fromObject({title:r.params.title}),viewProps:r.viewProps})},api(r){return r.controller instanceof yr?new zi(r.controller,r.pool):null}}),Rc=B("");function Vs(r,e){return Bt(r,Rc(void 0,e))}class Ye extends M{constructor(e){var t;super(e),this.onDisabledChange_=this.onDisabledChange_.bind(this),this.onParentChange_=this.onParentChange_.bind(this),this.onParentGlobalDisabledChange_=this.onParentGlobalDisabledChange_.bind(this),[this.globalDisabled_,this.setGlobalDisabled_]=wl(q(this.getGlobalDisabled_())),this.value("disabled").emitter.on("change",this.onDisabledChange_),this.value("parent").emitter.on("change",this.onParentChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_)}static create(e){var t,n,s;const i=e??{};return new Ye(M.createCore({disabled:(t=i.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(n=i.hidden)!==null&&n!==void 0?n:!1,parent:(s=i.parent)!==null&&s!==void 0?s:null}))}get globalDisabled(){return this.globalDisabled_}bindClassModifiers(e){qe(this.globalDisabled_,Vs(e,"disabled")),Be(this,"hidden",Vs(e,"hidden"))}bindDisabled(e){qe(this.globalDisabled_,t=>{e.disabled=t})}bindTabIndex(e){qe(this.globalDisabled_,t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}importState(e){this.set("disabled",e.disabled),this.set("hidden",e.hidden)}exportState(){return{disabled:this.get("disabled"),hidden:this.get("hidden")}}getGlobalDisabled_(){const e=this.get("parent");return(e?e.globalDisabled.rawValue:!1)||this.get("disabled")}updateGlobalDisabled_(){this.setGlobalDisabled_(this.getGlobalDisabled_())}onDisabledChange_(){this.updateGlobalDisabled_()}onParentGlobalDisabledChange_(){this.updateGlobalDisabled_()}onParentChange_(e){var t;const n=e.previousRawValue;n?.globalDisabled.emitter.off("change",this.onParentGlobalDisabledChange_),(t=this.get("parent"))===null||t===void 0||t.globalDisabled.emitter.on("change",this.onParentGlobalDisabledChange_),this.updateGlobalDisabled_()}}const Ls=B("tbp");class Gc{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ls()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(Ls("c")),this.element.appendChild(n),this.containerElement=n}}const Ht=B("tbi");class jc{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ht()),t.viewProps.bindClassModifiers(this.element),Be(t.props,"selected",i=>{i?this.element.classList.add(Ht(void 0,"sel")):this.element.classList.remove(Ht(void 0,"sel"))});const n=e.createElement("button");n.classList.add(Ht("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const s=e.createElement("div");s.classList.add(Ht("t")),jr(t.props.value("title"),s),this.buttonElement.appendChild(s),this.titleElement=s}}class qc{constructor(e,t){this.emitter=new Q,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new jc(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class kr extends Hr{constructor(e,t){const n=new Gc(e,{viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:new Kr({blade:t.blade,element:n.containerElement,viewProps:t.viewProps}),view:n})),this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new qc(e,{props:t.itemProps,viewProps:Ye.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.props=t.props,Be(this.props,"selected",s=>{this.itemController.props.set("selected",s),this.viewProps.set("hidden",!s)})}get itemController(){return this.ic_}importState(e){return ge(e,t=>super.importState(t),t=>({selected:t.required.boolean,title:t.required.string}),t=>(this.ic_.props.set("selected",t.selected),this.ic_.props.set("title",t.title),!0))}exportState(){return be(()=>super.exportState(),{selected:this.ic_.props.get("selected"),title:this.ic_.props.get("title")})}onItemClick_(){this.props.set("selected",!0)}}class Hc extends qr{constructor(e,t){super(e,t),this.emitter_=new Q,this.onSelect_=this.onSelect_.bind(this),this.pool_=t,this.rackApi_.on("change",n=>{this.emitter_.emit("change",n)}),this.controller.tab.selectedIndex.emitter.on("change",this.onSelect_)}get pages(){return this.rackApi_.children}addPage(e){const t=this.controller.view.element.ownerDocument,n=new kr(t,{blade:Nt(),itemProps:M.fromObject({selected:!1,title:e.title}),props:M.fromObject({selected:!1}),viewProps:Ye.create()}),s=this.pool_.createApi(n);return this.rackApi_.add(s,e.index)}removePage(e){this.rackApi_.remove(this.rackApi_.children[e])}on(e,t){const n=t.bind(this);return this.emitter_.on(e,s=>{n(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}onSelect_(e){this.emitter_.emit("select",new Ql(this,e.rawValue))}}class Kc extends qr{get title(){var e;return(e=this.controller.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller.itemController.props.set("title",e)}get selected(){return this.controller.props.get("selected")}set selected(e){this.controller.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBinding(e,t,n){return this.rackApi_.addBinding(e,t,n)}addBlade(e){return this.rackApi_.addBlade(e)}}const Ds=-1;class Wc{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=q(!0),this.selectedIndex=q(Ds),this.items_=[]}add(e,t){const n=t??this.items_.length;this.items_.splice(n,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=Ds,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,n)=>{t.rawValue=n===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,n)=>{t.rawValue=n===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(n=>n===e.sender);this.items_.forEach((n,s)=>{n.rawValue=s===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}}const Kt=B("tab");class Yc{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Kt(),Ri()),t.viewProps.bindClassModifiers(this.element),qe(t.empty,Bt(this.element,Kt(void 0,"nop")));const n=e.createElement("div");n.classList.add(Kt("t")),this.element.appendChild(n),this.itemsElement=n;const s=e.createElement("div");s.classList.add(Kt("i")),this.element.appendChild(s);const i=e.createElement("div");i.classList.add(Kt("c")),this.element.appendChild(i),this.contentsElement=i}}class Ms extends Hr{constructor(e,t){const n=new Wc,s=new Yc(e,{empty:n.empty,viewProps:t.viewProps});super({blade:t.blade,rackController:new Kr({blade:t.blade,element:s.contentsElement,viewProps:t.viewProps}),view:s}),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const i=this.rackController.rack;i.emitter.on("add",this.onRackAdd_),i.emitter.on("remove",this.onRackRemove_),this.tab=n}add(e,t){this.rackController.rack.add(e,t)}remove(e){this.rackController.rack.remove(this.rackController.rack.children[e])}onRackAdd_(e){if(!e.root)return;const t=e.bladeController;Di(this.view.itemsElement,t.itemController.view.element,e.index),t.itemController.viewProps.set("parent",this.viewProps),this.tab.add(t.props.value("selected"))}onRackRemove_(e){if(!e.root)return;const t=e.bladeController;Gr(t.itemController.view.element),t.itemController.viewProps.set("parent",null),this.tab.remove(t.props.value("selected"))}}const Gi=ue({id:"tab",type:"blade",accept(r){const e=W(r,t=>({pages:t.required.array(t.required.object({title:t.required.string})),view:t.required.constant("tab")}));return!e||e.pages.length===0?null:{params:e}},controller(r){const e=new Ms(r.document,{blade:r.blade,viewProps:r.viewProps});return r.params.pages.forEach(t=>{const n=new kr(r.document,{blade:Nt(),itemProps:M.fromObject({selected:!1,title:t.title}),props:M.fromObject({selected:!1}),viewProps:Ye.create()});e.add(n)}),e},api(r){return r.controller instanceof Ms?new Hc(r.controller,r.pool):r.controller instanceof kr?new Kc(r.controller,r.pool):null}});function Xc(r,e){const t=r.accept(e.params);if(!t)return null;const n=W(e.params,s=>({disabled:s.optional.boolean,hidden:s.optional.boolean}));return r.controller({blade:Nt(),document:e.document,params:Object.assign(Object.assign({},t.params),{disabled:n?.disabled,hidden:n?.hidden}),viewProps:Ye.create({disabled:n?.disabled,hidden:n?.hidden})})}class Yr extends sn{get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}}class Zc{constructor(){this.disabled=!1,this.emitter=new Q}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class Qc{constructor(e,t){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new Q,this.interval_=t,this.setTimer_()}get disabled(){return this.disabled_}set disabled(e){this.disabled_=e,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const e=this.doc_.defaultView;e&&e.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const e=this.doc_.defaultView;e&&(this.timerId_=e.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class fn{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,n)=>n.constrain(t),e)}}function Bn(r,e){if(r instanceof e)return r;if(r instanceof fn){const t=r.constraints.reduce((n,s)=>n||(s instanceof e?s:null),null);if(t)return t}return null}class mn{constructor(e){this.values=M.fromObject({options:e})}constrain(e){const t=this.values.get("options");return t.length===0||t.filter(s=>s.value===e).length>0?e:t[0].value}}function vn(r){var e;const t=wr;if(Array.isArray(r))return(e=W({items:r},n=>({items:n.required.array(n.required.object({text:n.required.string,value:n.required.raw}))})))===null||e===void 0?void 0:e.items;if(typeof r=="object")return t.required.raw(r).value}function Xr(r){if(Array.isArray(r))return r;const e=[];return Object.keys(r).forEach(t=>{e.push({text:t,value:r[t]})}),e}function Zr(r){return G(r)?null:new mn(Xr(r))}const ir=B("lst");class Jc{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(ir()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("select");n.classList.add(ir("s")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.selectElement=n;const s=e.createElement("div");s.classList.add(ir("m")),s.appendChild(Hn(e,"dropdown")),this.element.appendChild(s),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,Be(this.props_,"options",i=>{Mi(this.selectElement),i.forEach(a=>{const o=e.createElement("option");o.textContent=a.text,this.selectElement.appendChild(o)}),this.update_()})}update_(){const e=this.props_.get("options").map(t=>t.value);this.selectElement.selectedIndex=e.indexOf(this.value_.rawValue)}onValueChange_(){this.update_()}}class ot{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new Jc(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;this.value.rawValue=this.props.get("options")[t.selectedIndex].value}importProps(e){return ge(e,null,t=>({options:t.required.custom(vn)}),t=>(this.props.set("options",Xr(t.options)),!0))}exportProps(){return be(null,{options:this.props.get("options")})}}const Os=B("pop");class eu{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Os()),t.viewProps.bindClassModifiers(this.element),qe(t.shows,Bt(this.element,Os(void 0,"v")))}}class ji{constructor(e,t){this.shows=q(!1),this.viewProps=t.viewProps,this.view=new eu(e,{shows:this.shows,viewProps:this.viewProps})}}const Bs=B("txt");class tu{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Bs()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const n=e.createElement("input");n.classList.add(Bs("i")),n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}}class on{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new tu(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const n=e.currentTarget.value,s=this.parser_(n);G(s)||(this.value.rawValue=s),this.view.refresh()}}function nu(r){return String(r)}function qi(r){return r==="false"?!1:!!r}function Us(r){return nu(r)}function ru(r){return e=>r.reduce((t,n)=>t!==null?t:n(e),null)}const su=fe(0);function Un(r){return su(r)+"%"}function Hi(r){return String(r)}function Cr(r){return r}function Ft({primary:r,secondary:e,forward:t,backward:n}){let s=!1;function i(a){s||(s=!0,a(),s=!1)}r.emitter.on("change",a=>{i(()=>{e.setRawValue(t(r.rawValue,e.rawValue),a.options)})}),e.emitter.on("change",a=>{i(()=>{r.setRawValue(n(r.rawValue,e.rawValue),a.options)}),i(()=>{e.setRawValue(t(r.rawValue,e.rawValue),a.options)})}),i(()=>{e.setRawValue(t(r.rawValue,e.rawValue),{forceEmit:!1,last:!0})})}function de(r,e){const t=r*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function an(r){return{altKey:r.altKey,downKey:r.key==="ArrowDown",shiftKey:r.shiftKey,upKey:r.key==="ArrowUp"}}function Ke(r){return{altKey:r.altKey,downKey:r.key==="ArrowLeft",shiftKey:r.shiftKey,upKey:r.key==="ArrowRight"}}function iu(r){return r==="ArrowUp"||r==="ArrowDown"}function Ki(r){return iu(r)||r==="ArrowLeft"||r==="ArrowRight"}function or(r,e){var t,n;const s=e.ownerDocument.defaultView,i=e.getBoundingClientRect();return{x:r.pageX-(((t=s&&s.scrollX)!==null&&t!==void 0?t:0)+i.left),y:r.pageY-(((n=s&&s.scrollY)!==null&&n!==void 0?n:0)+i.top)}}class bt{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new Q,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const n=this.elem_.ownerDocument;n.addEventListener("mousemove",this.onDocumentMouseMove_),n.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(or(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(or(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(or(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const n=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,s=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(n?{x:n.clientX-s.left,y:n.clientY-s.top}:void 0),sender:this,shiftKey:e.shiftKey})}}const _e=B("txt");class ou{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(_e(),_e(void 0,"num")),t.arrayPosition&&this.element.classList.add(_e(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("input");n.classList.add(_e("i")),n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(_e()),this.inputElement.classList.add(_e("i"));const s=e.createElement("div");s.classList.add(_e("k")),this.element.appendChild(s),this.knobElement=s;const i=e.createElementNS(Me,"svg");i.classList.add(_e("g")),this.knobElement.appendChild(i);const a=e.createElementNS(Me,"path");a.classList.add(_e("gb")),i.appendChild(a),this.guideBodyElem_=a;const o=e.createElementNS(Me,"path");o.classList.add(_e("gh")),i.appendChild(o),this.guideHeadElem_=o;const l=e.createElement("div");l.classList.add(B("tt")()),this.knobElement.appendChild(l),this.tooltipElem_=l,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(_e(void 0,"drg"));return}this.element.classList.add(_e(void 0,"drg"));const t=e.rawValue/this.props_.get("pointerScale"),n=t+(t>0?-1:t<0?1:0),s=ee(-n,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${n+s},0 L${n},4 L${n+s},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const i=this.props_.get("formatter");this.tooltipElem_.textContent=i(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}}class gn{constructor(e,t){var n;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.parser_=t.parser,this.props=t.props,this.sliderProps_=(n=t.sliderProps)!==null&&n!==void 0?n:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=q(null),this.view=new ou(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const s=new bt(this.view.knobElement);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,n;const s=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("min"),i=(n=this.sliderProps_)===null||n===void 0?void 0:n.get("max");let a=e;return s!==void 0&&(a=Math.max(a,s)),i!==void 0&&(a=Math.min(a,i)),a}onInputChange_(e){const n=e.currentTarget.value,s=this.parser_(n);G(s)||(this.value.rawValue=this.constrainValue_(s)),this.view.refresh()}onInputKeyDown_(e){const t=de(this.props.get("keyScale"),an(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){de(this.props.get("keyScale"),an(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("pointerScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const ar=B("sld");class au{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(ar()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(ar("t")),t.viewProps.bindTabIndex(n),this.element.appendChild(n),this.trackElement=n;const s=e.createElement("div");s.classList.add(ar("k")),this.trackElement.appendChild(s),this.knobElement=s,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=ee($(this.value.rawValue,this.props_.get("min"),this.props_.get("max"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}}class lu{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new au(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new bt(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){e.point&&this.value.setRawValue($(ee(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("min"),this.props.get("max")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=de(this.props.get("keyScale"),Ke(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){de(this.props.get("keyScale"),Ke(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const lr=B("sldtxt");class cu{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(lr());const n=e.createElement("div");n.classList.add(lr("s")),this.sliderView_=t.sliderView,n.appendChild(this.sliderView_.element),this.element.appendChild(n);const s=e.createElement("div");s.classList.add(lr("t")),this.textView_=t.textView,s.appendChild(this.textView_.element),this.element.appendChild(s)}}class Nn{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new lu(e,{props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new gn(e,{parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new cu(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}importProps(e){return ge(e,null,t=>({max:t.required.number,min:t.required.number}),t=>{const n=this.sliderC_.props;return n.set("max",t.max),n.set("min",t.min),!0})}exportProps(){const e=this.sliderC_.props;return be(null,{max:e.get("max"),min:e.get("min")})}}function Wi(r){return{sliderProps:new M({keyScale:r.keyScale,max:r.max,min:r.min}),textProps:new M({formatter:q(r.formatter),keyScale:r.keyScale,pointerScale:q(r.pointerScale)})}}const uu={containerUnitSize:"cnt-usz"};function Yi(r){return`--${uu[r]}`}function ln(r){return Vi(r)}function tt(r){if(_r(r))return W(r,ln)}function je(r,e){if(!r)return;const t=[],n=Pi(r,e);n&&t.push(n);const s=Si(r);return s&&t.push(s),new fn(t)}function hu(r){return r?r.major===Ut.major:!1}function Xi(r){if(r==="inline"||r==="popup")return r}function bn(r,e){r.write(e)}const In=B("ckb");class pu{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(In()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("label");n.classList.add(In("l")),this.element.appendChild(n),this.labelElement=n;const s=e.createElement("input");s.classList.add(In("i")),s.type="checkbox",this.labelElement.appendChild(s),this.inputElement=s,t.viewProps.bindDisabled(this.inputElement);const i=e.createElement("div");i.classList.add(In("w")),this.labelElement.appendChild(i);const a=Hn(e,"check");i.appendChild(a),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class du{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.onLabelMouseDown_=this.onLabelMouseDown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new pu(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.labelElement.addEventListener("mousedown",this.onLabelMouseDown_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked,e.preventDefault(),e.stopPropagation()}onLabelMouseDown_(e){e.preventDefault()}}function fu(r){const e=[],t=Zr(r.options);return t&&e.push(t),new fn(e)}const mu=ue({id:"input-bool",type:"input",accept:(r,e)=>{if(typeof r!="boolean")return null;const t=W(e,n=>({options:n.optional.custom(vn),readonly:n.optional.constant(!1)}));return t?{initialValue:r,params:t}:null},binding:{reader:r=>qi,constraint:r=>fu(r.params),writer:r=>bn},controller:r=>{const e=r.document,t=r.value,n=r.constraint,s=n&&Bn(n,mn);return s?new ot(e,{props:new M({options:s.values.value("options")}),value:t,viewProps:r.viewProps}):new du(e,{value:t,viewProps:r.viewProps})},api(r){return typeof r.controller.value.rawValue!="boolean"?null:r.controller.valueController instanceof ot?new Yr(r.controller):null}}),ut=B("col");class vu{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ut()),t.foldable.bindExpandedClass(this.element,ut(void 0,"expanded")),Be(t.foldable,"completed",Bt(this.element,ut(void 0,"cpl")));const n=e.createElement("div");n.classList.add(ut("h")),this.element.appendChild(n);const s=e.createElement("div");s.classList.add(ut("s")),n.appendChild(s),this.swatchElement=s;const i=e.createElement("div");if(i.classList.add(ut("t")),n.appendChild(i),this.textElement=i,t.pickerLayout==="inline"){const a=e.createElement("div");a.classList.add(ut("p")),this.element.appendChild(a),this.pickerElement=a}else this.pickerElement=null}}function gu(r,e,t){const n=ee(r/255,0,1),s=ee(e/255,0,1),i=ee(t/255,0,1),a=Math.max(n,s,i),o=Math.min(n,s,i),l=a-o;let u=0,c=0;const h=(o+a)/2;return l!==0&&(c=l/(1-Math.abs(a+o-1)),n===a?u=(s-i)/l:s===a?u=2+(i-n)/l:u=4+(n-s)/l,u=u/6+(u<0?1:0)),[u*360,c*100,h*100]}function bu(r,e,t){const n=(r%360+360)%360,s=ee(e/100,0,1),i=ee(t/100,0,1),a=(1-Math.abs(2*i-1))*s,o=a*(1-Math.abs(n/60%2-1)),l=i-a/2;let u,c,h;return n>=0&&n<60?[u,c,h]=[a,o,0]:n>=60&&n<120?[u,c,h]=[o,a,0]:n>=120&&n<180?[u,c,h]=[0,a,o]:n>=180&&n<240?[u,c,h]=[0,o,a]:n>=240&&n<300?[u,c,h]=[o,0,a]:[u,c,h]=[a,0,o],[(u+l)*255,(c+l)*255,(h+l)*255]}function _u(r,e,t){const n=ee(r/255,0,1),s=ee(e/255,0,1),i=ee(t/255,0,1),a=Math.max(n,s,i),o=Math.min(n,s,i),l=a-o;let u;l===0?u=0:a===n?u=60*(((s-i)/l%6+6)%6):a===s?u=60*((i-n)/l+2):u=60*((n-s)/l+4);const c=a===0?0:l/a,h=a;return[u,c*100,h*100]}function Zi(r,e,t){const n=Ei(r,360),s=ee(e/100,0,1),i=ee(t/100,0,1),a=i*s,o=a*(1-Math.abs(n/60%2-1)),l=i-a;let u,c,h;return n>=0&&n<60?[u,c,h]=[a,o,0]:n>=60&&n<120?[u,c,h]=[o,a,0]:n>=120&&n<180?[u,c,h]=[0,a,o]:n>=180&&n<240?[u,c,h]=[0,o,a]:n>=240&&n<300?[u,c,h]=[o,0,a]:[u,c,h]=[a,0,o],[(u+l)*255,(c+l)*255,(h+l)*255]}function wu(r,e,t){const n=t+e*(100-Math.abs(2*t-100))/200;return[r,n!==0?e*(100-Math.abs(2*t-100))/n:0,t+e*(100-Math.abs(2*t-100))/200]}function xu(r,e,t){const n=100-Math.abs(t*(200-e)/100-100);return[r,n!==0?e*t/n:0,t*(200-e)/200]}function Ue(r){return[r[0],r[1],r[2]]}function Wn(r,e){return[r[0],r[1],r[2],e]}const yu={hsl:{hsl:(r,e,t)=>[r,e,t],hsv:wu,rgb:bu},hsv:{hsl:xu,hsv:(r,e,t)=>[r,e,t],rgb:Zi},rgb:{hsl:gu,hsv:_u,rgb:(r,e,t)=>[r,e,t]}};function Lt(r,e){return[e==="float"?1:r==="rgb"?255:360,e==="float"?1:r==="rgb"?255:100,e==="float"?1:r==="rgb"?255:100]}function ku(r,e){return r===e?e:Ei(r,e)}function Qi(r,e,t){var n;const s=Lt(e,t);return[e==="rgb"?ee(r[0],0,s[0]):ku(r[0],s[0]),ee(r[1],0,s[1]),ee(r[2],0,s[2]),ee((n=r[3])!==null&&n!==void 0?n:1,0,1)]}function Ns(r,e,t,n){const s=Lt(e,t),i=Lt(e,n);return r.map((a,o)=>a/s[o]*i[o])}function Ji(r,e,t){const n=Ns(r,e.mode,e.type,"int"),s=yu[e.mode][t.mode](...n);return Ns(s,t.mode,"int",t.type)}class U{static black(){return new U([0,0,0],"rgb")}constructor(e,t){this.type="int",this.mode=t,this.comps_=Qi(e,t,this.type)}getComponents(e){return Wn(Ji(Ue(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const Qe=B("colp");class Cu{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add(Qe()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(Qe("hsv"));const s=e.createElement("div");s.classList.add(Qe("sv")),this.svPaletteView_=t.svPaletteView,s.appendChild(this.svPaletteView_.element),n.appendChild(s);const i=e.createElement("div");i.classList.add(Qe("h")),this.hPaletteView_=t.hPaletteView,i.appendChild(this.hPaletteView_.element),n.appendChild(i),this.element.appendChild(n);const a=e.createElement("div");if(a.classList.add(Qe("rgb")),this.textsView_=t.textsView,a.appendChild(this.textsView_.element),this.element.appendChild(a),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const o=e.createElement("div");o.classList.add(Qe("a"));const l=e.createElement("div");l.classList.add(Qe("ap")),l.appendChild(this.alphaViews_.palette.element),o.appendChild(l);const u=e.createElement("div");u.classList.add(Qe("at")),u.appendChild(this.alphaViews_.text.element),o.appendChild(u),this.element.appendChild(o)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textsView_.modeSelectElement,...this.textsView_.inputViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}}function Eu(r){return r==="int"?"int":r==="float"?"float":void 0}function Qr(r){return W(r,e=>({color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(Eu)}),expanded:e.optional.boolean,picker:e.optional.custom(Xi),readonly:e.optional.constant(!1)}))}function ft(r){return r?.1:1}function eo(r){var e;return(e=r.color)===null||e===void 0?void 0:e.type}class Jr{constructor(e,t){this.type="float",this.mode=t,this.comps_=Qi(e,t,this.type)}getComponents(e){return Wn(Ji(Ue(this.comps_),{mode:this.mode,type:this.type},{mode:e??this.mode,type:this.type}),this.comps_[3])}toRgbaObject(){const e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}}}const Iu={int:(r,e)=>new U(r,e),float:(r,e)=>new Jr(r,e)};function es(r,e,t){return Iu[t](r,e)}function Tu(r){return r.type==="float"}function Pu(r){return r.type==="int"}function Su(r){const e=r.getComponents(),t=Lt(r.mode,"int");return new U([Math.round($(e[0],0,1,0,t[0])),Math.round($(e[1],0,1,0,t[1])),Math.round($(e[2],0,1,0,t[2])),e[3]],r.mode)}function Au(r){const e=r.getComponents(),t=Lt(r.mode,"int");return new Jr([$(e[0],0,t[0],0,1),$(e[1],0,t[1],0,1),$(e[2],0,t[2],0,1),e[3]],r.mode)}function le(r,e){if(r.type===e)return r;if(Pu(r)&&e==="float")return Au(r);if(Tu(r)&&e==="int")return Su(r);throw X.shouldNeverHappen()}function Vu(r,e){return r.alpha===e.alpha&&r.mode===e.mode&&r.notation===e.notation&&r.type===e.type}function we(r,e){const t=r.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(r),e)}const Lu={deg:r=>r,grad:r=>r*360/400,rad:r=>r*360/(2*Math.PI),turn:r=>r*360};function to(r){const e=r.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(r);const t=parseFloat(e[1]),n=e[2];return Lu[n](t)}function no(r){const e=r.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[we(e[1],255),we(e[2],255),we(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function Du(r){const e=no(r);return e?new U(e,"rgb"):null}function ro(r){const e=r.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[we(e[1],255),we(e[2],255),we(e[3],255),we(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function Mu(r){const e=ro(r);return e?new U(e,"rgb"):null}function so(r){const e=r.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[to(e[1]),we(e[2],100),we(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function Ou(r){const e=so(r);return e?new U(e,"hsl"):null}function io(r){const e=r.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[to(e[1]),we(e[2],100),we(e[3],100),we(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function Bu(r){const e=io(r);return e?new U(e,"hsl"):null}function oo(r){const e=r.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=r.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function Uu(r){const e=oo(r);return e?new U(e,"rgb"):null}function ao(r){const e=r.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),$(parseInt(e[4]+e[4],16),0,255,0,1)];const t=r.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),$(parseInt(t[4],16),0,255,0,1)]:null}function Nu(r){const e=ao(r);return e?new U(e,"rgb"):null}function lo(r){const e=r.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function Fu(r){return e=>{const t=lo(e);return t?es(t,"rgb",r):null}}function co(r){const e=r.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function $u(r){return e=>{const t=co(e);return t?es(t,"rgb",r):null}}const zu=[{parser:oo,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:ao,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:no,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:ro,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:so,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:io,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:lo,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:co,result:{alpha:!0,mode:"rgb",notation:"object"}}];function Ru(r){return zu.reduce((e,{parser:t,result:n})=>e||(t(r)?n:null),null)}function Gu(r,e="int"){const t=Ru(r);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}function _n(r){const e=[Uu,Nu,Du,Mu,Ou,Bu];e.push(Fu("int"),$u("int"));const t=ru(e);return n=>{const s=t(n);return s?le(s,r):null}}function ju(r){const e=_n("int");if(typeof r!="string")return U.black();const t=e(r);return t??U.black()}function uo(r){const e=ee(Math.floor(r),0,255).toString(16);return e.length===1?`0${e}`:e}function ts(r,e="#"){const t=Ue(r.getComponents("rgb")).map(uo).join("");return`${e}${t}`}function ns(r,e="#"){const t=r.getComponents("rgb"),n=[t[0],t[1],t[2],t[3]*255].map(uo).join("");return`${e}${n}`}function ho(r){const e=fe(0),t=le(r,"int");return`rgb(${Ue(t.getComponents("rgb")).map(s=>e(s)).join(", ")})`}function Sn(r){const e=fe(2),t=fe(0);return`rgba(${le(r,"int").getComponents("rgb").map((i,a)=>(a===3?e:t)(i)).join(", ")})`}function qu(r){const e=[fe(0),Un,Un],t=le(r,"int");return`hsl(${Ue(t.getComponents("hsl")).map((s,i)=>e[i](s)).join(", ")})`}function Hu(r){const e=[fe(0),Un,Un,fe(2)];return`hsla(${le(r,"int").getComponents("hsl").map((s,i)=>e[i](s)).join(", ")})`}function po(r,e){const t=fe(e==="float"?2:0),n=["r","g","b"],s=le(r,e);return`{${Ue(s.getComponents("rgb")).map((a,o)=>`${n[o]}: ${t(a)}`).join(", ")}}`}function Ku(r){return e=>po(e,r)}function fo(r,e){const t=fe(2),n=fe(e==="float"?2:0),s=["r","g","b","a"];return`{${le(r,e).getComponents("rgb").map((o,l)=>{const u=l===3?t:n;return`${s[l]}: ${u(o)}`}).join(", ")}}`}function Wu(r){return e=>fo(e,r)}const Yu=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:ts},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:ns},{format:{alpha:!1,mode:"rgb",notation:"func",type:"int"},stringifier:ho},{format:{alpha:!0,mode:"rgb",notation:"func",type:"int"},stringifier:Sn},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:qu},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:Hu},...["int","float"].reduce((r,e)=>[...r,{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:Ku(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:Wu(e)}],[])];function mo(r){return Yu.reduce((e,t)=>e||(Vu(t.format,r)?t.stringifier:null),null)}const Wt=B("apl");class Xu{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Wt()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(Wt("b")),this.element.appendChild(n);const s=e.createElement("div");s.classList.add(Wt("c")),n.appendChild(s),this.colorElem_=s;const i=e.createElement("div");i.classList.add(Wt("m")),this.element.appendChild(i),this.markerElem_=i;const a=e.createElement("div");a.classList.add(Wt("p")),this.markerElem_.appendChild(a),this.previewElem_=a,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),n=new U([t[0],t[1],t[2],0],"rgb"),s=new U([t[0],t[1],t[2],255],"rgb"),i=["to right",Sn(n),Sn(s)];this.colorElem_.style.background=`linear-gradient(${i.join(",")})`,this.previewElem_.style.backgroundColor=Sn(e);const a=$(t[3],0,1,0,100);this.markerElem_.style.left=`${a}%`}onValueChange_(){this.update_()}}class Zu{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Xu(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new bt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=e.point.x/e.bounds.width,s=this.value.rawValue,[i,a,o]=s.getComponents("hsv");this.value.setRawValue(new U([i,a,o,n],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=de(ft(!0),Ke(e));if(t===0)return;const n=this.value.rawValue,[s,i,a,o]=n.getComponents("hsv");this.value.setRawValue(new U([s,i,a,o+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){de(ft(!0),Ke(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const xt=B("coltxt");function Qu(r){const e=r.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"},{text:"HEX",value:"hex"}];return e.appendChild(t.reduce((n,s)=>{const i=r.createElement("option");return i.textContent=s.text,i.value=s.value,n.appendChild(i),n},r.createDocumentFragment())),e}class Ju{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(xt()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(xt("m")),this.modeElem_=Qu(e),this.modeElem_.classList.add(xt("ms")),n.appendChild(this.modeSelectElement),t.viewProps.bindDisabled(this.modeElem_);const s=e.createElement("div");s.classList.add(xt("mm")),s.appendChild(Hn(e,"dropdown")),n.appendChild(s),this.element.appendChild(n);const i=e.createElement("div");i.classList.add(xt("w")),this.element.appendChild(i),this.inputsElem_=i,this.inputViews_=t.inputViews,this.applyInputViews_(),qe(t.mode,a=>{this.modeElem_.value=a})}get modeSelectElement(){return this.modeElem_}get inputViews(){return this.inputViews_}set inputViews(e){this.inputViews_=e,this.applyInputViews_()}applyInputViews_(){Mi(this.inputsElem_);const e=this.element.ownerDocument;this.inputViews_.forEach(t=>{const n=e.createElement("div");n.classList.add(xt("c")),n.appendChild(t.element),this.inputsElem_.appendChild(n)})}}function eh(r){return fe(r==="float"?2:0)}function th(r,e,t){const n=Lt(r,e)[t];return new hn({min:0,max:n})}function nh(r,e,t){return new gn(r,{arrayPosition:t===0?"fst":t===2?"lst":"mid",parser:e.parser,props:M.fromObject({formatter:eh(e.colorType),keyScale:ft(!1),pointerScale:e.colorType==="float"?.01:1}),value:q(0,{constraint:th(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}function rh(r,e){const t={colorMode:e.colorMode,colorType:e.colorType,parser:He,viewProps:e.viewProps};return[0,1,2].map(n=>{const s=nh(r,t,n);return Ft({primary:e.value,secondary:s.value,forward(i){return le(i,e.colorType).getComponents(e.colorMode)[n]},backward(i,a){const o=e.colorMode,u=le(i,e.colorType).getComponents(o);u[n]=a;const c=es(Wn(Ue(u),u[3]),o,e.colorType);return le(c,"int")}}),s})}function sh(r,e){const t=new on(r,{parser:_n("int"),props:M.fromObject({formatter:ts}),value:q(U.black()),viewProps:e.viewProps});return Ft({primary:e.value,secondary:t.value,forward:n=>new U(Ue(n.getComponents()),n.mode),backward:(n,s)=>new U(Wn(Ue(s.getComponents(n.mode)),n.getComponents()[3]),n.mode)}),[t]}function ih(r){return r!=="hex"}class oh{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=q(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new Ju(e,{mode:this.colorMode,inputViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view],viewProps:this.viewProps}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t=this.colorMode.rawValue;return ih(t)?rh(e,{colorMode:t,colorType:this.colorType_,value:this.value,viewProps:this.viewProps}):sh(e,{value:this.value,viewProps:this.viewProps})}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.inputViews=this.ccs_.map(n=>n.view)}}const cr=B("hpl");class ah{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(cr()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(cr("c")),this.element.appendChild(n);const s=e.createElement("div");s.classList.add(cr("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=ho(new U([t,100,100],"hsv"));const n=$(t,0,360,0,100);this.markerElem_.style.left=`${n}%`}onValueChange_(){this.update_()}}class lh{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new ah(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new bt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=$(ee(e.point.x,0,e.bounds.width),0,e.bounds.width,0,360),s=this.value.rawValue,[,i,a,o]=s.getComponents("hsv");this.value.setRawValue(new U([n,i,a,o],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=de(ft(!1),Ke(e));if(t===0)return;const n=this.value.rawValue,[s,i,a,o]=n.getComponents("hsv");this.value.setRawValue(new U([s+t,i,a,o],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){de(ft(!1),Ke(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const ur=B("svp"),Fs=64;class ch{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(ur()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const n=e.createElement("canvas");n.height=Fs,n.width=Fs,n.classList.add(ur("c")),this.element.appendChild(n),this.canvasElement=n;const s=e.createElement("div");s.classList.add(ur("m")),this.element.appendChild(s),this.markerElem_=s,this.update_()}update_(){const e=lc(this.canvasElement);if(!e)return;const n=this.value.rawValue.getComponents("hsv"),s=this.canvasElement.width,i=this.canvasElement.height,a=e.getImageData(0,0,s,i),o=a.data;for(let c=0;c<i;c++)for(let h=0;h<s;h++){const m=$(h,0,s,0,100),f=$(c,0,i,100,0),w=Zi(n[0],m,f),k=(c*s+h)*4;o[k]=w[0],o[k+1]=w[1],o[k+2]=w[2],o[k+3]=255}e.putImageData(a,0,0);const l=$(n[1],0,100,0,100);this.markerElem_.style.left=`${l}%`;const u=$(n[2],0,100,100,0);this.markerElem_.style.top=`${u}%`}onValueChange_(){this.update_()}}class uh{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new ch(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new bt(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=$(e.point.x,0,e.bounds.width,0,100),s=$(e.point.y,0,e.bounds.height,100,0),[i,,,a]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new U([i,n,s,a],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){Ki(e.key)&&e.preventDefault();const[t,n,s,i]=this.value.rawValue.getComponents("hsv"),a=ft(!1),o=de(a,Ke(e)),l=de(a,an(e));o===0&&l===0||this.value.setRawValue(new U([t,n+o,s+l,i],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=ft(!1),n=de(t,Ke(e)),s=de(t,an(e));n===0&&s===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class hh{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new lh(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new uh(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new Zu(e,{value:this.value,viewProps:this.viewProps}),text:new gn(e,{parser:He,props:M.fromObject({pointerScale:.01,keyScale:.1,formatter:fe(2)}),value:q(0,{constraint:new hn({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Ft({primary:this.value,secondary:this.alphaIcs_.text.value,forward:n=>n.getComponents()[3],backward:(n,s)=>{const i=n.getComponents();return i[3]=s,new U(i,n.mode)}}),this.textsC_=new oh(e,{colorType:t.colorType,value:this.value,viewProps:this.viewProps}),this.view=new Cu(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textsView:this.textsC_.view,viewProps:this.viewProps})}get textsController(){return this.textsC_}}const hr=B("colsw");class ph{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(hr()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(hr("sw")),this.element.appendChild(n),this.swatchElem_=n;const s=e.createElement("button");s.classList.add(hr("b")),t.viewProps.bindDisabled(s),this.element.appendChild(s),this.buttonElement=s,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=ns(e)}onValueChange_(){this.update_()}}class dh{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new ph(e,{value:this.value,viewProps:this.viewProps})}}class rs{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=dn.create(t.expanded),this.swatchC_=new dh(e,{value:this.value,viewProps:this.viewProps});const n=this.swatchC_.view.buttonElement;n.addEventListener("blur",this.onButtonBlur_),n.addEventListener("click",this.onButtonClick_),this.textC_=new on(e,{parser:t.parser,props:M.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new vu(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new ji(e,{viewProps:this.viewProps}):null;const s=new hh(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});s.view.allFocusableElements.forEach(i=>{i.addEventListener("blur",this.onPopupChildBlur_),i.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=s,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(s.view.element),Ft({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:i=>i,backward:(i,a)=>a})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Wr(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,n=e.relatedTarget;(!n||!t.contains(n))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,n=Oi(e);n&&t.contains(n)||n&&n===this.swatchC_.view.buttonElement&&!Rr(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function fh(r){return Ue(r.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function mh(r){return r.getComponents("rgb").reduce((e,t,n)=>{const s=Math.floor(n===3?t*255:t)&255;return e<<8|s},0)>>>0}function vh(r){return new U([r>>16&255,r>>8&255,r&255],"rgb")}function gh(r){return new U([r>>24&255,r>>16&255,r>>8&255,$(r&255,0,255,0,1)],"rgb")}function bh(r){return typeof r!="number"?U.black():vh(r)}function _h(r){return typeof r!="number"?U.black():gh(r)}function An(r,e){return typeof r!="object"||G(r)?!1:e in r&&typeof r[e]=="number"}function vo(r){return An(r,"r")&&An(r,"g")&&An(r,"b")}function go(r){return vo(r)&&An(r,"a")}function bo(r){return vo(r)}function ss(r,e){if(r.mode!==e.mode||r.type!==e.type)return!1;const t=r.getComponents(),n=e.getComponents();for(let s=0;s<t.length;s++)if(t[s]!==n[s])return!1;return!0}function $s(r){return"a"in r?[r.r,r.g,r.b,r.a]:[r.r,r.g,r.b]}function wh(r){const e=mo(r);return e?(t,n)=>{bn(t,e(n))}:null}function xh(r){const e=r?mh:fh;return(t,n)=>{bn(t,e(n))}}function yh(r,e,t){const s=le(e,t).toRgbaObject();r.writeProperty("r",s.r),r.writeProperty("g",s.g),r.writeProperty("b",s.b),r.writeProperty("a",s.a)}function kh(r,e,t){const s=le(e,t).toRgbaObject();r.writeProperty("r",s.r),r.writeProperty("g",s.g),r.writeProperty("b",s.b)}function Ch(r,e){return(t,n)=>{r?yh(t,n,e):kh(t,n,e)}}function Eh(r){var e;return!!(!((e=r?.color)===null||e===void 0)&&e.alpha)}function Ih(r){return r?e=>ns(e,"0x"):e=>ts(e,"0x")}function Th(r){return"color"in r||r.view==="color"}const Ph=ue({id:"input-color-number",type:"input",accept:(r,e)=>{if(typeof r!="number"||!Th(e))return null;const t=Qr(e);return t?{initialValue:r,params:Object.assign(Object.assign({},t),{supportsAlpha:Eh(e)})}:null},binding:{reader:r=>r.params.supportsAlpha?_h:bh,equals:ss,writer:r=>xh(r.params.supportsAlpha)},controller:r=>{var e,t;return new rs(r.document,{colorType:"int",expanded:(e=r.params.expanded)!==null&&e!==void 0?e:!1,formatter:Ih(r.params.supportsAlpha),parser:_n("int"),pickerLayout:(t=r.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:r.params.supportsAlpha,value:r.value,viewProps:r.viewProps})}});function Sh(r,e){if(!bo(r))return le(U.black(),e);if(e==="int"){const t=$s(r);return new U(t,"rgb")}if(e==="float"){const t=$s(r);return new Jr(t,"rgb")}return le(U.black(),"int")}function Ah(r){return go(r)}function Vh(r){return e=>{const t=Sh(e,r);return le(t,"int")}}function Lh(r,e){return t=>r?fo(t,e):po(t,e)}const Dh=ue({id:"input-color-object",type:"input",accept:(r,e)=>{var t;if(!bo(r))return null;const n=Qr(e);return n?{initialValue:r,params:Object.assign(Object.assign({},n),{colorType:(t=eo(e))!==null&&t!==void 0?t:"int"})}:null},binding:{reader:r=>Vh(r.params.colorType),equals:ss,writer:r=>Ch(Ah(r.initialValue),r.params.colorType)},controller:r=>{var e,t;const n=go(r.initialValue);return new rs(r.document,{colorType:r.params.colorType,expanded:(e=r.params.expanded)!==null&&e!==void 0?e:!1,formatter:Lh(n,r.params.colorType),parser:_n("int"),pickerLayout:(t=r.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:n,value:r.value,viewProps:r.viewProps})}}),Mh=ue({id:"input-color-string",type:"input",accept:(r,e)=>{if(typeof r!="string"||e.view==="text")return null;const t=Gu(r,eo(e));if(!t)return null;const n=mo(t);if(!n)return null;const s=Qr(e);return s?{initialValue:r,params:Object.assign(Object.assign({},s),{format:t,stringifier:n})}:null},binding:{reader:()=>ju,equals:ss,writer:r=>{const e=wh(r.params.format);if(!e)throw X.notBindable();return e}},controller:r=>{var e,t;return new rs(r.document,{colorType:r.params.format.type,expanded:(e=r.params.expanded)!==null&&e!==void 0?e:!1,formatter:r.params.stringifier,parser:_n("int"),pickerLayout:(t=r.params.picker)!==null&&t!==void 0?t:"popup",supportsAlpha:r.params.format.alpha,value:r.value,viewProps:r.viewProps})}});class is{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((n,s)=>{var i,a;return(a=(i=this.components[s])===null||i===void 0?void 0:i.constrain(n))!==null&&a!==void 0?a:n});return this.asm_.fromComponents(t)}}const zs=B("pndtxt");class Oh{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(zs()),this.textViews.forEach(n=>{const s=e.createElement("div");s.classList.add(zs("a")),s.appendChild(n.element),this.element.appendChild(s)})}}function Bh(r,e,t){return new gn(r,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",parser:e.parser,props:e.axes[t].textProps,value:q(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}class os{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((n,s)=>Bh(e,t,s)),this.acs_.forEach((n,s)=>{Ft({primary:this.value,secondary:n.value,forward:i=>t.assembly.toComponents(i)[s],backward:(i,a)=>{const o=t.assembly.toComponents(i);return o[s]=a,t.assembly.fromComponents(o)}})}),this.view=new Oh(e,{textViews:this.acs_.map(n=>n.view)})}get textControllers(){return this.acs_}}class Uh extends sn{get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}}function Nh(r,e){const t=[],n=Pi(r,e);n&&t.push(n);const s=Si(r);s&&t.push(s);const i=Zr(r.options);return i&&t.push(i),new fn(t)}const Fh=ue({id:"input-number",type:"input",accept:(r,e)=>{if(typeof r!="number")return null;const t=W(e,n=>Object.assign(Object.assign({},Vi(n)),{options:n.optional.custom(vn),readonly:n.optional.constant(!1)}));return t?{initialValue:r,params:t}:null},binding:{reader:r=>Ci,constraint:r=>Nh(r.params,r.initialValue),writer:r=>bn},controller:r=>{const e=r.value,t=r.constraint,n=t&&Bn(t,mn);if(n)return new ot(r.document,{props:new M({options:n.values.value("options")}),value:e,viewProps:r.viewProps});const s=Ai(r.params,e.rawValue),i=t&&Bn(t,hn);return i?new Nn(r.document,Object.assign(Object.assign({},Wi(Object.assign(Object.assign({},s),{keyScale:q(s.keyScale),max:i.values.value("max"),min:i.values.value("min")}))),{parser:He,value:e,viewProps:r.viewProps})):new gn(r.document,{parser:He,props:M.fromObject(s),value:e,viewProps:r.viewProps})},api(r){return typeof r.controller.value.rawValue!="number"?null:r.controller.valueController instanceof Nn?new Uh(r.controller):r.controller.valueController instanceof ot?new Yr(r.controller):null}});class rt{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(G(e))return!1;const t=e.x,n=e.y;return!(typeof t!="number"||typeof n!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}}const _o={toComponents:r=>r.getComponents(),fromComponents:r=>new rt(...r)},yt=B("p2d");class $h{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(yt()),t.viewProps.bindClassModifiers(this.element),qe(t.expanded,Bt(this.element,yt(void 0,"expanded")));const n=e.createElement("div");n.classList.add(yt("h")),this.element.appendChild(n);const s=e.createElement("button");s.classList.add(yt("b")),s.appendChild(Hn(e,"p2dpad")),t.viewProps.bindDisabled(s),n.appendChild(s),this.buttonElement=s;const i=e.createElement("div");if(i.classList.add(yt("t")),n.appendChild(i),this.textElement=i,t.pickerLayout==="inline"){const a=e.createElement("div");a.classList.add(yt("p")),this.element.appendChild(a),this.pickerElement=a}else this.pickerElement=null}}const Je=B("p2dp");class zh{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onPropsChange_=this.onPropsChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onPropsChange_),this.element=e.createElement("div"),this.element.classList.add(Je()),t.layout==="popup"&&this.element.classList.add(Je(void 0,"p")),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(Je("p")),t.viewProps.bindTabIndex(n),this.element.appendChild(n),this.padElement=n;const s=e.createElementNS(Me,"svg");s.classList.add(Je("g")),this.padElement.appendChild(s),this.svgElem_=s;const i=e.createElementNS(Me,"line");i.classList.add(Je("ax")),i.setAttributeNS(null,"x1","0"),i.setAttributeNS(null,"y1","50%"),i.setAttributeNS(null,"x2","100%"),i.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(i);const a=e.createElementNS(Me,"line");a.classList.add(Je("ax")),a.setAttributeNS(null,"x1","50%"),a.setAttributeNS(null,"y1","0"),a.setAttributeNS(null,"x2","50%"),a.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(a);const o=e.createElementNS(Me,"line");o.classList.add(Je("l")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(o),this.lineElem_=o;const l=e.createElement("div");l.classList.add(Je("m")),this.padElement.appendChild(l),this.markerElem_=l,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),n=this.props_.get("max"),s=$(e,-n,+n,0,100),i=$(t,-n,+n,0,100),a=this.props_.get("invertsY")?100-i:i;this.lineElem_.setAttributeNS(null,"x2",`${s}%`),this.lineElem_.setAttributeNS(null,"y2",`${a}%`),this.markerElem_.style.left=`${s}%`,this.markerElem_.style.top=`${a}%`}onValueChange_(){this.update_()}onPropsChange_(){this.update_()}onFoldableChange_(){this.update_()}}function Rs(r,e,t){return[de(e[0],Ke(r)),de(e[1],an(r))*(t?1:-1)]}class Rh{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new zh(e,{layout:t.layout,props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new bt(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=this.props.get("max"),s=$(e.point.x,0,e.bounds.width,-n,+n),i=$(this.props.get("invertsY")?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-n,+n);this.value.setRawValue(new rt(s,i),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){Ki(e.key)&&e.preventDefault();const[t,n]=Rs(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&n===0||this.value.setRawValue(new rt(this.value.rawValue.x+t,this.value.rawValue.y+n),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,n]=Rs(e,[this.props.get("xKeyScale"),this.props.get("yKeyScale")],this.props.get("invertsY"));t===0&&n===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Gh{constructor(e,t){var n,s;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=dn.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new ji(e,{viewProps:this.viewProps}):null;const i=new Rh(e,{layout:t.pickerLayout,props:new M({invertsY:q(t.invertsY),max:q(t.max),xKeyScale:t.axes[0].textProps.value("keyScale"),yKeyScale:t.axes[1].textProps.value("keyScale")}),value:this.value,viewProps:this.viewProps});i.view.allFocusableElements.forEach(a=>{a.addEventListener("blur",this.onPopupChildBlur_),a.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=i,this.textC_=new os(e,{assembly:_o,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new $h(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(n=this.view.buttonElement)===null||n===void 0||n.addEventListener("blur",this.onPadButtonBlur_),(s=this.view.buttonElement)===null||s===void 0||s.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Ft({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:a=>a,backward:(a,o)=>o})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),Wr(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,n=e.relatedTarget;(!n||!t.contains(n))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,n=Oi(e);n&&t.contains(n)||n&&n===this.view.buttonElement&&!Rr(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}}function jh(r){return rt.isObject(r)?new rt(r.x,r.y):new rt}function qh(r,e){r.writeProperty("x",e.x),r.writeProperty("y",e.y)}function Hh(r,e){return new is({assembly:_o,components:[je(Object.assign(Object.assign({},r),r.x),e.x),je(Object.assign(Object.assign({},r),r.y),e.y)]})}function Gs(r,e){var t,n;if(!G(r.min)||!G(r.max))return Math.max(Math.abs((t=r.min)!==null&&t!==void 0?t:0),Math.abs((n=r.max)!==null&&n!==void 0?n:0));const s=Ii(r);return Math.max(Math.abs(s)*10,Math.abs(e)*10)}function Kh(r,e){var t,n;const s=Gs(pt(r,(t=r.x)!==null&&t!==void 0?t:{}),e.x),i=Gs(pt(r,(n=r.y)!==null&&n!==void 0?n:{}),e.y);return Math.max(s,i)}function Wh(r){if(!("y"in r))return!1;const e=r.y;return e&&"inverted"in e?!!e.inverted:!1}const Yh=ue({id:"input-point2d",type:"input",accept:(r,e)=>{if(!rt.isObject(r))return null;const t=W(e,n=>Object.assign(Object.assign({},ln(n)),{expanded:n.optional.boolean,picker:n.optional.custom(Xi),readonly:n.optional.constant(!1),x:n.optional.custom(tt),y:n.optional.object(Object.assign(Object.assign({},ln(n)),{inverted:n.optional.boolean}))}));return t?{initialValue:r,params:t}:null},binding:{reader:()=>jh,constraint:r=>Hh(r.params,r.initialValue),equals:rt.equals,writer:()=>qh},controller:r=>{var e,t;const n=r.document,s=r.value,i=r.constraint,a=[r.params.x,r.params.y];return new Gh(n,{axes:s.rawValue.getComponents().map((o,l)=>{var u;return zr({constraint:i.components[l],initialValue:o,params:pt(r.params,(u=a[l])!==null&&u!==void 0?u:{})})}),expanded:(e=r.params.expanded)!==null&&e!==void 0?e:!1,invertsY:Wh(r.params),max:Kh(r.params,s.rawValue),parser:He,pickerLayout:(t=r.params.picker)!==null&&t!==void 0?t:"popup",value:s,viewProps:r.viewProps})}});class At{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(G(e))return!1;const t=e.x,n=e.y,s=e.z;return!(typeof t!="number"||typeof n!="number"||typeof s!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const wo={toComponents:r=>r.getComponents(),fromComponents:r=>new At(...r)};function Xh(r){return At.isObject(r)?new At(r.x,r.y,r.z):new At}function Zh(r,e){r.writeProperty("x",e.x),r.writeProperty("y",e.y),r.writeProperty("z",e.z)}function Qh(r,e){return new is({assembly:wo,components:[je(Object.assign(Object.assign({},r),r.x),e.x),je(Object.assign(Object.assign({},r),r.y),e.y),je(Object.assign(Object.assign({},r),r.z),e.z)]})}const Jh=ue({id:"input-point3d",type:"input",accept:(r,e)=>{if(!At.isObject(r))return null;const t=W(e,n=>Object.assign(Object.assign({},ln(n)),{readonly:n.optional.constant(!1),x:n.optional.custom(tt),y:n.optional.custom(tt),z:n.optional.custom(tt)}));return t?{initialValue:r,params:t}:null},binding:{reader:r=>Xh,constraint:r=>Qh(r.params,r.initialValue),equals:At.equals,writer:r=>Zh},controller:r=>{const e=r.value,t=r.constraint,n=[r.params.x,r.params.y,r.params.z];return new os(r.document,{assembly:wo,axes:e.rawValue.getComponents().map((s,i)=>{var a;return zr({constraint:t.components[i],initialValue:s,params:pt(r.params,(a=n[i])!==null&&a!==void 0?a:{})})}),parser:He,value:e,viewProps:r.viewProps})}});class Vt{constructor(e=0,t=0,n=0,s=0){this.x=e,this.y=t,this.z=n,this.w=s}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(G(e))return!1;const t=e.x,n=e.y,s=e.z,i=e.w;return!(typeof t!="number"||typeof n!="number"||typeof s!="number"||typeof i!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const xo={toComponents:r=>r.getComponents(),fromComponents:r=>new Vt(...r)};function ep(r){return Vt.isObject(r)?new Vt(r.x,r.y,r.z,r.w):new Vt}function tp(r,e){r.writeProperty("x",e.x),r.writeProperty("y",e.y),r.writeProperty("z",e.z),r.writeProperty("w",e.w)}function np(r,e){return new is({assembly:xo,components:[je(Object.assign(Object.assign({},r),r.x),e.x),je(Object.assign(Object.assign({},r),r.y),e.y),je(Object.assign(Object.assign({},r),r.z),e.z),je(Object.assign(Object.assign({},r),r.w),e.w)]})}const rp=ue({id:"input-point4d",type:"input",accept:(r,e)=>{if(!Vt.isObject(r))return null;const t=W(e,n=>Object.assign(Object.assign({},ln(n)),{readonly:n.optional.constant(!1),w:n.optional.custom(tt),x:n.optional.custom(tt),y:n.optional.custom(tt),z:n.optional.custom(tt)}));return t?{initialValue:r,params:t}:null},binding:{reader:r=>ep,constraint:r=>np(r.params,r.initialValue),equals:Vt.equals,writer:r=>tp},controller:r=>{const e=r.value,t=r.constraint,n=[r.params.x,r.params.y,r.params.z,r.params.w];return new os(r.document,{assembly:xo,axes:e.rawValue.getComponents().map((s,i)=>{var a;return zr({constraint:t.components[i],initialValue:s,params:pt(r.params,(a=n[i])!==null&&a!==void 0?a:{})})}),parser:He,value:e,viewProps:r.viewProps})}});function sp(r){const e=[],t=Zr(r.options);return t&&e.push(t),new fn(e)}const ip=ue({id:"input-string",type:"input",accept:(r,e)=>{if(typeof r!="string")return null;const t=W(e,n=>({readonly:n.optional.constant(!1),options:n.optional.custom(vn)}));return t?{initialValue:r,params:t}:null},binding:{reader:r=>Hi,constraint:r=>sp(r.params),writer:r=>bn},controller:r=>{const e=r.document,t=r.value,n=r.constraint,s=n&&Bn(n,mn);return s?new ot(e,{props:new M({options:s.values.value("options")}),value:t,viewProps:r.viewProps}):new on(e,{parser:i=>i,props:M.fromObject({formatter:Cr}),value:t,viewProps:r.viewProps})},api(r){return typeof r.controller.value.rawValue!="string"?null:r.controller.valueController instanceof ot?new Yr(r.controller):null}}),wn={monitor:{defaultInterval:200,defaultRows:3}},js=B("mll");class op{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(js()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("textarea");n.classList.add(js("i")),n.style.height=`calc(var(${Yi("containerUnitSize")}) * ${t.rows})`,n.readOnly=!0,t.viewProps.bindDisabled(n),this.element.appendChild(n),this.textareaElem_=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,n=[];this.value.rawValue.forEach(s=>{s!==void 0&&n.push(this.formatter_(s))}),e.textContent=n.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}}class as{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new op(e,{formatter:t.formatter,rows:t.rows,value:this.value,viewProps:this.viewProps})}}const qs=B("sgl");class ap{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(qs()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("input");n.classList.add(qs("i")),n.readOnly=!0,n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}}class ls{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new ap(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}}const lp=ue({id:"monitor-bool",type:"monitor",accept:(r,e)=>{if(typeof r!="boolean")return null;const t=W(e,n=>({readonly:n.required.constant(!0),rows:n.optional.number}));return t?{initialValue:r,params:t}:null},binding:{reader:r=>qi},controller:r=>{var e;return r.value.rawValue.length===1?new ls(r.document,{formatter:Us,value:r.value,viewProps:r.viewProps}):new as(r.document,{formatter:Us,rows:(e=r.params.rows)!==null&&e!==void 0?e:wn.monitor.defaultRows,value:r.value,viewProps:r.viewProps})}});class cp extends sn{get max(){return this.controller.valueController.props.get("max")}set max(e){this.controller.valueController.props.set("max",e)}get min(){return this.controller.valueController.props.get("min")}set min(e){this.controller.valueController.props.set("min",e)}}const et=B("grl");class up{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(et()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const n=e.createElementNS(Me,"svg");n.classList.add(et("g")),n.style.height=`calc(var(${Yi("containerUnitSize")}) * ${t.rows})`,this.element.appendChild(n),this.svgElem_=n;const s=e.createElementNS(Me,"polyline");this.svgElem_.appendChild(s),this.lineElem_=s;const i=e.createElement("div");i.classList.add(et("t"),B("tt")()),this.element.appendChild(i),this.tooltipElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const{clientWidth:e,clientHeight:t}=this.element,n=this.value.rawValue.length-1,s=this.props_.get("min"),i=this.props_.get("max"),a=[];this.value.rawValue.forEach((h,m)=>{if(h===void 0)return;const f=$(m,0,n,0,e),w=$(h,s,i,t,0);a.push([f,w].join(","))}),this.lineElem_.setAttributeNS(null,"points",a.join(" "));const o=this.tooltipElem_,l=this.value.rawValue[this.cursor_.rawValue];if(l===void 0){o.classList.remove(et("t","a"));return}const u=$(this.cursor_.rawValue,0,n,0,e),c=$(l,s,i,t,0);o.style.left=`${u}px`,o.style.top=`${c}px`,o.textContent=`${this.formatter_(l)}`,o.classList.contains(et("t","a"))||(o.classList.add(et("t","a"),et("t","in")),On(o),o.classList.remove(et("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class yo{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=q(-1),this.view=new up(e,{cursor:this.cursor_,formatter:t.formatter,rows:t.rows,props:this.props,value:this.value,viewProps:this.viewProps}),!Rr(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const n=new bt(this.view.element);n.emitter.on("down",this.onGraphPointerDown_),n.emitter.on("move",this.onGraphPointerMove_),n.emitter.on("up",this.onGraphPointerUp_)}}importProps(e){return ge(e,null,t=>({max:t.required.number,min:t.required.number}),t=>(this.props.set("max",t.max),this.props.set("min",t.min),!0))}exportProps(){return be(null,{max:this.props.get("max"),min:this.props.get("min")})}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const{clientWidth:t}=this.view.element;this.cursor_.rawValue=Math.floor($(e.offsetX,0,t,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor($(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function Er(r){return G(r.format)?fe(2):r.format}function hp(r){var e;return r.value.rawValue.length===1?new ls(r.document,{formatter:Er(r.params),value:r.value,viewProps:r.viewProps}):new as(r.document,{formatter:Er(r.params),rows:(e=r.params.rows)!==null&&e!==void 0?e:wn.monitor.defaultRows,value:r.value,viewProps:r.viewProps})}function pp(r){var e,t,n;return new yo(r.document,{formatter:Er(r.params),rows:(e=r.params.rows)!==null&&e!==void 0?e:wn.monitor.defaultRows,props:M.fromObject({max:(t=r.params.max)!==null&&t!==void 0?t:100,min:(n=r.params.min)!==null&&n!==void 0?n:0}),value:r.value,viewProps:r.viewProps})}function Hs(r){return r.view==="graph"}const dp=ue({id:"monitor-number",type:"monitor",accept:(r,e)=>{if(typeof r!="number")return null;const t=W(e,n=>({format:n.optional.function,max:n.optional.number,min:n.optional.number,readonly:n.required.constant(!0),rows:n.optional.number,view:n.optional.string}));return t?{initialValue:r,params:t}:null},binding:{defaultBufferSize:r=>Hs(r)?64:1,reader:r=>Ci},controller:r=>Hs(r.params)?pp(r):hp(r),api:r=>r.controller.valueController instanceof yo?new cp(r.controller):null}),fp=ue({id:"monitor-string",type:"monitor",accept:(r,e)=>{if(typeof r!="string")return null;const t=W(e,n=>({multiline:n.optional.boolean,readonly:n.required.constant(!0),rows:n.optional.number}));return t?{initialValue:r,params:t}:null},binding:{reader:r=>Hi},controller:r=>{var e;const t=r.value;return t.rawValue.length>1||r.params.multiline?new as(r.document,{formatter:Cr,rows:(e=r.params.rows)!==null&&e!==void 0?e:wn.monitor.defaultRows,value:t,viewProps:r.viewProps}):new ls(r.document,{formatter:Cr,value:t,viewProps:r.viewProps})}});class mp{constructor(){this.map_=new Map}get(e){var t;return(t=this.map_.get(e))!==null&&t!==void 0?t:null}has(e){return this.map_.has(e)}add(e,t){return this.map_.set(e,t),e.viewProps.handleDispose(()=>{this.map_.delete(e)}),t}}class vp{constructor(e){this.target=e.target,this.reader_=e.reader,this.writer_=e.writer}read(){return this.reader_(this.target.read())}write(e){this.writer_(this.target,e)}inject(e){this.write(this.reader_(e))}}function gp(r,e){var t;const n=r.accept(e.target.read(),e.params);if(G(n))return null;const s={target:e.target,initialValue:n.initialValue,params:n.params},i=W(e.params,h=>({disabled:h.optional.boolean,hidden:h.optional.boolean,label:h.optional.string,tag:h.optional.string})),a=r.binding.reader(s),o=r.binding.constraint?r.binding.constraint(s):void 0,l=new vp({reader:a,target:e.target,writer:r.binding.writer(s)}),u=new ec(q(a(n.initialValue),{constraint:o,equals:r.binding.equals}),l),c=r.controller({constraint:o,document:e.document,initialValue:n.initialValue,params:n.params,value:u,viewProps:Ye.create({disabled:i?.disabled,hidden:i?.hidden})});return new mc(e.document,{blade:Nt(),props:M.fromObject({label:"label"in e.params?(t=i?.label)!==null&&t!==void 0?t:null:e.target.key}),tag:i?.tag,value:u,valueController:c})}class bp{constructor(e){this.target=e.target,this.reader_=e.reader}read(){return this.reader_(this.target.read())}}function _p(r,e){return e===0?new Zc:new Qc(r,e??wn.monitor.defaultInterval)}function wp(r,e){var t,n,s;const i=r.accept(e.target.read(),e.params);if(G(i))return null;const a={target:e.target,initialValue:i.initialValue,params:i.params},o=W(e.params,m=>({bufferSize:m.optional.number,disabled:m.optional.boolean,hidden:m.optional.boolean,interval:m.optional.number,label:m.optional.string})),l=r.binding.reader(a),u=(n=(t=o?.bufferSize)!==null&&t!==void 0?t:r.binding.defaultBufferSize&&r.binding.defaultBufferSize(i.params))!==null&&n!==void 0?n:1,c=new wc({binding:new bp({reader:l,target:e.target}),bufferSize:u,ticker:_p(e.document,o?.interval)}),h=r.controller({document:e.document,params:i.params,value:c,viewProps:Ye.create({disabled:o?.disabled,hidden:o?.hidden})});return h.viewProps.bindDisabled(c.ticker),h.viewProps.handleDispose(()=>{c.ticker.dispose()}),new yc(e.document,{blade:Nt(),props:M.fromObject({label:"label"in e.params?(s=o?.label)!==null&&s!==void 0?s:null:e.target.key}),value:c,valueController:h})}class xp{constructor(e){this.pluginsMap_={blades:[],inputs:[],monitors:[]},this.apiCache_=e}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(e,t){if(!hu(t.core))throw X.notCompatible(e,t.id);t.type==="blade"?this.pluginsMap_.blades.unshift(t):t.type==="input"?this.pluginsMap_.inputs.unshift(t):t.type==="monitor"&&this.pluginsMap_.monitors.unshift(t)}createInput_(e,t,n){return this.pluginsMap_.inputs.reduce((s,i)=>s??gp(i,{document:e,target:t,params:n}),null)}createMonitor_(e,t,n){return this.pluginsMap_.monitors.reduce((s,i)=>s??wp(i,{document:e,params:n,target:t}),null)}createBinding(e,t,n){const s=t.read();if(G(s))throw new X({context:{key:t.key},type:"nomatchingcontroller"});const i=this.createInput_(e,t,n);if(i)return i;const a=this.createMonitor_(e,t,n);if(a)return a;throw new X({context:{key:t.key},type:"nomatchingcontroller"})}createBlade(e,t){const n=this.pluginsMap_.blades.reduce((s,i)=>s??Xc(i,{document:e,params:t}),null);if(!n)throw new X({type:"nomatchingview",context:{params:t}});return n}createInputBindingApi_(e){const t=this.pluginsMap_.inputs.reduce((n,s)=>{var i,a;return n||((a=(i=s.api)===null||i===void 0?void 0:i.call(s,{controller:e}))!==null&&a!==void 0?a:null)},null);return this.apiCache_.add(e,t??new sn(e))}createMonitorBindingApi_(e){const t=this.pluginsMap_.monitors.reduce((n,s)=>{var i,a;return n||((a=(i=s.api)===null||i===void 0?void 0:i.call(s,{controller:e}))!==null&&a!==void 0?a:null)},null);return this.apiCache_.add(e,t??new sn(e))}createBindingApi(e){if(this.apiCache_.has(e))return this.apiCache_.get(e);if(vc(e))return this.createInputBindingApi_(e);if(kc(e))return this.createMonitorBindingApi_(e);throw X.shouldNeverHappen()}createApi(e){if(this.apiCache_.has(e))return this.apiCache_.get(e);if(fc(e))return this.createBindingApi(e);const t=this.pluginsMap_.blades.reduce((n,s)=>n??s.api({controller:e,pool:this}),null);if(!t)throw X.shouldNeverHappen();return this.apiCache_.add(e,t)}}const yp=new mp;function kp(){const r=new xp(yp);return[Yh,Jh,rp,ip,Fh,Mh,Dh,Ph,mu,lp,fp,dp,Pc,zc,Gi].forEach(e=>{r.register("core",e)}),r}class Cp extends gt{constructor(e){super(e),this.emitter_=new Q,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new pn(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get options(){return this.controller.valueController.props.get("options")}set options(e){this.controller.valueController.props.set("options",e)}get value(){return this.controller.value.rawValue}set value(e){this.controller.value.rawValue=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,s=>{n(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}class Ep extends gt{}class Ip extends gt{constructor(e){super(e),this.emitter_=new Q,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new pn(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get max(){return this.controller.valueController.sliderController.props.get("max")}set max(e){this.controller.valueController.sliderController.props.set("max",e)}get min(){return this.controller.valueController.sliderController.props.get("min")}set min(e){this.controller.valueController.sliderController.props.set("min",e)}get value(){return this.controller.value.rawValue}set value(e){this.controller.value.rawValue=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,s=>{n(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}class Tp extends gt{constructor(e){super(e),this.emitter_=new Q,this.controller.value.emitter.on("change",t=>{this.emitter_.emit("change",new pn(this,t.rawValue))})}get label(){return this.controller.labelController.props.get("label")}set label(e){this.controller.labelController.props.set("label",e)}get formatter(){return this.controller.valueController.props.get("formatter")}set formatter(e){this.controller.valueController.props.set("formatter",e)}get value(){return this.controller.value.rawValue}set value(e){this.controller.value.rawValue=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,s=>{n(s)},{key:t}),this}off(e,t){return this.emitter_.off(e,t),this}}const Pp=(function(){return{id:"list",type:"blade",core:Ut,accept(r){const e=W(r,t=>({options:t.required.custom(vn),value:t.required.raw,view:t.required.constant("list"),label:t.optional.string}));return e?{params:e}:null},controller(r){const e=new mn(Xr(r.params.options)),t=q(r.params.value,{constraint:e}),n=new ot(r.document,{props:new M({options:e.values.value("options")}),value:t,viewProps:r.viewProps});return new dt(r.document,{blade:r.blade,props:M.fromObject({label:r.params.label}),value:t,valueController:n})},api(r){return!(r.controller instanceof dt)||!(r.controller.valueController instanceof ot)?null:new Cp(r.controller)}}})();class Sp extends zi{constructor(e,t){super(e,t)}get element(){return this.controller.view.element}}class Ap extends yr{constructor(e,t){super(e,{expanded:t.expanded,blade:t.blade,props:t.props,root:!0,viewProps:t.viewProps})}}const Ks=B("spr");class Vp{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Ks()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("hr");n.classList.add(Ks("r")),this.element.appendChild(n)}}class Ws extends Kn{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new Vp(e,{viewProps:t.viewProps})}))}}const Lp={id:"separator",type:"blade",core:Ut,accept(r){const e=W(r,t=>({view:t.required.constant("separator")}));return e?{params:e}:null},controller(r){return new Ws(r.document,{blade:r.blade,viewProps:r.viewProps})},api(r){return r.controller instanceof Ws?new Ep(r.controller):null}},Dp={id:"slider",type:"blade",core:Ut,accept(r){const e=W(r,t=>({max:t.required.number,min:t.required.number,view:t.required.constant("slider"),format:t.optional.function,label:t.optional.string,value:t.optional.number}));return e?{params:e}:null},controller(r){var e,t;const n=(e=r.params.value)!==null&&e!==void 0?e:0,s=new hn({max:r.params.max,min:r.params.min}),i=q(n,{constraint:s}),a=new Nn(r.document,Object.assign(Object.assign({},Wi({formatter:(t=r.params.format)!==null&&t!==void 0?t:Yl,keyScale:q(1),max:s.values.value("max"),min:s.values.value("min"),pointerScale:Ti(r.params,n)})),{parser:He,value:i,viewProps:r.viewProps}));return new dt(r.document,{blade:r.blade,props:M.fromObject({label:r.params.label}),value:i,valueController:a})},api(r){return!(r.controller instanceof dt)||!(r.controller.valueController instanceof Nn)?null:new Ip(r.controller)}},Mp=(function(){return{id:"text",type:"blade",core:Ut,accept(r){const e=W(r,t=>({parse:t.required.function,value:t.required.raw,view:t.required.constant("text"),format:t.optional.function,label:t.optional.string}));return e?{params:e}:null},controller(r){var e;const t=q(r.params.value),n=new on(r.document,{parser:r.params.parse,props:M.fromObject({formatter:(e=r.params.format)!==null&&e!==void 0?e:(s=>String(s))}),value:t,viewProps:r.viewProps});return new dt(r.document,{blade:r.blade,props:M.fromObject({label:r.params.label}),value:t,valueController:n})},api(r){return!(r.controller instanceof dt)||!(r.controller.valueController instanceof on)?null:new Tp(r.controller)}}})();function Op(r){const e=r.createElement("div");return e.classList.add(B("dfw")()),r.body&&r.body.appendChild(e),e}function Bp(r,e,t){if(r.querySelector(`style[data-tp-style=${e}]`))return;const n=r.createElement("style");n.dataset.tpStyle=e,n.textContent=t,r.head.appendChild(n)}class Up extends Sp{constructor(e){var t,n;const s=e??{},i=(t=s.document)!==null&&t!==void 0?t:ac(),a=kp(),o=new Ap(i,{expanded:s.expanded,blade:Nt(),props:M.fromObject({title:s.title}),viewProps:Ye.create()});super(o,a),this.pool_=a,this.containerElem_=(n=s.container)!==null&&n!==void 0?n:Op(i),this.containerElem_.appendChild(this.element),this.doc_=i,this.usesDefaultWrapper_=!s.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw X.alreadyDisposed();return this.doc_}dispose(){const e=this.containerElem_;if(!e)throw X.alreadyDisposed();if(this.usesDefaultWrapper_){const t=e.parentElement;t&&t.removeChild(e)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(e){e.css&&Bp(this.document,`plugin-${e.id}`,e.css),("plugin"in e?[e.plugin]:"plugins"in e?e.plugins:[]).forEach(n=>{this.pool_.register(e.id,n)})}setUpDefaultPlugins_(){this.registerPlugin({id:"default",css:'.tp-tbiv_b,.tp-coltxtv_ms,.tp-colswv_b,.tp-ckbv_i,.tp-sglv_i,.tp-mllv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-rotv_b,.tp-fldv_b,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--bld-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--cnt-usz);line-height:var(--cnt-usz);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tbpv_c>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-vp))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tbpv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tbpv_c>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--cnt-usp)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tbpv_c>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tbpv_c>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tbpv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-vp)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tbpv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tbpv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tbpv_c>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tbpv_c>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--bld-br);border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tbpv_c .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--bld-br)}.tp-tbpv_c>.tp-cntv+.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-cntv+.tp-fldv>.tp-fldv_b{border-top-left-radius:0}.tp-tbpv_c>.tp-cntv+.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-cntv+.tp-tabv>.tp-tabv_t{border-top-left-radius:0}.tp-tbpv_c>.tp-tabv>.tp-tabv_t,.tp-fldv_c>.tp-tabv>.tp-tabv_t{border-top-left-radius:var(--bld-br)}.tp-tbpv_c .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--bld-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);overflow:hidden;padding-left:var(--cnt-hp);padding-right:calc(4px + var(--cnt-usz) + var(--cnt-hp));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-hp) + (var(--cnt-usz) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-vp);padding-top:var(--cnt-vp);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--cnt-usz);line-height:var(--cnt-usz);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-sglv_i,.tp-mllv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--bld-br);box-sizing:border-box;color:var(--mo-fg);height:var(--cnt-usz);scrollbar-color:currentColor rgba(0,0,0,0);scrollbar-width:thin;width:100%}.tp-sglv_i::-webkit-scrollbar,.tp-mllv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-sglv_i::-webkit-scrollbar-corner,.tp-mllv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:rgba(0,0,0,0)}.tp-sglv_i::-webkit-scrollbar-thumb,.tp-mllv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:rgba(0,0,0,0) solid 2px;border-radius:4px}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-rotv{--bs-bg: var(--tp-base-background-color, hsl(230, 7%, 17%));--bs-br: var(--tp-base-border-radius, 6px);--bs-ff: var(--tp-base-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--bld-br: var(--tp-blade-border-radius, 2px);--bld-hp: var(--tp-blade-horizontal-padding, 4px);--bld-vw: var(--tp-blade-value-width, 160px);--btn-bg: var(--tp-button-background-color, hsl(230, 7%, 70%));--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, hsl(230, 7%, 17%));--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, hsl(230, 7%, 75%));--cnt-hp: var(--tp-container-horizontal-padding, 4px);--cnt-vp: var(--tp-container-vertical-padding, 4px);--cnt-usp: var(--tp-container-unit-spacing, 4px);--cnt-usz: var(--tp-container-unit-size, 20px);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, hsl(230, 7%, 75%));--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--bld-br);cursor:pointer;display:block;height:var(--cnt-usz);position:relative;width:var(--cnt-usz)}.tp-ckbv_w svg{display:block;height:16px;inset:0;margin:auto;opacity:0;position:absolute;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--cnt-usz)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-expanded.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--cnt-usp);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--cnt-usp)}.tp-colpv_rgb{display:flex;margin-top:var(--cnt-usp);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-vp);padding-top:calc(var(--cnt-vp) + 2px);position:relative}.tp-colpv_a::before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-hp));position:absolute;right:calc(-1*var(--cnt-hp));top:0}.tp-colpv.tp-v-disabled .tp-colpv_a::before{opacity:.5}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--bld-br);outline:none;overflow:hidden;position:relative}.tp-svpv.tp-v-disabled{opacity:.5}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--cnt-usz)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative}.tp-hplv.tp-v-disabled{opacity:.5}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--cnt-usz);outline:none;position:relative;width:100%}.tp-aplv.tp-v-disabled{opacity:.5}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{inset:0;position:absolute}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--bld-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--bld-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;inset:0;position:absolute}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--bld-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{cursor:pointer;display:block;height:var(--cnt-usz);left:0;position:absolute;top:0;width:var(--cnt-usz)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--bld-br);content:"";display:block;inset:0;position:absolute}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--bld-br);color:var(--lbl-fg);cursor:pointer;height:var(--cnt-usz);line-height:var(--cnt-usz);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv.tp-v-disabled .tp-coltxtv_mm{opacity:.5}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv{position:relative}.tp-fldv_t{padding-left:4px}.tp-fldv_b:disabled .tp-fldv_m{display:none}.tp-fldv_c{padding-left:4px}.tp-fldv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-fldv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-fldv_b:hover+.tp-fldv_i{color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_i{color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_i{color:var(--cnt-bg-a)}.tp-fldv.tp-v-disabled>.tp-fldv_i{opacity:.5}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--cnt-usz)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-hp);padding-right:var(--cnt-hp)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:var(--bld-vw)}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 var(--bld-hp);width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--cnt-usz)*3);line-height:var(--cnt-usz);padding-left:var(--bld-hp);padding-right:var(--bld-hp);resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--cnt-usz);margin-right:4px;position:relative;width:var(--cnt-usz)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--cnt-usp);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-hp));right:calc(-1*var(--cnt-hp));top:var(--cnt-usz)}.tp-p2dpv{padding-left:calc(var(--cnt-usz) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv.tp-v-disabled .tp-p2dpv_p{opacity:.5}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:var(--bld-vw);padding:var(--cnt-vp) var(--cnt-hp);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--cnt-usz);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;content:"";display:block;height:2px;inset:0;margin:auto;position:absolute}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;content:"";display:block;height:2px;inset:0;margin-bottom:auto;margin-top:auto;position:absolute}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--bld-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv{position:relative}.tp-tabv_t{align-items:flex-end;color:var(--cnt-bg);display:flex;overflow:hidden;position:relative}.tp-tabv_t:hover{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus){color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active){color:var(--cnt-bg-a)}.tp-tabv_t::before{background-color:currentColor;bottom:0;content:"";height:2px;left:0;pointer-events:none;position:absolute;right:0}.tp-tabv.tp-v-disabled .tp-tabv_t::before{opacity:.5}.tp-tabv.tp-tabv-nop .tp-tabv_t{height:calc(var(--cnt-usz) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_t::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_i{bottom:0;color:var(--cnt-bg);left:0;overflow:hidden;position:absolute;top:calc(var(--cnt-usz) + 4px);width:max(var(--bs-br),4px)}.tp-tabv_i::before{background-color:currentColor;bottom:0;content:"";left:0;position:absolute;top:0;width:4px}.tp-tabv_t:hover+.tp-tabv_i{color:var(--cnt-bg-h)}.tp-tabv_t:has(*:focus)+.tp-tabv_i{color:var(--cnt-bg-f)}.tp-tabv_t:has(*:active)+.tp-tabv_i{color:var(--cnt-bg-a)}.tp-tabv.tp-v-disabled>.tp-tabv_i{opacity:.5}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv.tp-v-disabled::before{opacity:.5}.tp-tbiv_b{display:block;padding-left:calc(var(--cnt-hp) + 4px);padding-right:calc(var(--cnt-hp) + 4px);position:relative;width:100%}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_b::before{background-color:var(--cnt-bg);content:"";inset:0 0 2px;pointer-events:none;position:absolute}.tp-tbiv_b:hover::before{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus::before{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active::before{background-color:var(--cnt-bg-a)}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--cnt-usz) + 4px);line-height:calc(var(--cnt-usz) + 4px);opacity:.5;overflow:hidden;position:relative;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-tbpv_c{padding-bottom:var(--cnt-vp);padding-left:4px;padding-top:var(--cnt-vp)}.tp-txtv{position:relative}.tp-txtv_i{padding-left:var(--bld-hp);padding-right:var(--bld-hp)}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:calc(var(--bld-hp) - 5px);position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--cnt-usz) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--bld-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) rgba(0,0,0,0) rgba(0,0,0,0) rgba(0,0,0,0);border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--bs-ff);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--cnt-usz) + var(--cnt-hp));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0;transition-delay:0s;transition-duration:0s}.tp-rotv.tp-rotv-not>.tp-rotv_b{display:none}.tp-rotv_b:disabled .tp-rotv_m{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst.tp-fldv-expanded>.tp-fldv_b{transition-delay:0s;transition-duration:0s}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_i{border-bottom-left-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-vp))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_t{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sprv.tp-v-disabled .tp-sprv_r{opacity:.5}',plugins:[Pp,Lp,Dp,Gi,Mp]})}}new $i("4.0.5");const cs=(r,e)=>((r+e-1)/e|0)*e;function Np(r){return Object.keys(r)}function Fp(r,e){return new Array(r).fill(0).map((t,n)=>e(n))}const Ys=r=>ArrayBuffer.isView(r)&&!(r instanceof DataView),ko=r=>r,O=ko({i32:{numElements:1,align:4,size:4,type:"i32",View:Int32Array},u32:{numElements:1,align:4,size:4,type:"u32",View:Uint32Array},f32:{numElements:1,align:4,size:4,type:"f32",View:Float32Array},f16:{numElements:1,align:2,size:2,type:"u16",View:Uint16Array},vec2f:{numElements:2,align:8,size:8,type:"f32",View:Float32Array},vec2i:{numElements:2,align:8,size:8,type:"i32",View:Int32Array},vec2u:{numElements:2,align:8,size:8,type:"u32",View:Uint32Array},vec2h:{numElements:2,align:4,size:4,type:"u16",View:Uint16Array},vec3i:{numElements:3,align:16,size:12,type:"i32",View:Int32Array},vec3u:{numElements:3,align:16,size:12,type:"u32",View:Uint32Array},vec3f:{numElements:3,align:16,size:12,type:"f32",View:Float32Array},vec3h:{numElements:3,align:8,size:6,type:"u16",View:Uint16Array},vec4i:{numElements:4,align:16,size:16,type:"i32",View:Int32Array},vec4u:{numElements:4,align:16,size:16,type:"u32",View:Uint32Array},vec4f:{numElements:4,align:16,size:16,type:"f32",View:Float32Array},vec4h:{numElements:4,align:8,size:8,type:"u16",View:Uint16Array},mat2x2f:{numElements:4,align:8,size:16,type:"f32",View:Float32Array},mat2x2h:{numElements:4,align:4,size:8,type:"u16",View:Uint16Array},mat3x2f:{numElements:6,align:8,size:24,type:"f32",View:Float32Array},mat3x2h:{numElements:6,align:4,size:12,type:"u16",View:Uint16Array},mat4x2f:{numElements:8,align:8,size:32,type:"f32",View:Float32Array},mat4x2h:{numElements:8,align:4,size:16,type:"u16",View:Uint16Array},mat2x3f:{numElements:8,align:16,size:32,pad:[3,1],type:"f32",View:Float32Array},mat2x3h:{numElements:8,align:8,size:16,pad:[3,1],type:"u16",View:Uint16Array},mat3x3f:{numElements:12,align:16,size:48,pad:[3,1],type:"f32",View:Float32Array},mat3x3h:{numElements:12,align:8,size:24,pad:[3,1],type:"u16",View:Uint16Array},mat4x3f:{numElements:16,align:16,size:64,pad:[3,1],type:"f32",View:Float32Array},mat4x3h:{numElements:16,align:8,size:32,pad:[3,1],type:"u16",View:Uint16Array},mat2x4f:{numElements:8,align:16,size:32,type:"f32",View:Float32Array},mat2x4h:{numElements:8,align:8,size:16,type:"u16",View:Uint16Array},mat3x4f:{numElements:12,align:16,size:48,pad:[3,1],type:"f32",View:Float32Array},mat3x4h:{numElements:12,align:8,size:24,pad:[3,1],type:"u16",View:Uint16Array},mat4x4f:{numElements:16,align:16,size:64,type:"f32",View:Float32Array},mat4x4h:{numElements:16,align:8,size:32,type:"u16",View:Uint16Array},bool:{numElements:0,align:1,size:0,type:"bool",View:Uint32Array}}),$t=ko({...O,"atomic<i32>":O.i32,"atomic<u32>":O.u32,"vec2<i32>":O.vec2i,"vec2<u32>":O.vec2u,"vec2<f32>":O.vec2f,"vec2<f16>":O.vec2h,"vec3<i32>":O.vec3i,"vec3<u32>":O.vec3u,"vec3<f32>":O.vec3f,"vec3<f16>":O.vec3h,"vec4<i32>":O.vec4i,"vec4<u32>":O.vec4u,"vec4<f32>":O.vec4f,"vec4<f16>":O.vec4h,"mat2x2<f32>":O.mat2x2f,"mat2x2<f16>":O.mat2x2h,"mat3x2<f32>":O.mat3x2f,"mat3x2<f16>":O.mat3x2h,"mat4x2<f32>":O.mat4x2f,"mat4x2<f16>":O.mat4x2h,"mat2x3<f32>":O.mat2x3f,"mat2x3<f16>":O.mat2x3h,"mat3x3<f32>":O.mat3x3f,"mat3x3<f16>":O.mat3x3h,"mat4x3<f32>":O.mat4x3f,"mat4x3<f16>":O.mat4x3h,"mat2x4<f32>":O.mat2x4f,"mat2x4<f16>":O.mat2x4h,"mat3x4<f32>":O.mat3x4f,"mat3x4<f16>":O.mat3x4h,"mat4x4<f32>":O.mat4x4f,"mat4x4<f16>":O.mat4x4h}),$p=Np($t);function zp(r=[],e){const t=new Set;for(const n of $p){const s=$t[n];t.has(s)||(t.add(s),s.flatten=r.includes(n)?e:!e)}}zp();function Rp(r){const e=r;if(e.elementType)return e.size;{const n=r,s=e.numElements||1;if(n.fields)return r.size*s;{const i=r,{align:a}=$t[i.type];return s>1?cs(r.size,a)*s:r.size}}}function Xs(r,e,t,n){const{size:s,type:i}=r;try{const{View:a,align:o,size:l}=$t[i],u=n!==void 0,c=u?cs(s,o):l,h=c/a.BYTES_PER_ELEMENT,m=u?n===0?(e.byteLength-t)/c:n:1;return new a(e,t,h*m)}catch{throw new Error(`unknown type: ${i}`)}}function Gp(r){return!r.fields&&!r.elementType}function jp(r,e,t){const n=t||0,s=new ArrayBuffer(Rp(r)),i=(a,o)=>{const l=a,u=l.elementType;if(u){if(Gp(u)&&$t[u.type].flatten)return Xs(u,s,o,l.numElements);{const{size:c}=Co(a),h=l.numElements===0?(s.byteLength-o)/c:l.numElements;return Fp(h,m=>i(u,o+c*m))}}else{if(typeof a=="string")throw Error("unreachable");{const c=a.fields;if(c){const h={};for(const[m,{type:f,offset:w}]of Object.entries(c))h[m]=i(f,o+w);return h}else return Xs(a,s,o)}}};return{views:i(r,n),arrayBuffer:s}}function Ir(r,e){if(r!==void 0)if(Ys(e)){const t=e;if(t.length===1&&typeof r=="number")t[0]=r;else if(Array.isArray(r[0])||Ys(r[0])){const n=r[0].length,s=n===3?4:n;for(let i=0;i<r.length;++i){const a=i*s;t.set(r[i],a)}}else t.set(r)}else if(Array.isArray(e)){const t=e;r.forEach((n,s)=>{Ir(n,t[s])})}else{const t=e;for(const[n,s]of Object.entries(r)){const i=t[n];i&&Ir(s,i)}}}function It(r,e,t=0){const n=r,s=n.group===void 0?r:n.typeDefinition,i=jp(s,e,t);return{...i,set(a){Ir(a,i.views)}}}function Tr(r){const t=r.elementType;if(t)return Tr(t);const s=r.fields;if(s)return Object.values(s).reduce((o,{type:l})=>Math.max(o,Tr(l)),0);const{type:i}=r,{align:a}=$t[i];return a}function Co(r){const t=r.elementType;if(t){const i=t.size,a=Tr(t);return{unalignedSize:i,align:a,size:cs(i,a)}}const s=r.fields;if(s){const i=Object.values(s).pop();if(i.type.size===0)return Co(i.type)}return{size:0,unalignedSize:0,align:1}}class xe{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class Zs{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class nt extends xe{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class st extends xe{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class Pr extends xe{constructor(e,t,n){super(e,n),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class mt extends xe{constructor(e,t,n,s){super(e,n),this.format=t,this.access=s}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var te;(r=>{r[r.Uniform=0]="Uniform",r[r.Storage=1]="Storage",r[r.Texture=2]="Texture",r[r.Sampler=3]="Sampler",r[r.StorageTexture=4]="StorageTexture"})(te||(te={}));class Tn{constructor(e,t,n,s,i,a,o){this.name=e,this.type=t,this.group=n,this.binding=s,this.attributes=i,this.resourceType=a,this.access=o}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class qp{constructor(e,t){this.name=e,this.type=t}}class Hp{constructor(e,t,n,s){this.name=e,this.type=t,this.locationType=n,this.location=s,this.interpolation=null}}class Qs{constructor(e,t,n,s){this.name=e,this.type=t,this.locationType=n,this.location=s}}class Kp{constructor(e,t,n,s){this.name=e,this.type=t,this.attributes=n,this.id=s}}class Wp{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n}}class Yp{constructor(e,t=null,n){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=n}}class Xp{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}const Eo=new Float32Array(1),Zp=new Int32Array(Eo.buffer),se=new Uint16Array(1);function Qp(r){Eo[0]=r;const e=Zp[0],t=e>>31&1;let n=e>>23&255,s=8388607&e;if(n===255)return se[0]=t<<15|31744|(s!==0?512:0),se[0];if(n===0){if(s===0)return se[0]=t<<15,se[0];s|=8388608;let i=113;for(;!(8388608&s);)s<<=1,i--;return n=127-i,s&=8388607,n>0?(s=(s>>126-n)+(s>>127-n&1),se[0]=t<<15|n<<10|s>>13,se[0]):(se[0]=t<<15,se[0])}return n=n-127+15,n>=31?(se[0]=t<<15|31744,se[0]):n<=0?n<-10?(se[0]=t<<15,se[0]):(s=(8388608|s)>>1-n,se[0]=t<<15|s>>13,se[0]):(s>>=13,se[0]=t<<15|n<<10|s,se[0])}const us=new Uint32Array(1),Io=new Float32Array(us.buffer,0,1);function Js(r){const e=112+(r>>6&31)<<23|(63&r)<<17;return us[0]=e,Io[0]}function Jp(r,e,t,n,s,i,a,o,l){const u=n*(a>>=s)*(i>>=s)+t*a+e*o;switch(l){case"r8unorm":return[N(r,u,"8unorm",1)[0]];case"r8snorm":return[N(r,u,"8snorm",1)[0]];case"r8uint":return[N(r,u,"8uint",1)[0]];case"r8sint":return[N(r,u,"8sint",1)[0]];case"rg8unorm":{const c=N(r,u,"8unorm",2);return[c[0],c[1]]}case"rg8snorm":{const c=N(r,u,"8snorm",2);return[c[0],c[1]]}case"rg8uint":{const c=N(r,u,"8uint",2);return[c[0],c[1]]}case"rg8sint":{const c=N(r,u,"8sint",2);return[c[0],c[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const c=N(r,u,"8unorm",4);return[c[0],c[1],c[2],c[3]]}case"rgba8snorm":{const c=N(r,u,"8snorm",4);return[c[0],c[1],c[2],c[3]]}case"rgba8uint":{const c=N(r,u,"8uint",4);return[c[0],c[1],c[2],c[3]]}case"rgba8sint":{const c=N(r,u,"8sint",4);return[c[0],c[1],c[2],c[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const c=N(r,u,"8unorm",4);return[c[2],c[1],c[0],c[3]]}case"r16uint":return[N(r,u,"16uint",1)[0]];case"r16sint":return[N(r,u,"16sint",1)[0]];case"r16float":return[N(r,u,"16float",1)[0]];case"rg16uint":{const c=N(r,u,"16uint",2);return[c[0],c[1]]}case"rg16sint":{const c=N(r,u,"16sint",2);return[c[0],c[1]]}case"rg16float":{const c=N(r,u,"16float",2);return[c[0],c[1]]}case"rgba16uint":{const c=N(r,u,"16uint",4);return[c[0],c[1],c[2],c[3]]}case"rgba16sint":{const c=N(r,u,"16sint",4);return[c[0],c[1],c[2],c[3]]}case"rgba16float":{const c=N(r,u,"16float",4);return[c[0],c[1],c[2],c[3]]}case"r32uint":return[N(r,u,"32uint",1)[0]];case"r32sint":return[N(r,u,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[N(r,u,"32float",1)[0]];case"rg32uint":{const c=N(r,u,"32uint",2);return[c[0],c[1]]}case"rg32sint":{const c=N(r,u,"32sint",2);return[c[0],c[1]]}case"rg32float":{const c=N(r,u,"32float",2);return[c[0],c[1]]}case"rgba32uint":{const c=N(r,u,"32uint",4);return[c[0],c[1],c[2],c[3]]}case"rgba32sint":{const c=N(r,u,"32sint",4);return[c[0],c[1],c[2],c[3]]}case"rgba32float":{const c=N(r,u,"32float",4);return[c[0],c[1],c[2],c[3]]}case"rg11b10ufloat":{const c=new Uint32Array(r.buffer,u,1)[0],h=(4192256&c)>>11,m=(4290772992&c)>>22;return[Js(2047&c),Js(h),(function(f){const w=112+(f>>5&31)<<23|(31&f)<<18;return us[0]=w,Io[0]})(m),1]}}return null}function N(r,e,t,n){const s=[0,0,0,0];for(let u=0;u<n;++u)switch(t){case"8unorm":s[u]=r[e]/255,e++;break;case"8snorm":s[u]=r[e]/255*2-1,e++;break;case"8uint":s[u]=r[e],e++;break;case"8sint":s[u]=r[e]-127,e++;break;case"16uint":s[u]=r[e]|r[e+1]<<8,e+=2;break;case"16sint":s[u]=(r[e]|r[e+1]<<8)-32768,e+=2;break;case"16float":s[u]=(i=r[e]|r[e+1]<<8,a=void 0,o=void 0,l=void 0,a=(32768&i)>>15,l=1023&i,(o=(31744&i)>>10)==0?(a?-1:1)*Math.pow(2,-14)*(l/Math.pow(2,10)):o==31?l?NaN:1/0*(a?-1:1):(a?-1:1)*Math.pow(2,o-15)*(1+l/Math.pow(2,10))),e+=2;break;case"32uint":case"32sint":s[u]=r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24,e+=4;break;case"32float":s[u]=new Float32Array(r.buffer,e,1)[0],e+=4}var i,a,o,l;return s}function F(r,e,t,n,s){for(let i=0;i<n;++i)switch(t){case"8unorm":r[e]=255*s[i],e++;break;case"8snorm":r[e]=.5*(s[i]+1)*255,e++;break;case"8uint":r[e]=s[i],e++;break;case"8sint":r[e]=s[i]+127,e++;break;case"16uint":new Uint16Array(r.buffer,e,1)[0]=s[i],e+=2;break;case"16sint":new Int16Array(r.buffer,e,1)[0]=s[i],e+=2;break;case"16float":{const a=Qp(s[i]);new Uint16Array(r.buffer,e,1)[0]=a,e+=2;break}case"32uint":new Uint32Array(r.buffer,e,1)[0]=s[i],e+=4;break;case"32sint":new Int32Array(r.buffer,e,1)[0]=s[i],e+=4;break;case"32float":new Float32Array(r.buffer,e,1)[0]=s[i],e+=4}return s}const pr={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class ke{constructor(){this.id=ke._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(Fn.instance);for(const n of e)n instanceof Array?this.searchBlock(n,t):n.search(t);t($n.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}ke._id=0;class Fn extends ke{}Fn.instance=new Fn;class $n extends ke{}$n.instance=new $n;const To=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class H extends ke{constructor(){super()}}class cn extends H{constructor(e,t,n,s,i,a){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=n,this.body=s,this.startLine=i,this.endLine=a}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class ed extends H{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class Po extends H{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class Sr extends H{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class So extends H{constructor(e,t,n,s){super(),this.init=e,this.condition=t,this.increment=n,this.body=s}get astNodeType(){return"for"}search(e){var t,n,s;(t=this.init)===null||t===void 0||t.search(e),(n=this.condition)===null||n===void 0||n.search(e),(s=this.increment)===null||s===void 0||s.search(e),this.searchBlock(this.body,e)}}class Ge extends H{constructor(e,t,n,s,i){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=s,this.value=i}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class hs extends H{constructor(e,t,n){super(),this.attributes=null,this.name=e,this.type=t,this.value=n}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class Jt extends H{constructor(e,t,n,s,i){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=s,this.value=i}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class Vn extends H{constructor(e,t,n,s,i){super(),this.attributes=null,this.name=e,this.type=t,this.storage=n,this.access=s,this.value=i}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}var Tt,Xt,x,g;(r=>{r.increment="++",r.decrement="--"})(Tt||(Tt={})),(r=>{r.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return r[t]}})(Tt||(Tt={}));class Ao extends H{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(r=>{r.assign="=",r.addAssign="+=",r.subtractAssin="-=",r.multiplyAssign="*=",r.divideAssign="/=",r.moduloAssign="%=",r.andAssign="&=",r.orAssign="|=",r.xorAssign="^=",r.shiftLeftAssign="<<=",r.shiftRightAssign=">>="})(Xt||(Xt={})),(r=>{r.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(Xt||(Xt={}));class Vo extends H{constructor(e,t,n){super(),this.operator=e,this.variable=t,this.value=n}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class ps extends H{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return To.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class Lo extends H{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}}class Do extends H{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}}class Mo extends H{constructor(e,t,n,s){super(),this.condition=e,this.body=t,this.elseif=n,this.else=s}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class Oo extends H{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class td extends H{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class nd extends H{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class Bo extends H{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class ds extends H{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class rd extends H{constructor(){super()}get astNodeType(){return"discard"}}class Uo extends H{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class No extends H{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class C extends H{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let n=1;n<e.length;++n){const s=C._priority.get(t.name);C._priority.get(e[n].name)<s&&(t=e[n])}return t.name==="x32"?C.i32:t}getTypeName(){return this.name}}C.x32=new C("x32"),C.f32=new C("f32"),C.i32=new C("i32"),C.u32=new C("u32"),C.f16=new C("f16"),C.bool=new C("bool"),C.void=new C("void"),C._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class ei extends C{constructor(e){super(e)}}class ze extends C{constructor(e,t,n,s){super(e),this.members=t,this.startLine=n,this.endLine=s}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class _ extends C{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}_.vec2f=new _("vec2",C.f32,null),_.vec3f=new _("vec3",C.f32,null),_.vec4f=new _("vec4",C.f32,null),_.vec2i=new _("vec2",C.i32,null),_.vec3i=new _("vec3",C.i32,null),_.vec4i=new _("vec4",C.i32,null),_.vec2u=new _("vec2",C.u32,null),_.vec3u=new _("vec3",C.u32,null),_.vec4u=new _("vec4",C.u32,null),_.vec2h=new _("vec2",C.f16,null),_.vec3h=new _("vec3",C.f16,null),_.vec4h=new _("vec4",C.f16,null),_.vec2b=new _("vec2",C.bool,null),_.vec3b=new _("vec3",C.bool,null),_.vec4b=new _("vec4",C.bool,null),_.mat2x2f=new _("mat2x2",C.f32,null),_.mat2x3f=new _("mat2x3",C.f32,null),_.mat2x4f=new _("mat2x4",C.f32,null),_.mat3x2f=new _("mat3x2",C.f32,null),_.mat3x3f=new _("mat3x3",C.f32,null),_.mat3x4f=new _("mat3x4",C.f32,null),_.mat4x2f=new _("mat4x2",C.f32,null),_.mat4x3f=new _("mat4x3",C.f32,null),_.mat4x4f=new _("mat4x4",C.f32,null),_.mat2x2h=new _("mat2x2",C.f16,null),_.mat2x3h=new _("mat2x3",C.f16,null),_.mat2x4h=new _("mat2x4",C.f16,null),_.mat3x2h=new _("mat3x2",C.f16,null),_.mat3x3h=new _("mat3x3",C.f16,null),_.mat3x4h=new _("mat3x4",C.f16,null),_.mat4x2h=new _("mat4x2",C.f16,null),_.mat4x3h=new _("mat4x3",C.f16,null),_.mat4x4h=new _("mat4x4",C.f16,null),_.mat2x2i=new _("mat2x2",C.i32,null),_.mat2x3i=new _("mat2x3",C.i32,null),_.mat2x4i=new _("mat2x4",C.i32,null),_.mat3x2i=new _("mat3x2",C.i32,null),_.mat3x3i=new _("mat3x3",C.i32,null),_.mat3x4i=new _("mat3x4",C.i32,null),_.mat4x2i=new _("mat4x2",C.i32,null),_.mat4x3i=new _("mat4x3",C.i32,null),_.mat4x4i=new _("mat4x4",C.i32,null),_.mat2x2u=new _("mat2x2",C.u32,null),_.mat2x3u=new _("mat2x3",C.u32,null),_.mat2x4u=new _("mat2x4",C.u32,null),_.mat3x2u=new _("mat3x2",C.u32,null),_.mat3x3u=new _("mat3x3",C.u32,null),_.mat3x4u=new _("mat3x4",C.u32,null),_.mat4x2u=new _("mat4x2",C.u32,null),_.mat4x3u=new _("mat4x3",C.u32,null),_.mat4x4u=new _("mat4x4",C.u32,null);class Ln extends C{constructor(e,t,n,s){super(e),this.storage=t,this.type=n,this.access=s}get astNodeType(){return"pointer"}}class en extends C{constructor(e,t,n,s){super(e),this.attributes=t,this.format=n,this.count=s}get astNodeType(){return"array"}get isArray(){return!0}}class Zt extends C{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"sampler"}}class Pe extends ke{constructor(){super(),this.postfix=null}}class vt extends Pe{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class De extends Pe{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class fs extends Pe{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return To.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class ve extends Pe{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class Fo extends Pe{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const n=e.evalExpression(this.initializer,e.context);return n!==null&&this.postfix?n.getSubData(e,this.postfix,e.context):n}return null}search(e){this.initializer.search(e)}}class J extends Pe{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof v}get isVector(){return this.value instanceof d||this.value instanceof V}get scalarValue(){return this.value instanceof v?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof d||this.value instanceof V?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class $o extends Pe{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class Dt extends Pe{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class zo extends Pe{constructor(){super()}}class Z extends zo{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Te extends zo{constructor(e,t,n){super(),this.operator=e,this.left=t,this.right=n}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?C.f32:e.name==="u32"||t.name==="u32"?C.u32:C.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class Ro extends ke{constructor(e){super(),this.body=e}}class Dn extends Pe{constructor(){super()}get astNodeType(){return"default"}}class Go extends Ro{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class jo extends Ro{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class ti extends ke{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"argument"}}class sd extends ke{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class ni extends ke{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"member"}}class qo extends ke{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class ye{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=ye._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,n,s){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,n){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}ye._id=0;class Ar extends ye{constructor(){super(new xe("void",null),null)}toString(){return"void"}}Ar.void=new Ar;class kt extends ye{constructor(e){super(new Pr("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,n,s){this.reference.setDataValue(e,t,n,s)}getSubData(e,t,n){return t?this.reference.getSubData(e,t,n):this}toString(){return`&${this.reference.toString()}`}}class v extends ye{constructor(e,t,n=null){super(t,n),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!=0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new v(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new v(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new v(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,n,s){if(n)return void console.error("SetDataValue: Scalar data does not support postfix",n);if(!(t instanceof v))return void console.error("SetDataValue: Invalid value",t);let i=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?i=Math.floor(i):this.typeInfo.name==="bool"&&(i=i?1:0),this.data[0]=i}getSubData(e,t,n){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function id(r,e,t){const n=e.length;return n===2?t==="f32"?new d(new Float32Array(e),r.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new d(new Int32Array(e),r.getTypeInfo("vec2i")):t==="u32"?new d(new Uint32Array(e),r.getTypeInfo("vec2u")):t==="f16"?new d(new Float32Array(e),r.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):n===3?t==="f32"?new d(new Float32Array(e),r.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new d(new Int32Array(e),r.getTypeInfo("vec3i")):t==="u32"?new d(new Uint32Array(e),r.getTypeInfo("vec3u")):t==="f16"?new d(new Float32Array(e),r.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):n===4?t==="f32"?new d(new Float32Array(e),r.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new d(new Int32Array(e),r.getTypeInfo("vec4i")):t==="u32"?new d(new Uint32Array(e),r.getTypeInfo("vec4u")):t==="f16"?new d(new Float32Array(e),r.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class d extends ye{constructor(e,t,n=null){if(super(t,n),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const s=this.typeInfo.name;s==="vec2f"||s==="vec3f"||s==="vec4f"?this.data=new Float32Array(e):s==="vec2i"||s==="vec3i"||s==="vec4i"?this.data=new Int32Array(e):s==="vec2u"||s==="vec3u"||s==="vec4u"?this.data=new Uint32Array(e):s==="vec2h"||s==="vec3h"||s==="vec4h"?this.data=new Float32Array(e):s==="vec2b"||s==="vec3b"||s==="vec4b"?this.data=new Int32Array(e):s==="vec2"||s==="vec3"||s==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${s}`)}}clone(){if(this.data instanceof Float32Array)return new d(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new d(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new d(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,n,s){n instanceof vt?console.error("TODO: Set vector postfix"):t instanceof d?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,n){if(t===null)return this;let s=e.getTypeInfo("f32");if(this.typeInfo instanceof mt)s=this.typeInfo.format||s;else{const a=this.typeInfo.name;a==="vec2f"||a==="vec3f"||a==="vec4f"?s=e.getTypeInfo("f32"):a==="vec2i"||a==="vec3i"||a==="vec4i"?s=e.getTypeInfo("i32"):a==="vec2b"||a==="vec3b"||a==="vec4b"?s=e.getTypeInfo("bool"):a==="vec2u"||a==="vec3u"||a==="vec4u"?s=e.getTypeInfo("u32"):a==="vec2h"||a==="vec3h"||a==="vec4h"?s=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${a}`)}let i=this;for(;t!==null&&i!==null;){if(t instanceof Dt){const a=t.index;let o=-1;if(a instanceof J){if(!(a.value instanceof v))return console.error(`GetSubData: Invalid array index ${a.value}`),null;o=a.value.value}else{const l=e.evalExpression(a,n);if(!(l instanceof v))return console.error("GetSubData: Unknown index type",a),null;o=l.value}if(o<0||o>=i.data.length)return console.error("GetSubData: Index out of range",o),null;if(i.data instanceof Float32Array){const l=new Float32Array(i.data.buffer,i.data.byteOffset+4*o,1);return new v(l,s)}if(i.data instanceof Int32Array){const l=new Int32Array(i.data.buffer,i.data.byteOffset+4*o,1);return new v(l,s)}if(i.data instanceof Uint32Array){const l=new Uint32Array(i.data.buffer,i.data.byteOffset+4*o,1);return new v(l,s)}throw"GetSubData: Invalid data type"}if(!(t instanceof vt))return console.error("GetSubData: Unknown postfix",t),null;{const a=t.value.toLowerCase();if(a.length===1){let l=0;if(a==="x"||a==="r")l=0;else if(a==="y"||a==="g")l=1;else if(a==="z"||a==="b")l=2;else{if(a!=="w"&&a!=="a")return console.error(`GetSubData: Unknown member ${a}`),null;l=3}if(this.data instanceof Float32Array){let u=new Float32Array(this.data.buffer,this.data.byteOffset+4*l,1);return new v(u,s,this)}if(this.data instanceof Int32Array){let u=new Int32Array(this.data.buffer,this.data.byteOffset+4*l,1);return new v(u,s,this)}if(this.data instanceof Uint32Array){let u=new Uint32Array(this.data.buffer,this.data.byteOffset+4*l,1);return new v(u,s,this)}}const o=[];for(const l of a)l==="x"||l==="r"?o.push(this.data[0]):l==="y"||l==="g"?o.push(this.data[1]):l==="z"||l==="b"?o.push(this.data[2]):l==="w"||l==="a"?o.push(this.data[3]):console.error(`GetDataValue: Unknown member ${l}`);i=id(e,o,s.name)}t=t.postfix}return i}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class V extends ye{constructor(e,t,n=null){super(t,n),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new V(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,n,s){n instanceof vt?console.error("TODO: Set matrix postfix"):t instanceof V?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,n){if(t===null)return this;const s=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof mt)this.typeInfo.format;else if(s.endsWith("f"))e.getTypeInfo("f32");else if(s.endsWith("i"))e.getTypeInfo("i32");else if(s.endsWith("u"))e.getTypeInfo("u32");else{if(!s.endsWith("h"))return console.error(`GetDataValue: Unknown type ${s}`),null;e.getTypeInfo("f16")}if(t instanceof Dt){const i=t.index;let a=-1;if(i instanceof J){if(!(i.value instanceof v))return console.error(`GetDataValue: Invalid array index ${i.value}`),null;a=i.value.value}else{const u=e.evalExpression(i,n);if(!(u instanceof v))return console.error("GetDataValue: Unknown index type",i),null;a=u.value}if(a<0||a>=this.data.length)return console.error("GetDataValue: Index out of range",a),null;const o=s.endsWith("h")?"h":"f";let l;if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h"||s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h")l=new d(new Float32Array(this.data.buffer,this.data.byteOffset+2*a*4,2),e.getTypeInfo(`vec2${o}`));else if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h"||s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h")l=new d(new Float32Array(this.data.buffer,this.data.byteOffset+3*a*4,3),e.getTypeInfo(`vec3${o}`));else{if(s!=="mat2x4"&&s!=="mat2x4f"&&s!=="mat2x4h"&&s!=="mat3x4"&&s!=="mat3x4f"&&s!=="mat3x4h"&&s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${s}`),null;l=new d(new Float32Array(this.data.buffer,this.data.byteOffset+4*a*4,4),e.getTypeInfo(`vec4${o}`))}return t.postfix?l.getSubData(e,t.postfix,n):l}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class Y extends ye{constructor(e,t,n=0,s=null){super(t,s),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=n}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Y(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,n,s){if(t===null)return void console.log("setDataValue: NULL data.");let i=this.offset,a=this.typeInfo;for(;n;){if(n instanceof Dt)if(a instanceof st){const o=n.index;if(o instanceof J){if(!(o.value instanceof v))return void console.error(`SetDataValue: Invalid index type ${o.value}`);i+=o.value.value*a.stride}else{const l=e.evalExpression(o,s);if(!(l instanceof v))return void console.error("SetDataValue: Unknown index type",o);i+=l.value*a.stride}a=a.format}else console.error(`SetDataValue: Type ${a.getTypeName()} is not an array`);else{if(!(n instanceof vt))return void console.error("SetDataValue: Unknown postfix type",n);{const o=n.value;if(a instanceof nt){let l=!1;for(const u of a.members)if(u.name===o){i+=u.offset,a=u.type,l=!0;break}if(!l)return void console.error(`SetDataValue: Member ${o} not found`)}else if(a instanceof xe){const l=a.getTypeName();let u=0;if(o==="x"||o==="r")u=0;else if(o==="y"||o==="g")u=1;else if(o==="z"||o==="b")u=2;else{if(o!=="w"&&o!=="a")return void console.error(`SetDataValue: Unknown member ${o}`);u=3}if(!(t instanceof v))return void console.error("SetDataValue: Invalid value",t);const c=t.value;return l==="vec2f"?void(new Float32Array(this.buffer,i,2)[u]=c):l==="vec3f"?void(new Float32Array(this.buffer,i,3)[u]=c):l==="vec4f"?void(new Float32Array(this.buffer,i,4)[u]=c):l==="vec2i"?void(new Int32Array(this.buffer,i,2)[u]=c):l==="vec3i"?void(new Int32Array(this.buffer,i,3)[u]=c):l==="vec4i"?void(new Int32Array(this.buffer,i,4)[u]=c):l==="vec2u"?void(new Uint32Array(this.buffer,i,2)[u]=c):l==="vec3u"?void(new Uint32Array(this.buffer,i,3)[u]=c):l==="vec4u"?void(new Uint32Array(this.buffer,i,4)[u]=c):void console.error(`SetDataValue: Type ${l} is not a struct`)}}}n=n.postfix}this.setData(e,t,a,i,s)}setData(e,t,n,s,i){const a=n.getTypeName();if(a!=="f32"&&a!=="f16")if(a!=="i32"&&a!=="atomic<i32>"&&a!=="x32")if(a!=="u32"&&a!=="atomic<u32>")if(a!=="bool")if(a!=="vec2f"&&a!=="vec2h")if(a!=="vec3f"&&a!=="vec3h")if(a!=="vec4f"&&a!=="vec4h")if(a!=="vec2i")if(a!=="vec3i")if(a!=="vec4i")if(a!=="vec2u")if(a!=="vec3u")if(a!=="vec4u")if(a!=="vec2b")if(a!=="vec3b")if(a!=="vec4b")if(a!=="mat2x2f"&&a!=="mat2x2h")if(a!=="mat2x3f"&&a!=="mat2x3h")if(a!=="mat2x4f"&&a!=="mat2x4h")if(a!=="mat3x2f"&&a!=="mat3x2h")if(a!=="mat3x3f"&&a!=="mat3x3h")if(a!=="mat3x4f"&&a!=="mat3x4h")if(a!=="mat4x2f"&&a!=="mat4x2h")if(a!=="mat4x3f"&&a!=="mat4x3h")if(a!=="mat4x4f"&&a!=="mat4x4h")if(t instanceof Y){if(n===t.typeInfo)return void new Uint8Array(this.buffer,s,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",a,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${a}`);else{const o=new Float32Array(this.buffer,s,16);t instanceof V?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5],o[6]=t.data[6],o[7]=t.data[7],o[8]=t.data[8],o[9]=t.data[9],o[10]=t.data[10],o[11]=t.data[11],o[12]=t.data[12],o[13]=t.data[13],o[14]=t.data[14],o[15]=t.data[15]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15])}else{const o=new Float32Array(this.buffer,s,12);t instanceof V?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5],o[6]=t.data[6],o[7]=t.data[7],o[8]=t.data[8],o[9]=t.data[9],o[10]=t.data[10],o[11]=t.data[11]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11])}else{const o=new Float32Array(this.buffer,s,8);t instanceof V?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5],o[6]=t.data[6],o[7]=t.data[7]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7])}else{const o=new Float32Array(this.buffer,s,12);t instanceof V?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5],o[6]=t.data[6],o[7]=t.data[7],o[8]=t.data[8],o[9]=t.data[9],o[10]=t.data[10],o[11]=t.data[11]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11])}else{const o=new Float32Array(this.buffer,s,9);t instanceof V?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5],o[6]=t.data[6],o[7]=t.data[7],o[8]=t.data[8]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8])}else{const o=new Float32Array(this.buffer,s,6);t instanceof V?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5])}else{const o=new Float32Array(this.buffer,s,8);t instanceof V?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5],o[6]=t.data[6],o[7]=t.data[7]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7])}else{const o=new Float32Array(this.buffer,s,6);t instanceof V?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3],o[4]=t.data[4],o[5]=t.data[5]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5])}else{const o=new Float32Array(this.buffer,s,4);t instanceof V?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3])}else{const o=new Uint32Array(this.buffer,s,4);t instanceof d?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3])}else{const o=new Uint32Array(this.buffer,s,3);t instanceof d?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2]):(o[0]=t[0],o[1]=t[1],o[2]=t[2])}else{const o=new Uint32Array(this.buffer,s,2);t instanceof d?(o[0]=t.data[0],o[1]=t.data[1]):(o[0]=t[0],o[1]=t[1])}else{const o=new Uint32Array(this.buffer,s,4);t instanceof d?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3])}else{const o=new Uint32Array(this.buffer,s,3);t instanceof d?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2]):(o[0]=t[0],o[1]=t[1],o[2]=t[2])}else{const o=new Uint32Array(this.buffer,s,2);t instanceof d?(o[0]=t.data[0],o[1]=t.data[1]):(o[0]=t[0],o[1]=t[1])}else{const o=new Int32Array(this.buffer,s,4);t instanceof d?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3])}else{const o=new Int32Array(this.buffer,s,3);t instanceof d?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2]):(o[0]=t[0],o[1]=t[1],o[2]=t[2])}else{const o=new Int32Array(this.buffer,s,2);t instanceof d?(o[0]=t.data[0],o[1]=t.data[1]):(o[0]=t[0],o[1]=t[1])}else{const o=new Float32Array(this.buffer,s,4);t instanceof d?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2],o[3]=t.data[3]):(o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3])}else{const o=new Float32Array(this.buffer,s,3);t instanceof d?(o[0]=t.data[0],o[1]=t.data[1],o[2]=t.data[2]):(o[0]=t[0],o[1]=t[1],o[2]=t[2])}else{const o=new Float32Array(this.buffer,s,2);t instanceof d?(o[0]=t.data[0],o[1]=t.data[1]):(o[0]=t[0],o[1]=t[1])}else t instanceof v&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof v&&(new Uint32Array(this.buffer,s,1)[0]=t.value);else t instanceof v&&(new Int32Array(this.buffer,s,1)[0]=t.value);else t instanceof v&&(new Float32Array(this.buffer,s,1)[0]=t.value)}getSubData(e,t,n){var s,i,a;if(t===null)return this;let o=this.offset,l=this.typeInfo;for(;t;){if(t instanceof Dt){const c=t.index,h=c instanceof Pe?e.evalExpression(c,n):c;let m=0;if(h instanceof v?m=h.value:typeof h=="number"?m=h:console.error("GetDataValue: Invalid index type",c),l instanceof st)o+=m*l.stride,l=l.format;else{const f=l.getTypeName();f==="mat4x4"||f==="mat4x4f"||f==="mat4x4h"?(o+=16*m,l=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${l.getTypeName()} is not an array`)}}else{if(!(t instanceof vt))return console.error("GetDataValue: Unknown postfix type",t),null;{const c=t.value;if(l instanceof nt){let h=!1;for(const m of l.members)if(m.name===c){o+=m.offset,l=m.type,h=!0;break}if(!h)return console.error(`GetDataValue: Member ${c} not found`),null}else if(l instanceof xe){const h=l.getTypeName();if(h==="vec2f"||h==="vec3f"||h==="vec4f"||h==="vec2i"||h==="vec3i"||h==="vec4i"||h==="vec2u"||h==="vec3u"||h==="vec4u"||h==="vec2b"||h==="vec3b"||h==="vec4b"||h==="vec2h"||h==="vec3h"||h==="vec4h"||h==="vec2"||h==="vec3"||h==="vec4"){if(c.length>0&&c.length<5){let m="f";const f=[];for(let w=0;w<c.length;++w){const k=c[w].toLowerCase();let y=0;if(k==="x"||k==="r")y=0;else if(k==="y"||k==="g")y=1;else if(k==="z"||k==="b")y=2;else{if(k!=="w"&&k!=="a")return console.error(`Unknown member ${c}`),null;y=3}if(c.length===1){if(h.endsWith("f"))return this.buffer.byteLength<o+4*y+4?(console.log("Insufficient buffer data"),null):new v(new Float32Array(this.buffer,o+4*y,1),e.getTypeInfo("f32"),this);if(h.endsWith("h"))return new v(new Float32Array(this.buffer,o+4*y,1),e.getTypeInfo("f16"),this);if(h.endsWith("i"))return new v(new Int32Array(this.buffer,o+4*y,1),e.getTypeInfo("i32"),this);if(h.endsWith("b"))return new v(new Int32Array(this.buffer,o+4*y,1),e.getTypeInfo("bool"),this);if(h.endsWith("u"))return new v(new Uint32Array(this.buffer,o+4*y,1),e.getTypeInfo("i32"),this)}if(h==="vec2f")f.push(new Float32Array(this.buffer,o,2)[y]);else if(h==="vec3f"){if(o+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const T=new Float32Array(this.buffer,o,3);f.push(T[y])}else if(h==="vec4f")f.push(new Float32Array(this.buffer,o,4)[y]);else if(h==="vec2i")m="i",f.push(new Int32Array(this.buffer,o,2)[y]);else if(h==="vec3i")m="i",f.push(new Int32Array(this.buffer,o,3)[y]);else if(h==="vec4i")m="i",f.push(new Int32Array(this.buffer,o,4)[y]);else if(h==="vec2u"){m="u";const T=new Uint32Array(this.buffer,o,2);f.push(T[y])}else h==="vec3u"?(m="u",f.push(new Uint32Array(this.buffer,o,3)[y])):h==="vec4u"&&(m="u",f.push(new Uint32Array(this.buffer,o,4)[y]))}return f.length===2?l=e.getTypeInfo(`vec2${m}`):f.length===3?l=e.getTypeInfo(`vec3${m}`):f.length===4?l=e.getTypeInfo(`vec4${m}`):console.error(`GetDataValue: Invalid vector length ${f.length}`),new d(f,l,null)}return console.error(`GetDataValue: Unknown member ${c}`),null}return console.error(`GetDataValue: Type ${h} is not a struct`),null}}}t=t.postfix}const u=l.getTypeName();return u==="f32"?new v(new Float32Array(this.buffer,o,1),l,this):u==="i32"?new v(new Int32Array(this.buffer,o,1),l,this):u==="u32"?new v(new Uint32Array(this.buffer,o,1),l,this):u==="vec2f"?new d(new Float32Array(this.buffer,o,2),l,this):u==="vec3f"?new d(new Float32Array(this.buffer,o,3),l,this):u==="vec4f"?new d(new Float32Array(this.buffer,o,4),l,this):u==="vec2i"?new d(new Int32Array(this.buffer,o,2),l,this):u==="vec3i"?new d(new Int32Array(this.buffer,o,3),l,this):u==="vec4i"?new d(new Int32Array(this.buffer,o,4),l,this):u==="vec2u"?new d(new Uint32Array(this.buffer,o,2),l,this):u==="vec3u"?new d(new Uint32Array(this.buffer,o,3),l,this):u==="vec4u"?new d(new Uint32Array(this.buffer,o,4),l,this):l instanceof mt&&l.name==="atomic"?((s=l.format)===null||s===void 0?void 0:s.name)==="u32"?new v(new Uint32Array(this.buffer,o,1)[0],l.format,this):((i=l.format)===null||i===void 0?void 0:i.name)==="i32"?new v(new Int32Array(this.buffer,o,1)[0],l.format,this):(console.error(`GetDataValue: Invalid atomic format ${(a=l.format)===null||a===void 0?void 0:a.name}`),null):new Y(this.buffer,l,o,this)}toString(){let e="";if(this.typeInfo instanceof st)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let n=1;n<t.length;++n)e+=`, ${t[n]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let n=1;n<t.length/2;++n)e+=`, [${t[2*n]}, ${t[2*n+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let n=4;n<t.length;n+=4)e+=`, [${t[n]}, ${t[n+1]}, ${t[n+2]}, ${t[n+3]}]`}else e="[...]";else this.typeInfo instanceof nt?e+="{...}":e="[...]";return e}}class Re extends ye{constructor(e,t,n,s){super(t,null),this.data=e,this.descriptor=n,this.view=s}clone(){return new Re(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>0?(e=n[0])!==null&&e!==void 0?e:0:n instanceof Object&&(t=n.width)!==null&&t!==void 0?t:0}get height(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>1?(e=n[1])!==null&&e!==void 0?e:0:n instanceof Object&&(t=n.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;const n=this.descriptor.size;return n instanceof Array&&n.length>2?(e=n[2])!==null&&e!==void 0?e:0:n instanceof Object&&(t=n.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let n=0;n<t.length;++n)t[n]=Math.max(1,t[n]>>e);return t}get texelByteSize(){const e=this.format,t=pr[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=pr[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=pr[e],n=this.width;if(!e||n<=0||!t)return-1;const s=this.height,i=this.depthOrArrayLayers,a=this.dimension;return n/t.blockWidth*(a==="1d"?1:s/t.blockHeight)*t.bytesPerBlock*i}getPixel(e,t,n=0,s=0){const i=this.texelByteSize,a=this.bytesPerRow,o=this.height,l=this.data[s];return Jp(new Uint8Array(l),e,t,n,s,o,a,i,this.format)}setPixel(e,t,n,s,i){const a=this.texelByteSize,o=this.bytesPerRow,l=this.height,u=this.data[s];(function(c,h,m,f,w,k,y,T,P,E){const I=f*(y>>=w)*(k>>=w)+m*y+h*T;switch(P){case"r8unorm":return void F(c,I,"8unorm",1,E);case"r8snorm":return void F(c,I,"8snorm",1,E);case"r8uint":return void F(c,I,"8uint",1,E);case"r8sint":return void F(c,I,"8sint",1,E);case"rg8unorm":return void F(c,I,"8unorm",2,E);case"rg8snorm":return void F(c,I,"8snorm",2,E);case"rg8uint":return void F(c,I,"8uint",2,E);case"rg8sint":return void F(c,I,"8sint",2,E);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void F(c,I,"8unorm",4,E);case"rgba8snorm":return void F(c,I,"8snorm",4,E);case"rgba8uint":return void F(c,I,"8uint",4,E);case"rgba8sint":return void F(c,I,"8sint",4,E);case"r16uint":return void F(c,I,"16uint",1,E);case"r16sint":return void F(c,I,"16sint",1,E);case"r16float":return void F(c,I,"16float",1,E);case"rg16uint":return void F(c,I,"16uint",2,E);case"rg16sint":return void F(c,I,"16sint",2,E);case"rg16float":return void F(c,I,"16float",2,E);case"rgba16uint":return void F(c,I,"16uint",4,E);case"rgba16sint":return void F(c,I,"16sint",4,E);case"rgba16float":return void F(c,I,"16float",4,E);case"r32uint":return void F(c,I,"32uint",1,E);case"r32sint":return void F(c,I,"32sint",1,E);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void F(c,I,"32float",1,E);case"rg32uint":return void F(c,I,"32uint",2,E);case"rg32sint":return void F(c,I,"32sint",2,E);case"rg32float":return void F(c,I,"32float",2,E);case"rgba32uint":return void F(c,I,"32uint",4,E);case"rgba32sint":return void F(c,I,"32sint",4,E);case"rgba32float":return void F(c,I,"32float",4,E);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(u),e,t,n,s,l,o,a,this.format,i)}}(r=>{r[r.token=0]="token",r[r.keyword=1]="keyword",r[r.reserved=2]="reserved"})(g||(g={}));class b{constructor(e,t,n){this.name=e,this.type=t,this.rule=n}toString(){return this.name}}class p{}x=p,p.none=new b("",g.reserved,""),p.eof=new b("EOF",g.token,""),p.reserved={asm:new b("asm",g.reserved,"asm"),bf16:new b("bf16",g.reserved,"bf16"),do:new b("do",g.reserved,"do"),enum:new b("enum",g.reserved,"enum"),f16:new b("f16",g.reserved,"f16"),f64:new b("f64",g.reserved,"f64"),handle:new b("handle",g.reserved,"handle"),i8:new b("i8",g.reserved,"i8"),i16:new b("i16",g.reserved,"i16"),i64:new b("i64",g.reserved,"i64"),mat:new b("mat",g.reserved,"mat"),premerge:new b("premerge",g.reserved,"premerge"),regardless:new b("regardless",g.reserved,"regardless"),typedef:new b("typedef",g.reserved,"typedef"),u8:new b("u8",g.reserved,"u8"),u16:new b("u16",g.reserved,"u16"),u64:new b("u64",g.reserved,"u64"),unless:new b("unless",g.reserved,"unless"),using:new b("using",g.reserved,"using"),vec:new b("vec",g.reserved,"vec"),void:new b("void",g.reserved,"void")},p.keywords={array:new b("array",g.keyword,"array"),atomic:new b("atomic",g.keyword,"atomic"),bool:new b("bool",g.keyword,"bool"),f32:new b("f32",g.keyword,"f32"),i32:new b("i32",g.keyword,"i32"),mat2x2:new b("mat2x2",g.keyword,"mat2x2"),mat2x3:new b("mat2x3",g.keyword,"mat2x3"),mat2x4:new b("mat2x4",g.keyword,"mat2x4"),mat3x2:new b("mat3x2",g.keyword,"mat3x2"),mat3x3:new b("mat3x3",g.keyword,"mat3x3"),mat3x4:new b("mat3x4",g.keyword,"mat3x4"),mat4x2:new b("mat4x2",g.keyword,"mat4x2"),mat4x3:new b("mat4x3",g.keyword,"mat4x3"),mat4x4:new b("mat4x4",g.keyword,"mat4x4"),ptr:new b("ptr",g.keyword,"ptr"),sampler:new b("sampler",g.keyword,"sampler"),sampler_comparison:new b("sampler_comparison",g.keyword,"sampler_comparison"),struct:new b("struct",g.keyword,"struct"),texture_1d:new b("texture_1d",g.keyword,"texture_1d"),texture_2d:new b("texture_2d",g.keyword,"texture_2d"),texture_2d_array:new b("texture_2d_array",g.keyword,"texture_2d_array"),texture_3d:new b("texture_3d",g.keyword,"texture_3d"),texture_cube:new b("texture_cube",g.keyword,"texture_cube"),texture_cube_array:new b("texture_cube_array",g.keyword,"texture_cube_array"),texture_multisampled_2d:new b("texture_multisampled_2d",g.keyword,"texture_multisampled_2d"),texture_storage_1d:new b("texture_storage_1d",g.keyword,"texture_storage_1d"),texture_storage_2d:new b("texture_storage_2d",g.keyword,"texture_storage_2d"),texture_storage_2d_array:new b("texture_storage_2d_array",g.keyword,"texture_storage_2d_array"),texture_storage_3d:new b("texture_storage_3d",g.keyword,"texture_storage_3d"),texture_depth_2d:new b("texture_depth_2d",g.keyword,"texture_depth_2d"),texture_depth_2d_array:new b("texture_depth_2d_array",g.keyword,"texture_depth_2d_array"),texture_depth_cube:new b("texture_depth_cube",g.keyword,"texture_depth_cube"),texture_depth_cube_array:new b("texture_depth_cube_array",g.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new b("texture_depth_multisampled_2d",g.keyword,"texture_depth_multisampled_2d"),texture_external:new b("texture_external",g.keyword,"texture_external"),u32:new b("u32",g.keyword,"u32"),vec2:new b("vec2",g.keyword,"vec2"),vec3:new b("vec3",g.keyword,"vec3"),vec4:new b("vec4",g.keyword,"vec4"),bitcast:new b("bitcast",g.keyword,"bitcast"),block:new b("block",g.keyword,"block"),break:new b("break",g.keyword,"break"),case:new b("case",g.keyword,"case"),continue:new b("continue",g.keyword,"continue"),continuing:new b("continuing",g.keyword,"continuing"),default:new b("default",g.keyword,"default"),diagnostic:new b("diagnostic",g.keyword,"diagnostic"),discard:new b("discard",g.keyword,"discard"),else:new b("else",g.keyword,"else"),enable:new b("enable",g.keyword,"enable"),fallthrough:new b("fallthrough",g.keyword,"fallthrough"),false:new b("false",g.keyword,"false"),fn:new b("fn",g.keyword,"fn"),for:new b("for",g.keyword,"for"),function:new b("function",g.keyword,"function"),if:new b("if",g.keyword,"if"),let:new b("let",g.keyword,"let"),const:new b("const",g.keyword,"const"),loop:new b("loop",g.keyword,"loop"),while:new b("while",g.keyword,"while"),private:new b("private",g.keyword,"private"),read:new b("read",g.keyword,"read"),read_write:new b("read_write",g.keyword,"read_write"),return:new b("return",g.keyword,"return"),requires:new b("requires",g.keyword,"requires"),storage:new b("storage",g.keyword,"storage"),switch:new b("switch",g.keyword,"switch"),true:new b("true",g.keyword,"true"),alias:new b("alias",g.keyword,"alias"),type:new b("type",g.keyword,"type"),uniform:new b("uniform",g.keyword,"uniform"),var:new b("var",g.keyword,"var"),override:new b("override",g.keyword,"override"),workgroup:new b("workgroup",g.keyword,"workgroup"),write:new b("write",g.keyword,"write"),r8unorm:new b("r8unorm",g.keyword,"r8unorm"),r8snorm:new b("r8snorm",g.keyword,"r8snorm"),r8uint:new b("r8uint",g.keyword,"r8uint"),r8sint:new b("r8sint",g.keyword,"r8sint"),r16uint:new b("r16uint",g.keyword,"r16uint"),r16sint:new b("r16sint",g.keyword,"r16sint"),r16float:new b("r16float",g.keyword,"r16float"),rg8unorm:new b("rg8unorm",g.keyword,"rg8unorm"),rg8snorm:new b("rg8snorm",g.keyword,"rg8snorm"),rg8uint:new b("rg8uint",g.keyword,"rg8uint"),rg8sint:new b("rg8sint",g.keyword,"rg8sint"),r32uint:new b("r32uint",g.keyword,"r32uint"),r32sint:new b("r32sint",g.keyword,"r32sint"),r32float:new b("r32float",g.keyword,"r32float"),rg16uint:new b("rg16uint",g.keyword,"rg16uint"),rg16sint:new b("rg16sint",g.keyword,"rg16sint"),rg16float:new b("rg16float",g.keyword,"rg16float"),rgba8unorm:new b("rgba8unorm",g.keyword,"rgba8unorm"),rgba8unorm_srgb:new b("rgba8unorm_srgb",g.keyword,"rgba8unorm_srgb"),rgba8snorm:new b("rgba8snorm",g.keyword,"rgba8snorm"),rgba8uint:new b("rgba8uint",g.keyword,"rgba8uint"),rgba8sint:new b("rgba8sint",g.keyword,"rgba8sint"),bgra8unorm:new b("bgra8unorm",g.keyword,"bgra8unorm"),bgra8unorm_srgb:new b("bgra8unorm_srgb",g.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new b("rgb10a2unorm",g.keyword,"rgb10a2unorm"),rg11b10float:new b("rg11b10float",g.keyword,"rg11b10float"),rg32uint:new b("rg32uint",g.keyword,"rg32uint"),rg32sint:new b("rg32sint",g.keyword,"rg32sint"),rg32float:new b("rg32float",g.keyword,"rg32float"),rgba16uint:new b("rgba16uint",g.keyword,"rgba16uint"),rgba16sint:new b("rgba16sint",g.keyword,"rgba16sint"),rgba16float:new b("rgba16float",g.keyword,"rgba16float"),rgba32uint:new b("rgba32uint",g.keyword,"rgba32uint"),rgba32sint:new b("rgba32sint",g.keyword,"rgba32sint"),rgba32float:new b("rgba32float",g.keyword,"rgba32float"),static_assert:new b("static_assert",g.keyword,"static_assert")},p.tokens={decimal_float_literal:new b("decimal_float_literal",g.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new b("hex_float_literal",g.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new b("int_literal",g.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new b("uint_literal",g.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new b("name",g.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new b("ident",g.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new b("and",g.token,"&"),and_and:new b("and_and",g.token,"&&"),arrow:new b("arrow ",g.token,"->"),attr:new b("attr",g.token,"@"),forward_slash:new b("forward_slash",g.token,"/"),bang:new b("bang",g.token,"!"),bracket_left:new b("bracket_left",g.token,"["),bracket_right:new b("bracket_right",g.token,"]"),brace_left:new b("brace_left",g.token,"{"),brace_right:new b("brace_right",g.token,"}"),colon:new b("colon",g.token,":"),comma:new b("comma",g.token,","),equal:new b("equal",g.token,"="),equal_equal:new b("equal_equal",g.token,"=="),not_equal:new b("not_equal",g.token,"!="),greater_than:new b("greater_than",g.token,">"),greater_than_equal:new b("greater_than_equal",g.token,">="),shift_right:new b("shift_right",g.token,">>"),less_than:new b("less_than",g.token,"<"),less_than_equal:new b("less_than_equal",g.token,"<="),shift_left:new b("shift_left",g.token,"<<"),modulo:new b("modulo",g.token,"%"),minus:new b("minus",g.token,"-"),minus_minus:new b("minus_minus",g.token,"--"),period:new b("period",g.token,"."),plus:new b("plus",g.token,"+"),plus_plus:new b("plus_plus",g.token,"++"),or:new b("or",g.token,"|"),or_or:new b("or_or",g.token,"||"),paren_left:new b("paren_left",g.token,"("),paren_right:new b("paren_right",g.token,")"),semicolon:new b("semicolon",g.token,";"),star:new b("star",g.token,"*"),tilde:new b("tilde",g.token,"~"),underscore:new b("underscore",g.token,"_"),xor:new b("xor",g.token,"^"),plus_equal:new b("plus_equal",g.token,"+="),minus_equal:new b("minus_equal",g.token,"-="),times_equal:new b("times_equal",g.token,"*="),division_equal:new b("division_equal",g.token,"/="),modulo_equal:new b("modulo_equal",g.token,"%="),and_equal:new b("and_equal",g.token,"&="),or_equal:new b("or_equal",g.token,"|="),xor_equal:new b("xor_equal",g.token,"^="),shift_right_equal:new b("shift_right_equal",g.token,">>="),shift_left_equal:new b("shift_left_equal",g.token,"<<=")},p.simpleTokens={"@":x.tokens.attr,"{":x.tokens.brace_left,"}":x.tokens.brace_right,":":x.tokens.colon,",":x.tokens.comma,"(":x.tokens.paren_left,")":x.tokens.paren_right,";":x.tokens.semicolon},p.literalTokens={"&":x.tokens.and,"&&":x.tokens.and_and,"->":x.tokens.arrow,"/":x.tokens.forward_slash,"!":x.tokens.bang,"[":x.tokens.bracket_left,"]":x.tokens.bracket_right,"=":x.tokens.equal,"==":x.tokens.equal_equal,"!=":x.tokens.not_equal,">":x.tokens.greater_than,">=":x.tokens.greater_than_equal,">>":x.tokens.shift_right,"<":x.tokens.less_than,"<=":x.tokens.less_than_equal,"<<":x.tokens.shift_left,"%":x.tokens.modulo,"-":x.tokens.minus,"--":x.tokens.minus_minus,".":x.tokens.period,"+":x.tokens.plus,"++":x.tokens.plus_plus,"|":x.tokens.or,"||":x.tokens.or_or,"*":x.tokens.star,"~":x.tokens.tilde,_:x.tokens.underscore,"^":x.tokens.xor,"+=":x.tokens.plus_equal,"-=":x.tokens.minus_equal,"*=":x.tokens.times_equal,"/=":x.tokens.division_equal,"%=":x.tokens.modulo_equal,"&=":x.tokens.and_equal,"|=":x.tokens.or_equal,"^=":x.tokens.xor_equal,">>=":x.tokens.shift_right_equal,"<<=":x.tokens.shift_left_equal},p.regexTokens={decimal_float_literal:x.tokens.decimal_float_literal,hex_float_literal:x.tokens.hex_float_literal,int_literal:x.tokens.int_literal,uint_literal:x.tokens.uint_literal,ident:x.tokens.ident},p.storage_class=[x.keywords.function,x.keywords.private,x.keywords.workgroup,x.keywords.uniform,x.keywords.storage],p.access_mode=[x.keywords.read,x.keywords.write,x.keywords.read_write],p.sampler_type=[x.keywords.sampler,x.keywords.sampler_comparison],p.sampled_texture_type=[x.keywords.texture_1d,x.keywords.texture_2d,x.keywords.texture_2d_array,x.keywords.texture_3d,x.keywords.texture_cube,x.keywords.texture_cube_array],p.multisampled_texture_type=[x.keywords.texture_multisampled_2d],p.storage_texture_type=[x.keywords.texture_storage_1d,x.keywords.texture_storage_2d,x.keywords.texture_storage_2d_array,x.keywords.texture_storage_3d],p.depth_texture_type=[x.keywords.texture_depth_2d,x.keywords.texture_depth_2d_array,x.keywords.texture_depth_cube,x.keywords.texture_depth_cube_array,x.keywords.texture_depth_multisampled_2d],p.texture_external_type=[x.keywords.texture_external],p.any_texture_type=[...x.sampled_texture_type,...x.multisampled_texture_type,...x.storage_texture_type,...x.depth_texture_type,...x.texture_external_type],p.texel_format=[x.keywords.r8unorm,x.keywords.r8snorm,x.keywords.r8uint,x.keywords.r8sint,x.keywords.r16uint,x.keywords.r16sint,x.keywords.r16float,x.keywords.rg8unorm,x.keywords.rg8snorm,x.keywords.rg8uint,x.keywords.rg8sint,x.keywords.r32uint,x.keywords.r32sint,x.keywords.r32float,x.keywords.rg16uint,x.keywords.rg16sint,x.keywords.rg16float,x.keywords.rgba8unorm,x.keywords.rgba8unorm_srgb,x.keywords.rgba8snorm,x.keywords.rgba8uint,x.keywords.rgba8sint,x.keywords.bgra8unorm,x.keywords.bgra8unorm_srgb,x.keywords.rgb10a2unorm,x.keywords.rg11b10float,x.keywords.rg32uint,x.keywords.rg32sint,x.keywords.rg32float,x.keywords.rgba16uint,x.keywords.rgba16sint,x.keywords.rgba16float,x.keywords.rgba32uint,x.keywords.rgba32sint,x.keywords.rgba32float],p.const_literal=[x.tokens.int_literal,x.tokens.uint_literal,x.tokens.decimal_float_literal,x.tokens.hex_float_literal,x.keywords.true,x.keywords.false],p.literal_or_ident=[x.tokens.ident,x.tokens.int_literal,x.tokens.uint_literal,x.tokens.decimal_float_literal,x.tokens.hex_float_literal,x.tokens.name],p.element_count_expression=[x.tokens.int_literal,x.tokens.uint_literal,x.tokens.ident],p.template_types=[x.keywords.vec2,x.keywords.vec3,x.keywords.vec4,x.keywords.mat2x2,x.keywords.mat2x3,x.keywords.mat2x4,x.keywords.mat3x2,x.keywords.mat3x3,x.keywords.mat3x4,x.keywords.mat4x2,x.keywords.mat4x3,x.keywords.mat4x4,x.keywords.atomic,x.keywords.bitcast,...x.any_texture_type],p.attribute_name=[x.tokens.ident,x.keywords.block,x.keywords.diagnostic],p.assignment_operators=[x.tokens.equal,x.tokens.plus_equal,x.tokens.minus_equal,x.tokens.times_equal,x.tokens.division_equal,x.tokens.modulo_equal,x.tokens.and_equal,x.tokens.or_equal,x.tokens.xor_equal,x.tokens.shift_right_equal,x.tokens.shift_left_equal],p.increment_operators=[x.tokens.plus_plus,x.tokens.minus_minus];class ri{constructor(e,t,n,s,i){this.type=e,this.lexeme=t,this.line=n,this.start=s,this.end=i}toString(){return this.lexeme}isTemplateType(){return p.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==p.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class od{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new ri(p.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let a=1;for(;a>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),a--,a==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),a++)}return!0}}const t=p.simpleTokens[e];if(t)return this._addToken(t),!0;let n=p.none;const s=this._isAlpha(e),i=e==="_";if(this._isAlphaNumeric(e)){let a=this._peekAhead();for(;this._isAlphaNumeric(a);)e+=this._advance(),a=this._peekAhead()}if(s){const a=p.keywords[e];if(a)return this._addToken(a),!0}if(s||i)return this._addToken(p.tokens.ident),!0;for(;;){let a=this._findType(e);const o=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(o=="=")return this._current++,e+=o,this._addToken(p.tokens.minus_equal),!0;if(o=="-")return this._current++,e+=o,this._addToken(p.tokens.minus_minus),!0;const l=this._tokens.length-1;if((p.literal_or_ident.indexOf(this._tokens[l].type)!=-1||this._tokens[l].type==p.tokens.paren_right)&&o!=">")return this._addToken(a),!0}if(e==">"&&(o==">"||o=="=")){let l=!1,u=this._tokens.length-1;for(let c=0;c<5&&u>=0&&p.assignment_operators.indexOf(this._tokens[u].type)===-1;++c,--u)if(this._tokens[u].type===p.tokens.less_than){u>0&&this._tokens[u-1].isArrayOrTemplateType()&&(l=!0);break}if(l)return this._addToken(a),!0}if(a===p.none){let l=e,u=0;const c=2;for(let h=0;h<c;++h)if(l+=this._peekAhead(h),a=this._findType(l),a!==p.none){u=h;break}if(a===p.none)return n!==p.none&&(this._current--,this._addToken(n),!0);e=l,this._current+=u+1}if(n=a,this._isAtEnd())break;e+=this._advance()}return n!==p.none&&(this._addToken(n),!0)}_findType(e){for(const n in p.regexTokens){const s=p.regexTokens[n];if(this._match(e,s.rule))return s}return p.literalTokens[e]||p.none}_match(e,t){const n=t.exec(e);return n&&n.index==0&&n[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new ri(e,t,this._line,this._start,this._current))}}function S(r){return Array.isArray(r)||r?.buffer instanceof ArrayBuffer}const zn=new Float32Array(1),ad=new Uint32Array(zn.buffer),ld=new Uint32Array(zn.buffer),Rn=new Int32Array(1),cd=new Float32Array(Rn.buffer),ud=new Uint32Array(Rn.buffer),Gn=new Uint32Array(1),hd=new Float32Array(Gn.buffer),pd=new Int32Array(Gn.buffer);function si(r,e,t){if(e===t)return r;if(e==="f32"){if(t==="i32"||t==="x32")return zn[0]=r,ad[0];if(t==="u32")return zn[0]=r,ld[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return Rn[0]=r,cd[0];if(t==="u32")return Rn[0]=r,ud[0]}else if(e==="u32"){if(t==="f32")return Gn[0]=r,hd[0];if(t==="i32"||t==="x32")return Gn[0]=r,pd[0]}return console.error(`Unsupported cast from ${e} to ${t}`),r}class dd{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class Pn{constructor(e,t){this.align=e,this.size=t}}class Oe{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new Xp,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof cn&&this._functions.set(t.name,new dd(t));for(const t of e)if(t instanceof ze){const n=this.getTypeInfo(t,null);n instanceof nt&&this.structs.push(n)}for(const t of e)if(t instanceof ds)this.aliases.push(this._getAliasInfo(t));else if(t instanceof hs){const n=t,s=this._getAttributeNum(n.attributes,"id",0),i=n.type!=null?this.getTypeInfo(n.type,n.attributes):null;this.overrides.push(new Kp(n.name,i,n.attributes,s))}else if(this._isUniformVar(t)){const n=t,s=this._getAttributeNum(n.attributes,"group",0),i=this._getAttributeNum(n.attributes,"binding",0),a=this.getTypeInfo(n.type,n.attributes),o=new Tn(n.name,a,s,i,n.attributes,te.Uniform,n.access);o.access||(o.access="read"),this.uniforms.push(o)}else if(this._isStorageVar(t)){const n=t,s=this._getAttributeNum(n.attributes,"group",0),i=this._getAttributeNum(n.attributes,"binding",0),a=this.getTypeInfo(n.type,n.attributes),o=this._isStorageTexture(a),l=new Tn(n.name,a,s,i,n.attributes,o?te.StorageTexture:te.Storage,n.access);l.access||(l.access="read"),this.storage.push(l)}else if(this._isTextureVar(t)){const n=t,s=this._getAttributeNum(n.attributes,"group",0),i=this._getAttributeNum(n.attributes,"binding",0),a=this.getTypeInfo(n.type,n.attributes),o=this._isStorageTexture(a),l=new Tn(n.name,a,s,i,n.attributes,o?te.StorageTexture:te.Texture,n.access);l.access||(l.access="read"),o?this.storage.push(l):this.textures.push(l)}else if(this._isSamplerVar(t)){const n=t,s=this._getAttributeNum(n.attributes,"group",0),i=this._getAttributeNum(n.attributes,"binding",0),a=this.getTypeInfo(n.type,n.attributes),o=new Tn(n.name,a,s,i,n.attributes,te.Sampler,n.access);this.samplers.push(o)}for(const t of e)if(t instanceof cn){const n=this._getAttribute(t,"vertex"),s=this._getAttribute(t,"fragment"),i=this._getAttribute(t,"compute"),a=n||s||i,o=new Yp(t.name,a?.name,t.attributes);o.attributes=t.attributes,o.startLine=t.startLine,o.endLine=t.endLine,this.functions.push(o),this._functions.get(t.name).info=o,a&&(this._functions.get(t.name).inUse=!0,o.inUse=!0,o.resources=this._findResources(t,!!a),o.inputs=this._getInputs(t.args),o.outputs=this._getOutputs(t.returnType),this.entry[a.name].push(o)),o.arguments=t.args.map((l=>new Wp(l.name,this.getTypeInfo(l.type,l.attributes),l.attributes))),o.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search((n=>{var s,i,a;if(n instanceof qo){if(n.value)if(S(n.value))for(const o of n.value)for(const l of this.overrides)o===l.name&&((s=t.info)===null||s===void 0||s.overrides.push(l));else for(const o of this.overrides)n.value===o.name&&((i=t.info)===null||i===void 0||i.overrides.push(o))}else if(n instanceof ve)for(const o of this.overrides)n.name===o.name&&((a=t.info)===null||a===void 0||a.overrides.push(o))}));for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var n;for(const s of e.calls){const i=(n=this._functions.get(s.name))===null||n===void 0?void 0:n.info;i&&t.add(i)}}findResource(e,t,n){if(n){for(const s of this.entry.compute)if(s.name===n){for(const i of s.resources)if(i.group==e&&i.binding==t)return i}for(const s of this.entry.vertex)if(s.name===n){for(const i of s.resources)if(i.group==e&&i.binding==t)return i}for(const s of this.entry.fragment)if(s.name===n){for(const i of s.resources)if(i.group==e&&i.binding==t)return i}}for(const s of this.uniforms)if(s.group==e&&s.binding==t)return s;for(const s of this.storage)if(s.group==e&&s.binding==t)return s;for(const s of this.textures)if(s.group==e&&s.binding==t)return s;for(const s of this.samplers)if(s.group==e&&s.binding==t)return s;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const n=[],s=this,i=[];return e.search((a=>{if(a instanceof Fn)i.push({});else if(a instanceof $n)i.pop();else if(a instanceof Ge){const o=a;t&&o.type!==null&&this._markStructsFromAST(o.type),i.length>0&&(i[i.length-1][o.name]=o)}else if(a instanceof De){const o=a;t&&o.type!==null&&this._markStructsFromAST(o.type)}else if(a instanceof Jt){const o=a;t&&o.type!==null&&this._markStructsFromAST(o.type),i.length>0&&(i[i.length-1][o.name]=o)}else if(a instanceof ve){const o=a;if(i.length>0&&i[i.length-1][o.name])return;const l=s._findResource(o.name);l&&n.push(l)}else if(a instanceof fs){const o=a,l=s._functions.get(o.name);l&&(t&&(l.inUse=!0),e.calls.add(l.node),l.resources===null&&(l.resources=s._findResources(l.node,t)),n.push(...l.resources))}else if(a instanceof ps){const o=a,l=s._functions.get(o.name);l&&(t&&(l.inUse=!0),e.calls.add(l.node),l.resources===null&&(l.resources=s._findResources(l.node,t)),n.push(...l.resources))}})),[...new Map(n.map((a=>[a.name,a]))).values()]}getBindGroups(){const e=[];function t(n,s){n>=e.length&&(e.length=n+1),e[n]===void 0&&(e[n]=[]),s>=e[n].length&&(e[n].length=s+1)}for(const n of this.uniforms)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.storage)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.textures)t(n.group,n.binding),e[n.group][n.binding]=n;for(const n of this.samplers)t(n.group,n.binding),e[n.group][n.binding]=n;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof ze)this._getStructOutputs(e,t);else{const n=this._getOutputInfo(e);n!==null&&t.push(n)}return t}_getStructOutputs(e,t){for(const n of e.members)if(n.type instanceof ze)this._getStructOutputs(n.type,t);else{const s=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(s!==null){const i=this.getTypeInfo(n.type,n.type.attributes),a=this._parseInt(s.value),o=new Qs(n.name,i,s.name,a);t.push(o)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const n=this.getTypeInfo(e,e.attributes),s=this._parseInt(t.value);return new Qs("",n,t.name,s)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const n of e)if(n.type instanceof ze)this._getStructInputs(n.type,t);else{const s=this._getInputInfo(n);s!==null&&t.push(s)}return t}_getStructInputs(e,t){for(const n of e.members)if(n.type instanceof ze)this._getStructInputs(n.type,t);else{const s=this._getInputInfo(n);s!==null&&t.push(s)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const n=this._getAttribute(e,"interpolation"),s=this.getTypeInfo(e.type,e.attributes),i=this._parseInt(t.value),a=new Hp(e.name,s,t.name,i);return n!==null&&(a.interpolation=this._parseString(n.value)),a}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new qp(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof Ln){const s=e.type?this.getTypeInfo(e.type,e.attributes):null,i=new Pr(e.name,s,t);return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof en){const s=e,i=s.format?this.getTypeInfo(s.format,s.attributes):null,a=new st(s.name,t);return a.format=i,a.count=s.count,this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof ze){const s=e,i=new nt(s.name,t);i.startLine=s.startLine,i.endLine=s.endLine;for(const a of s.members){const o=this.getTypeInfo(a.type,a.attributes);i.members.push(new Zs(a.name,o,a.attributes))}return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof Zt){const s=e,i=s.format instanceof C,a=s.format?i?this.getTypeInfo(s.format,null):new xe(s.format,null):null,o=new mt(s.name,a,t,s.access);return this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof _){const s=e,i=s.format?this.getTypeInfo(s.format,null):null,a=new mt(s.name,i,t,s.access);return this._types.set(e,a),this._updateTypeInfo(a),a}const n=new xe(e.name,t);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var t,n,s;const i=this._getTypeSize(e);if(e.size=(t=i?.size)!==null&&t!==void 0?t:0,e instanceof st&&e.format){const a=this._getTypeSize(e.format);e.stride=Math.max((n=a?.size)!==null&&n!==void 0?n:0,(s=a?.align)!==null&&s!==void 0?s:0),this._updateTypeInfo(e.format)}e instanceof Pr&&this._updateTypeInfo(e.format),e instanceof nt&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let n=0,s=0,i=0,a=0;for(let o=0,l=e.members.length;o<l;++o){const u=e.members[o],c=this._getTypeSize(u);if(!c)continue;(t=this._getAlias(u.type.name))!==null&&t!==void 0||u.type;const h=c.align,m=c.size;n=this._roundUp(h,n+s),s=m,i=n,a=Math.max(a,h),u.offset=n,u.size=m,this._updateTypeInfo(u.type)}e.size=this._roundUp(a,i+s),e.align=a}_getTypeSize(e){var t,n;if(e==null)return null;const s=this._getAttributeNum(e.attributes,"size",0),i=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Zs&&(e=e.type),e instanceof xe){const a=this._getAlias(e.name);a!==null&&(e=a)}{const a=Oe._typeInfo[e.name];if(a!==void 0){const o=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new Pn(Math.max(i,a.align/o),Math.max(s,a.size/o))}}{const a=Oe._typeInfo[e.name.substring(0,e.name.length-1)];if(a){const o=e.name[e.name.length-1]==="h"?2:1;return new Pn(Math.max(i,a.align/o),Math.max(s,a.size/o))}}if(e instanceof st){let a=e,o=8,l=8;const u=this._getTypeSize(a.format);return u!==null&&(l=u.size,o=u.align),l=a.count*this._getAttributeNum((n=e?.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(o,l)),s&&(l=s),new Pn(Math.max(i,o),Math.max(s,l))}if(e instanceof nt){let a=0,o=0,l=0,u=0,c=0;for(const h of e.members){const m=this._getTypeSize(h.type);m!==null&&(a=Math.max(m.align,a),l=this._roundUp(m.align,l+u),u=m.size,c=l)}return o=this._roundUp(a,c+u),new Pn(Math.max(i,a),Math.max(s,o))}return null}_isUniformVar(e){return e instanceof Ge&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Ge&&e.storage=="storage"}_isTextureVar(e){return e instanceof Ge&&e.type!==null&&Oe._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Ge&&e.type!==null&&Oe._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const n=e;if(!n||!n.attributes)return null;const s=n.attributes;for(let i of s)if(i.name==t)return i;return null}_getAttributeNum(e,t,n){if(e===null)return n;for(let s of e)if(s.name==t){let i=s!==null&&s.value!==null?s.value:n;return i instanceof Array&&(i=i[0]),typeof i=="number"?i:typeof i=="string"?parseInt(i):n}return n}_roundUp(e,t){return Math.ceil(t/e)*e}}Oe._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Oe._textureTypes=p.any_texture_type.map((r=>r.name)),Oe._samplerTypes=p.sampler_type.map((r=>r.name));let ms=0;class vs{constructor(e,t,n){this.id=ms++,this.name=e,this.value=t,this.node=n}clone(){return new vs(this.name,this.value,this.node)}}class gs{constructor(e){this.id=ms++,this.name=e.name,this.node=e}clone(){return new gs(this.node)}}class bs{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=ms++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,n){this.variables.set(e,new vs(e,t,n??null))}setVariable(e,t,n){const s=this.getVariable(e);s!==null?s.value=t:this.createVariable(e,t,n)}getVariableValue(e){var t;const n=this.getVariable(e);return(t=n?.value)!==null&&t!==void 0?t:null}clone(){return new bs(this)}}class fd{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class md{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const n=this.exec.evalExpression(e.args[0],t);let s=!0;if(n instanceof d)return n.data.forEach((i=>{i||(s=!1)})),new v(s?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d){const s=n.data.some((i=>i));return new v(s?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const n=this.exec.evalExpression(e.args[2],t);if(!(n instanceof v))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return n.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let n=e.args[0];n instanceof Z&&(n=n.right);const s=this.exec.evalExpression(n,t);if(s instanceof Y&&s.typeInfo.size===0){const i=s.typeInfo,a=s.buffer.byteLength/i.stride;return new v(a,this.getTypeInfo("u32"))}return new v(s.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>Math.abs(i))),n.typeInfo);const s=n;return new v(Math.abs(s.value),s.typeInfo)}Acos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>Math.acos(i))),n.typeInfo);const s=n;return new v(Math.acos(s.value),n.typeInfo)}Acosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>Math.acosh(i))),n.typeInfo);const s=n;return new v(Math.acosh(s.value),n.typeInfo)}Asin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>Math.asin(i))),n.typeInfo);const s=n;return new v(Math.asin(s.value),n.typeInfo)}Asinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>Math.asinh(i))),n.typeInfo);const s=n;return new v(Math.asinh(s.value),n.typeInfo)}Atan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>Math.atan(i))),n.typeInfo);const s=n;return new v(Math.atan(s.value),n.typeInfo)}Atanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>Math.atanh(i))),n.typeInfo);const s=n;return new v(Math.atanh(s.value),n.typeInfo)}Atan2(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof d&&s instanceof d)return new d(n.data.map(((o,l)=>Math.atan2(o,s.data[l]))),n.typeInfo);const i=n,a=s;return new v(Math.atan2(i.value,a.value),n.typeInfo)}Ceil(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>Math.ceil(i))),n.typeInfo);const s=n;return new v(Math.ceil(s.value),n.typeInfo)}_clamp(e,t,n){return Math.min(Math.max(e,t),n)}Clamp(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(n instanceof d&&s instanceof d&&i instanceof d)return new d(n.data.map(((u,c)=>this._clamp(u,s.data[c],i.data[c]))),n.typeInfo);const a=n,o=s,l=i;return new v(this._clamp(a.value,o.value,l.value),n.typeInfo)}Cos(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>Math.cos(i))),n.typeInfo);const s=n;return new v(Math.cos(s.value),n.typeInfo)}Cosh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>Math.cosh(i))),n.typeInfo);const s=n;return new v(Math.cos(s.value),n.typeInfo)}CountLeadingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>Math.clz32(i))),n.typeInfo);const s=n;return new v(Math.clz32(s.value),n.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>this._countOneBits(i))),n.typeInfo);const s=n;return new v(this._countOneBits(s.value),n.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>this._countTrailingZeros(i))),n.typeInfo);const s=n;return new v(this._countTrailingZeros(s.value),n.typeInfo)}Cross(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof d&&s instanceof d){if(n.data.length!==3||s.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const i=n.data,a=s.data;return new d([i[1]*a[2]-a[1]*i[2],i[2]*a[0]-a[2]*i[0],i[0]*a[1]-a[0]*i[1]],n.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const n=this.exec.evalExpression(e.args[0],t),s=180/Math.PI;return n instanceof d?new d(n.data.map((i=>i*s)),n.typeInfo):new v(n.value*s,this.getTypeInfo("f32"))}Determinant(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof V){const s=n.data,i=n.typeInfo.getTypeName(),a=i.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(i==="mat2x2"||i==="mat2x2f"||i==="mat2x2h")return new v(s[0]*s[3]-s[1]*s[2],a);if(i==="mat2x3"||i==="mat2x3f"||i==="mat2x3h")return new v(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),a);if(i==="mat2x4"||i==="mat2x4f"||i==="mat2x4h")console.error(`TODO: Determinant for ${i}`);else if(i==="mat3x2"||i==="mat3x2f"||i==="mat3x2h")console.error(`TODO: Determinant for ${i}`);else{if(i==="mat3x3"||i==="mat3x3f"||i==="mat3x3h")return new v(s[0]*(s[4]*s[8]-s[5]*s[7])-s[1]*(s[3]*s[8]-s[5]*s[6])+s[2]*(s[3]*s[7]-s[4]*s[6]),a);i==="mat3x4"||i==="mat3x4f"||i==="mat3x4h"||i==="mat4x2"||i==="mat4x2f"||i==="mat4x2h"||i==="mat4x3"||i==="mat4x3f"||i==="mat4x3h"?console.error(`TODO: Determinant for ${i}`):i!=="mat4x4"&&i!=="mat4x4f"&&i!=="mat4x4h"||console.error(`TODO: Determinant for ${i}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof d&&s instanceof d){let o=0;for(let l=0;l<n.data.length;++l)o+=(n.data[l]-s.data[l])*(n.data[l]-s.data[l]);return new v(Math.sqrt(o),this.getTypeInfo("f32"))}const i=n,a=s;return new v(Math.abs(i.value-a.value),n.typeInfo)}_dot(e,t){let n=0;for(let s=0;s<e.length;++s)n+=t[s]*e[s];return n}Dot(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);return n instanceof d&&s instanceof d?new v(this._dot(n.data,s.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>Math.exp(i))),n.typeInfo);const s=n;return new v(Math.exp(s.value),n.typeInfo)}Exp2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>Math.pow(2,i))),n.typeInfo);const s=n;return new v(Math.pow(2,s.value),n.typeInfo)}ExtractBits(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const a=s.value,o=i.value;if(n instanceof d)return new d(n.data.map((u=>u>>a&(1<<o)-1)),n.typeInfo);if(n.typeInfo.name!=="i32"&&n.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const l=n.value;return new v(l>>a&(1<<o)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(n instanceof d&&s instanceof d&&i instanceof d){const a=this._dot(s.data,i.data);return new d(a<0?Array.from(n.data):n.data.map((o=>-o)),n.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>this._firstLeadingBit(i))),n.typeInfo);const s=n;return new v(this._firstLeadingBit(s.value),n.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>this._firstTrailingBit(i))),n.typeInfo);const s=n;return new v(this._firstTrailingBit(s.value),n.typeInfo)}Floor(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>Math.floor(i))),n.typeInfo);const s=n;return new v(Math.floor(s.value),n.typeInfo)}Fma(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(n instanceof d&&s instanceof d&&i instanceof d)return n.data.length!==s.data.length||n.data.length!==i.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new d(n.data.map(((u,c)=>u*s.data[c]+i.data[c])),n.typeInfo);const a=n,o=s,l=i;return new v(a.value*o.value+l.value,a.typeInfo)}Fract(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>i-Math.floor(i))),n.typeInfo);const s=n;return new v(s.value-Math.floor(s.value),n.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t),a=this.exec.evalExpression(e.args[3],t);if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const o=i.value,l=(1<<a.value)-1<<o,u=~l;if(n instanceof d&&s instanceof d)return new d(n.data.map(((m,f)=>m&u|s.data[f]<<o&l)),n.typeInfo);const c=n.value,h=s.value;return new v(c&u|h<<o&l,n.typeInfo)}InverseSqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>1/Math.sqrt(i))),n.typeInfo);const s=n;return new v(1/Math.sqrt(s.value),n.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d){let i=0;return n.data.forEach((a=>{i+=a*a})),new v(Math.sqrt(i),this.getTypeInfo("f32"))}const s=n;return new v(Math.abs(s.value),n.typeInfo)}Log(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>Math.log(i))),n.typeInfo);const s=n;return new v(Math.log(s.value),n.typeInfo)}Log2(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>Math.log2(i))),n.typeInfo);const s=n;return new v(Math.log2(s.value),n.typeInfo)}Max(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof d&&s instanceof d)return new d(n.data.map(((o,l)=>Math.max(o,s.data[l]))),n.typeInfo);const i=n,a=s;return new v(Math.max(i.value,a.value),n.typeInfo)}Min(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof d&&s instanceof d)return new d(n.data.map(((o,l)=>Math.min(o,s.data[l]))),n.typeInfo);const i=n,a=s;return new v(Math.min(i.value,a.value),n.typeInfo)}Mix(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(n instanceof d&&s instanceof d&&i instanceof d)return new d(n.data.map(((l,u)=>n.data[u]*(1-i.data[u])+s.data[u]*i.data[u])),n.typeInfo);const a=s,o=i;return new v(n.value*(1-o.value)+a.value*o.value,n.typeInfo)}Modf(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof d&&s instanceof d)return new d(n.data.map(((a,o)=>a%s.data[o])),n.typeInfo);const i=s;return new v(n.value%i.value,n.typeInfo)}Normalize(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d){const s=this.Length(e,t).value;return new d(n.data.map((i=>i/s)),n.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof d&&s instanceof d)return new d(n.data.map(((o,l)=>Math.pow(o,s.data[l]))),n.typeInfo);const i=n,a=s;return new v(Math.pow(i.value,a.value),n.typeInfo)}QuantizeToF16(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof d?new d(n.data.map((s=>s)),n.typeInfo):new v(n.value,n.typeInfo)}Radians(e,t){const n=this.exec.evalExpression(e.args[0],t);return n instanceof d?new d(n.data.map((s=>s*Math.PI/180)),n.typeInfo):new v(n.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(n instanceof d&&s instanceof d){const i=this._dot(n.data,s.data);return new d(n.data.map(((a,o)=>a-2*i*s.data[o])),n.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(n instanceof d&&s instanceof d&&i instanceof v){const a=this._dot(s.data,n.data);return new d(n.data.map(((o,l)=>{const u=1-i.value*i.value*(1-a*a);if(u<0)return 0;const c=Math.sqrt(u);return i.value*o-(i.value*a+c)*s.data[l]})),n.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>Math.round(i))),n.typeInfo);const s=n;return new v(Math.round(s.value),n.typeInfo)}Saturate(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>Math.min(Math.max(i,0),1))),n.typeInfo);const s=n;return new v(Math.min(Math.max(s.value,0),1),n.typeInfo)}Sign(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>Math.sign(i))),n.typeInfo);const s=n;return new v(Math.sign(s.value),n.typeInfo)}Sin(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>Math.sin(i))),n.typeInfo);const s=n;return new v(Math.sin(s.value),n.typeInfo)}Sinh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>Math.sinh(i))),n.typeInfo);const s=n;return new v(Math.sinh(s.value),n.typeInfo)}_smoothstep(e,t,n){const s=Math.min(Math.max((n-e)/(t-e),0),1);return s*s*(3-2*s)}SmoothStep(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t),i=this.exec.evalExpression(e.args[2],t);if(i instanceof d&&n instanceof d&&s instanceof d)return new d(i.data.map(((u,c)=>this._smoothstep(n.data[c],s.data[c],u))),i.typeInfo);const a=n,o=s,l=i;return new v(this._smoothstep(a.value,o.value,l.value),i.typeInfo)}Sqrt(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>Math.sqrt(i))),n.typeInfo);const s=n;return new v(Math.sqrt(s.value),n.typeInfo)}Step(e,t){const n=this.exec.evalExpression(e.args[0],t),s=this.exec.evalExpression(e.args[1],t);if(s instanceof d&&n instanceof d)return new d(s.data.map(((a,o)=>a<n.data[o]?0:1)),s.typeInfo);const i=n;return new v(s.value<i.value?0:1,i.typeInfo)}Tan(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>Math.tan(i))),n.typeInfo);const s=n;return new v(Math.tan(s.value),n.typeInfo)}Tanh(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>Math.tanh(i))),n.typeInfo);const s=n;return new v(Math.tanh(s.value),n.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const n=this.exec.evalExpression(e.args[0],t);if(!(n instanceof V))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const s=this._getTransposeType(n.typeInfo);if(n.typeInfo.name==="mat2x2"||n.typeInfo.name==="mat2x2f"||n.typeInfo.name==="mat2x2h"){const i=n.data;return new V([i[0],i[2],i[1],i[3]],s)}if(n.typeInfo.name==="mat2x3"||n.typeInfo.name==="mat2x3f"||n.typeInfo.name==="mat2x3h"){const i=n.data;return new V([i[0],i[3],i[6],i[1],i[4],i[7]],s)}if(n.typeInfo.name==="mat2x4"||n.typeInfo.name==="mat2x4f"||n.typeInfo.name==="mat2x4h"){const i=n.data;return new V([i[0],i[4],i[8],i[12],i[1],i[5],i[9],i[13]],s)}if(n.typeInfo.name==="mat3x2"||n.typeInfo.name==="mat3x2f"||n.typeInfo.name==="mat3x2h"){const i=n.data;return new V([i[0],i[3],i[1],i[4],i[2],i[5]],s)}if(n.typeInfo.name==="mat3x3"||n.typeInfo.name==="mat3x3f"||n.typeInfo.name==="mat3x3h"){const i=n.data;return new V([i[0],i[3],i[6],i[1],i[4],i[7],i[2],i[5],i[8]],s)}if(n.typeInfo.name==="mat3x4"||n.typeInfo.name==="mat3x4f"||n.typeInfo.name==="mat3x4h"){const i=n.data;return new V([i[0],i[4],i[8],i[12],i[1],i[5],i[9],i[13],i[2],i[6],i[10],i[14]],s)}if(n.typeInfo.name==="mat4x2"||n.typeInfo.name==="mat4x2f"||n.typeInfo.name==="mat4x2h"){const i=n.data;return new V([i[0],i[4],i[1],i[5],i[2],i[6]],s)}if(n.typeInfo.name==="mat4x3"||n.typeInfo.name==="mat4x3f"||n.typeInfo.name==="mat4x3h"){const i=n.data;return new V([i[0],i[4],i[8],i[1],i[5],i[9],i[2],i[6],i[10]],s)}if(n.typeInfo.name==="mat4x4"||n.typeInfo.name==="mat4x4f"||n.typeInfo.name==="mat4x4h"){const i=n.data;return new V([i[0],i[4],i[8],i[12],i[1],i[5],i[9],i[13],i[2],i[6],i[10],i[14],i[3],i[7],i[11],i[15]],s)}return console.error(`Invalid matrix type ${n.typeInfo.name}`),null}Trunc(e,t){const n=this.exec.evalExpression(e.args[0],t);if(n instanceof d)return new d(n.data.map((i=>Math.trunc(i))),n.typeInfo);const s=n;return new v(Math.trunc(s.value),n.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const n=e.args[0],s=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(n instanceof ve){const i=n.name,a=t.getVariableValue(i);if(a instanceof Re){if(s<0||s>=a.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const o=a.getMipLevelSize(s),l=a.dimension;return l==="1d"?new v(o[0],this.getTypeInfo("u32")):l==="3d"?new d(o,this.getTypeInfo("vec3u")):l==="2d"?new d(o.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${l} not found. Line ${e.line}`),null)}return console.error(`Texture ${i} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const n=e.args[0],s=this.exec.evalExpression(e.args[1],t),i=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(s instanceof d)||s.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(n instanceof ve){const a=n.name,o=t.getVariableValue(a);if(o instanceof Re){const l=Math.floor(s.data[0]),u=Math.floor(s.data[1]);if(l<0||l>=o.width||u<0||u>=o.height)return console.error(`Texture ${a} out of bounds. Line ${e.line}`),null;const c=o.getPixel(l,u,0,i);return c===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new d(c,this.getTypeInfo("vec4f"))}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const n=e.args[0];if(n instanceof ve){const s=n.name,i=t.getVariableValue(s);return i instanceof Re?new v(i.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const n=e.args[0];if(n instanceof ve){const s=n.name,i=t.getVariableValue(s);return i instanceof Re?new v(i.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const n=e.args[0];if(n instanceof ve){const s=n.name,i=t.getVariableValue(s);return i instanceof Re?new v(i.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${s} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const n=e.args[0],s=this.exec.evalExpression(e.args[1],t),i=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,a=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(a.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(s instanceof d)||s.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(n instanceof ve){const o=n.name,l=t.getVariableValue(o);if(l instanceof Re){const u=l.getMipLevelSize(0),c=Math.floor(s.data[0]),h=Math.floor(s.data[1]);return c<0||c>=u[0]||h<0||h>=u[1]?(console.error(`Texture ${o} out of bounds. Line ${e.line}`),null):(l.setPixel(c,h,0,i,Array.from(a)),null)}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let n=e.args[0];n instanceof Z&&(n=n.right);const s=this.exec.getVariableName(n,t);return t.getVariable(s).value.getSubData(this.exec,n.postfix,t)}AtomicStore(e,t){let n=e.args[0];n instanceof Z&&(n=n.right);const s=this.exec.getVariableName(n,t),i=t.getVariable(s);let a=e.args[1];const o=this.exec.evalExpression(a,t),l=i.value.getSubData(this.exec,n.postfix,t);return l instanceof v&&o instanceof v&&(l.value=o.value),i.value instanceof Y&&i.value.setDataValue(this.exec,l,n.postfix,t),null}AtomicAdd(e,t){let n=e.args[0];n instanceof Z&&(n=n.right);const s=this.exec.getVariableName(n,t),i=t.getVariable(s);let a=e.args[1];const o=this.exec.evalExpression(a,t),l=i.value.getSubData(this.exec,n.postfix,t),u=new v(l.value,l.typeInfo);return l instanceof v&&o instanceof v&&(l.value+=o.value),i.value instanceof Y&&i.value.setDataValue(this.exec,l,n.postfix,t),u}AtomicSub(e,t){let n=e.args[0];n instanceof Z&&(n=n.right);const s=this.exec.getVariableName(n,t),i=t.getVariable(s);let a=e.args[1];const o=this.exec.evalExpression(a,t),l=i.value.getSubData(this.exec,n.postfix,t),u=new v(l.value,l.typeInfo);return l instanceof v&&o instanceof v&&(l.value-=o.value),i.value instanceof Y&&i.value.setDataValue(this.exec,l,n.postfix,t),u}AtomicMax(e,t){let n=e.args[0];n instanceof Z&&(n=n.right);const s=this.exec.getVariableName(n,t),i=t.getVariable(s);let a=e.args[1];const o=this.exec.evalExpression(a,t),l=i.value.getSubData(this.exec,n.postfix,t),u=new v(l.value,l.typeInfo);return l instanceof v&&o instanceof v&&(l.value=Math.max(l.value,o.value)),i.value instanceof Y&&i.value.setDataValue(this.exec,l,n.postfix,t),u}AtomicMin(e,t){let n=e.args[0];n instanceof Z&&(n=n.right);const s=this.exec.getVariableName(n,t),i=t.getVariable(s);let a=e.args[1];const o=this.exec.evalExpression(a,t),l=i.value.getSubData(this.exec,n.postfix,t),u=new v(l.value,l.typeInfo);return l instanceof v&&o instanceof v&&(l.value=Math.min(l.value,o.value)),i.value instanceof Y&&i.value.setDataValue(this.exec,l,n.postfix,t),u}AtomicAnd(e,t){let n=e.args[0];n instanceof Z&&(n=n.right);const s=this.exec.getVariableName(n,t),i=t.getVariable(s);let a=e.args[1];const o=this.exec.evalExpression(a,t),l=i.value.getSubData(this.exec,n.postfix,t),u=new v(l.value,l.typeInfo);return l instanceof v&&o instanceof v&&(l.value=l.value&o.value),i.value instanceof Y&&i.value.setDataValue(this.exec,l,n.postfix,t),u}AtomicOr(e,t){let n=e.args[0];n instanceof Z&&(n=n.right);const s=this.exec.getVariableName(n,t),i=t.getVariable(s);let a=e.args[1];const o=this.exec.evalExpression(a,t),l=i.value.getSubData(this.exec,n.postfix,t),u=new v(l.value,l.typeInfo);return l instanceof v&&o instanceof v&&(l.value=l.value|o.value),i.value instanceof Y&&i.value.setDataValue(this.exec,l,n.postfix,t),u}AtomicXor(e,t){let n=e.args[0];n instanceof Z&&(n=n.right);const s=this.exec.getVariableName(n,t),i=t.getVariable(s);let a=e.args[1];const o=this.exec.evalExpression(a,t),l=i.value.getSubData(this.exec,n.postfix,t),u=new v(l.value,l.typeInfo);return l instanceof v&&o instanceof v&&(l.value=l.value^o.value),i.value instanceof Y&&i.value.setDataValue(this.exec,l,n.postfix,t),u}AtomicExchange(e,t){let n=e.args[0];n instanceof Z&&(n=n.right);const s=this.exec.getVariableName(n,t),i=t.getVariable(s);let a=e.args[1];const o=this.exec.evalExpression(a,t),l=i.value.getSubData(this.exec,n.postfix,t),u=new v(l.value,l.typeInfo);return l instanceof v&&o instanceof v&&(l.value=o.value),i.value instanceof Y&&i.value.setDataValue(this.exec,l,n.postfix,t),u}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const dr={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},ae={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class ie extends fd{constructor(e,t){var n;super(),this.ast=e??[],this.reflection=new Oe,this.reflection.updateAST(this.ast),this.context=(n=t?.clone())!==null&&n!==void 0?n:new bs,this.builtins=new md(this),this.typeInfo={bool:this.getTypeInfo(C.bool),i32:this.getTypeInfo(C.i32),u32:this.getTypeInfo(C.u32),f32:this.getTypeInfo(C.f32),f16:this.getTypeInfo(C.f16),vec2f:this.getTypeInfo(_.vec2f),vec2u:this.getTypeInfo(_.vec2u),vec2i:this.getTypeInfo(_.vec2i),vec2h:this.getTypeInfo(_.vec2h),vec3f:this.getTypeInfo(_.vec3f),vec3u:this.getTypeInfo(_.vec3u),vec3i:this.getTypeInfo(_.vec3i),vec3h:this.getTypeInfo(_.vec3h),vec4f:this.getTypeInfo(_.vec4f),vec4u:this.getTypeInfo(_.vec4u),vec4i:this.getTypeInfo(_.vec4i),vec4h:this.getTypeInfo(_.vec4h),mat2x2f:this.getTypeInfo(_.mat2x2f),mat2x3f:this.getTypeInfo(_.mat2x3f),mat2x4f:this.getTypeInfo(_.mat2x4f),mat3x2f:this.getTypeInfo(_.mat3x2f),mat3x3f:this.getTypeInfo(_.mat3x3f),mat3x4f:this.getTypeInfo(_.mat3x4f),mat4x2f:this.getTypeInfo(_.mat4x2f),mat4x3f:this.getTypeInfo(_.mat4x3f),mat4x4f:this.getTypeInfo(_.mat4x4f)}}getVariableValue(e){var t,n;const s=(n=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&n!==void 0?n:null;if(s===null)return null;if(s instanceof v)return s.value;if(s instanceof d||s instanceof V)return Array.from(s.data);if(s instanceof Y&&s.typeInfo instanceof st){if(s.typeInfo.format.name==="u32")return Array.from(new Uint32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="i32")return Array.from(new Int32Array(s.buffer,s.offset,s.typeInfo.count));if(s.typeInfo.format.name==="f32")return Array.from(new Float32Array(s.buffer,s.offset,s.typeInfo.count))}return console.error(`Unsupported return variable type ${s.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,n,s){const i=this.context.clone();(s=s??{}).constants&&this._setOverrides(s.constants,i),this._execStatements(this.ast,i);const a=i.getFunction(e);if(!a)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const o=t[0],l=t[1],u=t[2],c=this.getTypeInfo("vec3u");i.setVariable("@num_workgroups",new d(t,c));for(const h in n)for(const m in n[h]){const f=n[h][m];i.variables.forEach((w=>{var k;const y=w.node;if(y?.attributes){let T=null,P=null;for(const E of y.attributes)E.name==="binding"?T=E.value:E.name==="group"&&(P=E.value);if(m==T&&h==P)if(f.texture!==void 0&&f.descriptor!==void 0){const E=new Re(f.texture,this.getTypeInfo(y.type),f.descriptor,(k=f.texture.view)!==null&&k!==void 0?k:null);w.value=E}else f.uniform!==void 0?w.value=new Y(f.uniform,this.getTypeInfo(y.type)):w.value=new Y(f,this.getTypeInfo(y.type))}}))}for(let h=0;h<u;++h)for(let m=0;m<l;++m)for(let f=0;f<o;++f)i.setVariable("@workgroup_id",new d([f,m,h],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(a,[f,m,h],i)}execStatement(e,t){if(e instanceof Oo)return this.evalExpression(e.value,t);if(e instanceof Uo){if(e.condition){const n=this.evalExpression(e.condition,t);if(!(n instanceof v))throw new Error("Invalid break-if condition");if(!n.value)return null}return ie._breakObj}if(e instanceof No)return ie._continueObj;if(e instanceof Jt)this._let(e,t);else if(e instanceof Ge)this._var(e,t);else if(e instanceof Vn)this._const(e,t);else if(e instanceof cn)this._function(e,t);else{if(e instanceof Mo)return this._if(e,t);if(e instanceof Do)return this._switch(e,t);if(e instanceof So)return this._for(e,t);if(e instanceof Po)return this._while(e,t);if(e instanceof Lo)return this._loop(e,t);if(e instanceof Sr){const n=t.clone();return n.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,n)}if(e instanceof Vo)this._assign(e,t);else if(e instanceof Ao)this._increment(e,t);else{if(e instanceof ze)return null;if(e instanceof hs){const n=e.name;t.getVariable(n)===null&&t.setVariable(n,new v(0,this.getTypeInfo("u32")))}else if(e instanceof ps)this._call(e,t);else{if(e instanceof Bo||e instanceof ds)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof Te?this._evalBinaryOp(e,t):e instanceof J?this._evalLiteral(e,t):e instanceof ve?this._evalVariable(e,t):e instanceof fs?this._evalCall(e,t):e instanceof De?this._evalCreate(e,t):e instanceof Fo?this._evalConst(e,t):e instanceof $o?this._evalBitcast(e,t):e instanceof Z?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof C){const s=this.reflection.getTypeInfo(e);if(s!==null)return s}let n=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return n!==null||(n=this.reflection.getTypeInfoByName(e)),n}_setOverrides(e,t){for(const n in e){const s=e[n],i=this.reflection.getOverrideInfo(n);i!==null?(i.type===null&&(i.type=this.getTypeInfo("u32")),i.type.name==="u32"||i.type.name==="i32"||i.type.name==="f32"||i.type.name==="f16"?t.setVariable(n,new v(s,i.type)):i.type.name==="bool"?t.setVariable(n,new v(s?1:0,i.type)):i.type.name==="vec2"||i.type.name==="vec3"||i.type.name==="vec4"||i.type.name==="vec2f"||i.type.name==="vec3f"||i.type.name==="vec4f"||i.type.name==="vec2i"||i.type.name==="vec3i"||i.type.name==="vec4i"||i.type.name==="vec2u"||i.type.name==="vec3u"||i.type.name==="vec4u"||i.type.name==="vec2h"||i.type.name==="vec3h"||i.type.name==="vec4h"?t.setVariable(n,new d(s,i.type)):console.error(`Invalid constant type for ${n}`)):console.error(`Override ${n} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,n){const s=[1,1,1];for(const c of e.node.attributes)if(c.name==="workgroup_size"){if(c.value.length>0){const h=n.getVariableValue(c.value[0]);s[0]=h instanceof v?h.value:parseInt(c.value[0])}if(c.value.length>1){const h=n.getVariableValue(c.value[1]);s[1]=h instanceof v?h.value:parseInt(c.value[1])}if(c.value.length>2){const h=n.getVariableValue(c.value[2]);s[2]=h instanceof v?h.value:parseInt(c.value[2])}}const i=this.getTypeInfo("vec3u"),a=this.getTypeInfo("u32");n.setVariable("@workgroup_size",new d(s,i));const o=s[0],l=s[1],u=s[2];for(let c=0,h=0;c<u;++c)for(let m=0;m<l;++m)for(let f=0;f<o;++f,++h){const w=[f,m,c],k=[f+t[0]*s[0],m+t[1]*s[1],c+t[2]*s[2]];n.setVariable("@local_invocation_id",new d(w,i)),n.setVariable("@global_invocation_id",new d(k,i)),n.setVariable("@local_invocation_index",new v(h,a)),this._dispatchExec(e,n)}}_dispatchExec(e,t){for(const n of e.node.args)for(const s of n.attributes)if(s.name==="builtin"){const i=`@${s.value}`,a=t.getVariable(i);a!==void 0&&t.variables.set(n.name,a)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof Z;)e=e.right;return e instanceof ve?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const n of e){if(n instanceof Array){const i=t.clone(),a=this._execStatements(n,i);if(a)return a;continue}const s=this.execStatement(n,t);if(s)return s}return null}_call(e,t){const n=t.clone();n.currentFunctionName=e.name;const s=t.getFunction(e.name);if(s){for(let i=0;i<s.node.args.length;++i){const a=s.node.args[i],o=this.evalExpression(e.args[i],n);n.setVariable(a.name,o,a)}this._execStatements(s.node.body,n)}else e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const n=this.getVariableName(e.variable,t),s=t.getVariable(n);s?e.operator==="++"?s.value instanceof v?s.value.value++:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):e.operator==="--"?s.value instanceof v?s.value.value--:console.error(`Variable ${n} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${n} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof ve){const n=this.getVariableName(e,t),s=t.getVariable(n);return s===null?(console.error(`Variable ${n} not found. Line ${e.line}`),null):s.value.getSubData(this,e.postfix,t)}if(e instanceof Z){if(e.operator==="*"){const n=this._getVariableData(e.right,t);return n instanceof kt?n.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const n=this._getVariableData(e.right,t);return new kt(n)}}return null}_assign(e,t){let n=null,s="<var>",i=null;if(e.variable instanceof Z){const l=this._getVariableData(e.variable,t),u=this.evalExpression(e.value,t),c=e.operator;if(c==="="){if(l instanceof v||l instanceof d||l instanceof V){if(u instanceof v||u instanceof d||u instanceof V&&l.data.length===u.data.length)return void l.data.set(u.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(l instanceof Y&&u instanceof Y&&l.buffer.byteLength-l.offset>=u.buffer.byteLength-u.offset)return void(l.buffer.byteLength%4==0?new Uint32Array(l.buffer,l.offset,l.typeInfo.size/4).set(new Uint32Array(u.buffer,u.offset,u.typeInfo.size/4)):new Uint8Array(l.buffer,l.offset,l.typeInfo.size).set(new Uint8Array(u.buffer,u.offset,u.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(c==="+=")return l instanceof v||l instanceof d||l instanceof V?u instanceof v||u instanceof d||u instanceof V?void l.data.set(u.data.map(((h,m)=>l.data[m]+h))):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(c==="-=")return(l instanceof v||l instanceof d||l instanceof V)&&(u instanceof v||u instanceof d||u instanceof V)?void l.data.set(u.data.map(((h,m)=>l.data[m]-h))):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof Z){if(e.variable.operator==="*"){s=this.getVariableName(e.variable.right,t);const l=t.getVariable(s);if(!(l&&l.value instanceof kt))return void console.error(`Variable ${s} is not a pointer. Line ${e.line}`);n=l.value.reference;let u=e.variable.postfix;if(!u){let c=e.variable.right;for(;c instanceof Z;){if(c.postfix){u=c.postfix;break}c=c.right}}u&&(n=n.getSubData(this,u,t))}}else{i=e.variable.postfix,s=this.getVariableName(e.variable,t);const l=t.getVariable(s);if(l===null)return void console.error(`Variable ${s} not found. Line ${e.line}`);n=l.value}if(n instanceof kt&&(n=n.reference),n===null)return void console.error(`Variable ${s} not found. Line ${e.line}`);const a=this.evalExpression(e.value,t),o=e.operator;if(o==="=")if(n instanceof Y)n.setDataValue(this,a,i,t);else if(i){if(!(n instanceof d||n instanceof V))return void console.error(`Variable ${s} is not a vector or matrix. Line ${e.line}`);if(i instanceof Dt){const l=this.evalExpression(i.index,t).value;if(n instanceof d){if(!(a instanceof v))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[l]=a.value}else{if(!(n instanceof V))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);{const u=this.evalExpression(i.index,t).value;if(u<0)return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(!(a instanceof d))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);{const c=n.typeInfo.getTypeName();if(c==="mat2x2"||c==="mat2x2f"||c==="mat2x2h"){if(!(u<2&&a.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[2*u]=a.data[0],n.data[2*u+1]=a.data[1]}else if(c==="mat2x3"||c==="mat2x3f"||c==="mat2x3h"){if(!(u<2&&a.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[3*u]=a.data[0],n.data[3*u+1]=a.data[1],n.data[3*u+2]=a.data[2]}else if(c==="mat2x4"||c==="mat2x4f"||c==="mat2x4h"){if(!(u<2&&a.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[4*u]=a.data[0],n.data[4*u+1]=a.data[1],n.data[4*u+2]=a.data[2],n.data[4*u+3]=a.data[3]}else if(c==="mat3x2"||c==="mat3x2f"||c==="mat3x2h"){if(!(u<3&&a.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[2*u]=a.data[0],n.data[2*u+1]=a.data[1]}else if(c==="mat3x3"||c==="mat3x3f"||c==="mat3x3h"){if(!(u<3&&a.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[3*u]=a.data[0],n.data[3*u+1]=a.data[1],n.data[3*u+2]=a.data[2]}else if(c==="mat3x4"||c==="mat3x4f"||c==="mat3x4h"){if(!(u<3&&a.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[4*u]=a.data[0],n.data[4*u+1]=a.data[1],n.data[4*u+2]=a.data[2],n.data[4*u+3]=a.data[3]}else if(c==="mat4x2"||c==="mat4x2f"||c==="mat4x2h"){if(!(u<4&&a.data.length===2))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[2*u]=a.data[0],n.data[2*u+1]=a.data[1]}else if(c==="mat4x3"||c==="mat4x3f"||c==="mat4x3h"){if(!(u<4&&a.data.length===3))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[3*u]=a.data[0],n.data[3*u+1]=a.data[1],n.data[3*u+2]=a.data[2]}else{if(c!=="mat4x4"&&c!=="mat4x4f"&&c!=="mat4x4h")return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(!(u<4&&a.data.length===4))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);n.data[4*u]=a.data[0],n.data[4*u+1]=a.data[1],n.data[4*u+2]=a.data[2],n.data[4*u+3]=a.data[3]}}}}}else if(i instanceof vt){const l=i.value;if(!(n instanceof d))return void console.error(`Invalid assignment to ${l}. Variable ${s} is not a vector. Line ${e.line}`);if(a instanceof v){if(l.length>1)return void console.error(`Invalid assignment to ${l} for variable ${s}. Line ${e.line}`);if(l==="x")n.data[0]=a.value;else if(l==="y"){if(n.data.length<2)return void console.error(`Invalid assignment to ${l} for variable ${s}. Line ${e.line}`);n.data[1]=a.value}else if(l==="z"){if(n.data.length<3)return void console.error(`Invalid assignment to ${l} for variable ${s}. Line ${e.line}`);n.data[2]=a.value}else if(l==="w"){if(n.data.length<4)return void console.error(`Invalid assignment to ${l} for variable ${s}. Line ${e.line}`);n.data[3]=a.value}}else{if(!(a instanceof d))return void console.error(`Invalid assignment to ${s}. Line ${e.line}`);if(l.length!==a.data.length)return void console.error(`Invalid assignment to ${l} for variable ${s}. Line ${e.line}`);for(let u=0;u<l.length;++u){const c=l[u];if(c==="x"||c==="r")n.data[0]=a.data[u];else if(c==="y"||c==="g"){if(a.data.length<2)return void console.error(`Invalid assignment to ${c} for variable ${s}. Line ${e.line}`);n.data[1]=a.data[u]}else if(c==="z"||c==="b"){if(a.data.length<3)return void console.error(`Invalid assignment to ${c} for variable ${s}. Line ${e.line}`);n.data[2]=a.data[u]}else{if(c!=="w"&&c!=="a")return void console.error(`Invalid assignment to ${c} for variable ${s}. Line ${e.line}`);if(a.data.length<4)return void console.error(`Invalid assignment to ${c} for variable ${s}. Line ${e.line}`);n.data[3]=a.data[u]}}}}}else n instanceof v&&a instanceof v?n.value=a.value:n instanceof d&&a instanceof d||n instanceof V&&a instanceof V?n.data.set(a.data):console.error(`Invalid assignment to ${s}. Line ${e.line}`);else{const l=n.getSubData(this,i,t);if(l instanceof d&&a instanceof v){const u=l.data,c=a.value;if(o==="+=")for(let h=0;h<u.length;++h)u[h]+=c;else if(o==="-=")for(let h=0;h<u.length;++h)u[h]-=c;else if(o==="*=")for(let h=0;h<u.length;++h)u[h]*=c;else if(o==="/=")for(let h=0;h<u.length;++h)u[h]/=c;else if(o==="%=")for(let h=0;h<u.length;++h)u[h]%=c;else if(o==="&=")for(let h=0;h<u.length;++h)u[h]&=c;else if(o==="|=")for(let h=0;h<u.length;++h)u[h]|=c;else if(o==="^=")for(let h=0;h<u.length;++h)u[h]^=c;else if(o==="<<=")for(let h=0;h<u.length;++h)u[h]<<=c;else if(o===">>=")for(let h=0;h<u.length;++h)u[h]>>=c;else console.error(`Invalid operator ${o}. Line ${e.line}`)}else if(l instanceof d&&a instanceof d){const u=l.data,c=a.data;if(u.length!==c.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(o==="+=")for(let h=0;h<u.length;++h)u[h]+=c[h];else if(o==="-=")for(let h=0;h<u.length;++h)u[h]-=c[h];else if(o==="*=")for(let h=0;h<u.length;++h)u[h]*=c[h];else if(o==="/=")for(let h=0;h<u.length;++h)u[h]/=c[h];else if(o==="%=")for(let h=0;h<u.length;++h)u[h]%=c[h];else if(o==="&=")for(let h=0;h<u.length;++h)u[h]&=c[h];else if(o==="|=")for(let h=0;h<u.length;++h)u[h]|=c[h];else if(o==="^=")for(let h=0;h<u.length;++h)u[h]^=c[h];else if(o==="<<=")for(let h=0;h<u.length;++h)u[h]<<=c[h];else if(o===">>=")for(let h=0;h<u.length;++h)u[h]>>=c[h];else console.error(`Invalid operator ${o}. Line ${e.line}`)}else{if(!(l instanceof v&&a instanceof v))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);o==="+="?l.value+=a.value:o==="-="?l.value-=a.value:o==="*="?l.value*=a.value:o==="/="?l.value/=a.value:o==="%="?l.value%=a.value:o==="&="?l.value&=a.value:o==="|="?l.value|=a.value:o==="^="?l.value^=a.value:o==="<<="?l.value<<=a.value:o===">>="?l.value>>=a.value:console.error(`Invalid operator ${o}. Line ${e.line}`)}n instanceof Y&&n.setDataValue(this,l,i,t)}}_function(e,t){const n=new gs(e);t.functions.set(e.name,n)}_const(e,t){let n=null;e.value!==null&&(n=this.evalExpression(e.value,t)),t.createVariable(e.name,n,e)}_let(e,t){let n=null;if(e.value!==null){if(n=this.evalExpression(e.value,t),n===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Z||(n=n.clone())}else{const s=e.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||s==="array"){const i=new De(e.type,[]);n=this._evalCreate(i,t)}}t.createVariable(e.name,n,e)}_var(e,t){let n=null;if(e.value!==null){if(n=this.evalExpression(e.value,t),n===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof Z||(n=n.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const s=e.type.name;if(s==="f32"||s==="i32"||s==="u32"||s==="bool"||s==="f16"||s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2b"||s==="vec3b"||s==="vec4b"||s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"||e.type instanceof en||e.type instanceof ze||e.type instanceof _){const i=new De(e.type,[]);n=this._evalCreate(i,t)}}t.createVariable(e.name,n,e)}_switch(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof v))return console.error(`Invalid if condition. Line ${e.line}`),null;let s=null;for(const i of e.cases)if(i instanceof Go)for(const a of i.selectors){if(a instanceof Dn){s=i;continue}const o=this.evalExpression(a,t);if(!(o instanceof v))return console.error(`Invalid case selector. Line ${e.line}`),null;if(o.value===n.value)return this._execStatements(i.body,t)}else i instanceof jo&&(s=i);return s?this._execStatements(s.body,t):null}_if(e,t){t=t.clone();const n=this.evalExpression(e.condition,t);if(!(n instanceof v))return console.error(`Invalid if condition. Line ${e.line}`),null;if(n.value)return this._execStatements(e.body,t);for(const s of e.elseif){const i=this.evalExpression(s.condition,t);if(!(i instanceof v))return console.error(`Invalid if condition. Line ${e.line}`),null;if(i.value)return this._execStatements(s.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof v?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===ie._breakObj)break;if(n!==null&&n!==ie._continueObj)return n;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const n=this._execStatements(e.body,t);if(n===ie._breakObj)break;if(n===ie._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===ie._breakObj)break}else if(n!==null)return n}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const n=this._execStatements(e.body,t);if(n===ie._breakObj)break;if(n!==ie._continueObj&&n!==null)return n}return null}_evalBitcast(e,t){const n=this.evalExpression(e.value,t),s=e.type;if(n instanceof v){const i=si(n.value,n.typeInfo.name,s.name);return new v(i,this.getTypeInfo(s))}if(n instanceof d){const i=n.typeInfo.getTypeName();let a="";if(i.endsWith("f"))a="f32";else if(i.endsWith("i"))a="i32";else if(i.endsWith("u"))a="u32";else if(i.endsWith("b"))a="bool";else{if(!i.endsWith("h"))return console.error(`Unknown vector type ${i}. Line ${e.line}`),null;a="f16"}const o=s.getTypeName();let l="";if(o.endsWith("f"))l="f32";else if(o.endsWith("i"))l="i32";else if(o.endsWith("u"))l="u32";else if(o.endsWith("b"))l="bool";else{if(!o.endsWith("h"))return console.error(`Unknown vector type ${l}. Line ${e.line}`),null;l="f16"}const u=(function(c,h,m){if(h===m)return c;const f=new Array(c.length);for(let w=0;w<c.length;w++)f[w]=si(c[w],h,m);return f})(Array.from(n.data),a,l);return new d(u,this.getTypeInfo(s))}return console.error(`TODO: bitcast for ${n.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var n;if(e instanceof De){if(e.type===null)return Ar.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const s=e instanceof De?e.type.name:e.name,i=e instanceof De?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(i===null)return console.error(`Unknown type ${s}. Line ${e.line}`),null;if(i.size===0)return null;const a=new Y(new ArrayBuffer(i.size),i,0);if(i instanceof nt){if(e.args)for(let o=0;o<e.args.length;++o){const l=i.members[o],u=e.args[o],c=this.evalExpression(u,t);a.setData(this,c,l.type,l.offset,t)}}else if(i instanceof st){let o=0;if(e.args)for(let l=0;l<e.args.length;++l){const u=e.args[l],c=this.evalExpression(u,t);i.format===null&&(((n=c.typeInfo)===null||n===void 0?void 0:n.name)==="x32"?i.format=this.getTypeInfo("i32"):i.format=c.typeInfo),a.setData(this,c,i.format,o,t),o+=i.stride}}else console.error(`Unknown type "${s}". Line ${e.line}`);return e instanceof De?a.getSubData(this,e.postfix,t):a}_evalLiteral(e,t){const n=this.getTypeInfo(e.type),s=n.name;return s==="x32"||s==="u32"||s==="f32"||s==="f16"||s==="i32"||s==="bool"?new v(e.scalarValue,n):s==="vec2"||s==="vec3"||s==="vec4"||s==="vec2f"||s==="vec3f"||s==="vec4f"||s==="vec2h"||s==="vec3h"||s==="vec4h"||s==="vec2i"||s==="vec3i"||s==="vec4i"||s==="vec2u"||s==="vec3u"||s==="vec4u"?this._callConstructorVec(e,t):s==="mat2x2"||s==="mat2x3"||s==="mat2x4"||s==="mat3x2"||s==="mat3x3"||s==="mat3x4"||s==="mat4x2"||s==="mat4x3"||s==="mat4x4"||s==="mat2x2f"||s==="mat2x3f"||s==="mat2x4f"||s==="mat3x2f"||s==="mat3x3f"||s==="mat3x4f"||s==="mat4x2f"||s==="mat4x3f"||s==="mat4x4f"||s==="mat2x2h"||s==="mat2x3h"||s==="mat2x4h"||s==="mat3x2h"||s==="mat3x3h"||s==="mat3x4h"||s==="mat4x2h"||s==="mat4x3h"||s==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const n=t.getVariableValue(e.name);return n===null?n:n.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let n=1;n<e.length;++n){const s=ie._priority.get(t.name);ie._priority.get(e[n].name)<s&&(t=e[n])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const n=this.evalExpression(e.right,t);if(e.operator==="&")return new kt(n);if(e.operator==="*")return n instanceof kt?n.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const s=n instanceof v?n.value:n instanceof d?Array.from(n.data):null;switch(e.operator){case"+":{if(S(s)){const o=s.map(((l,u)=>+l));return new d(o,n.typeInfo)}const i=s,a=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new v(+i,a)}case"-":{if(S(s)){const o=s.map(((l,u)=>-l));return new d(o,n.typeInfo)}const i=s,a=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new v(-i,a)}case"!":{if(S(s)){const o=s.map(((l,u)=>l?0:1));return new d(o,n.typeInfo)}const i=s,a=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new v(i?0:1,a)}case"~":{if(S(s)){const o=s.map(((l,u)=>~l));return new d(o,n.typeInfo)}const i=s,a=this._maxFormatTypeInfo([n.typeInfo,n.typeInfo]);return new v(~i,a)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const n=this.evalExpression(e.left,t),s=this.evalExpression(e.right,t),i=n instanceof v?n.value:n instanceof d||n instanceof V?Array.from(n.data):null,a=s instanceof v?s.value:s instanceof d||s instanceof V?Array.from(s.data):null;switch(e.operator){case"+":{if(S(i)&&S(a)){const c=i,h=a;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const m=c.map(((f,w)=>f+h[w]));return new d(m,n.typeInfo)}if(S(i)){const c=a,h=i.map(((m,f)=>m+c));return new d(h,n.typeInfo)}if(S(a)){const c=i,h=a.map(((m,f)=>c+m));return new d(h,s.typeInfo)}const o=i,l=a,u=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new v(o+l,u)}case"-":{if(S(i)&&S(a)){const c=i,h=a;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const m=c.map(((f,w)=>f-h[w]));return new d(m,n.typeInfo)}if(S(i)){const c=a,h=i.map(((m,f)=>m-c));return new d(h,n.typeInfo)}if(S(a)){const c=i,h=a.map(((m,f)=>c-m));return new d(h,s.typeInfo)}const o=i,l=a,u=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new v(o-l,u)}case"*":{if(S(i)&&S(a)){const c=i,h=a;if(n instanceof V&&s instanceof V){const m=(function(y,T,P,E){if(ae[T.name]===void 0||ae[E.name]===void 0)return null;const I=ae[T.name][0],A=ae[T.name][1],L=ae[E.name][0];if(I!==ae[E.name][1])return null;const K=new Array(L*A);for(let z=0;z<A;z++)for(let ne=0;ne<L;ne++){let he=0;for(let R=0;R<I;R++)he+=y[R*A+z]*P[ne*I+R];K[z*L+ne]=he}return K})(c,n.typeInfo,h,s.typeInfo);if(m===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const f=ae[s.typeInfo.name][0],w=ae[n.typeInfo.name][1],k=this.getTypeInfo(`mat${f}x${w}f`);return new V(m,k)}if(n instanceof V&&s instanceof d){const m=(function(f,w,k,y){if(ae[w.name]===void 0||dr[y.name]===void 0)return null;const T=ae[w.name][0],P=ae[w.name][1];if(T!==k.length)return null;const E=new Array(P);for(let I=0;I<P;I++){let A=0;for(let L=0;L<T;L++)A+=f[L*P+I]*k[L];E[I]=A}return E})(c,n.typeInfo,h,s.typeInfo);return m===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new d(m,s.typeInfo)}if(n instanceof d&&s instanceof V){const m=(function(f,w,k,y){if(dr[w.name]===void 0||ae[y.name]===void 0)return null;const T=ae[y.name][0],P=ae[y.name][1];if(P!==f.length)return null;const E=[];for(let I=0;I<T;I++){let A=0;for(let L=0;L<P;L++)A+=f[L]*k[L*T+I];E[I]=A}return E})(c,n.typeInfo,h,s.typeInfo);return m===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new d(m,n.typeInfo)}{if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const m=c.map(((f,w)=>f*h[w]));return new d(m,n.typeInfo)}}if(S(i)){const c=a,h=i.map(((m,f)=>m*c));return n instanceof V?new V(h,n.typeInfo):new d(h,n.typeInfo)}if(S(a)){const c=i,h=a.map(((m,f)=>c*m));return s instanceof V?new V(h,s.typeInfo):new d(h,s.typeInfo)}const o=i,l=a,u=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new v(o*l,u)}case"%":{if(S(i)&&S(a)){const c=i,h=a;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const m=c.map(((f,w)=>f%h[w]));return new d(m,n.typeInfo)}if(S(i)){const c=a,h=i.map(((m,f)=>m%c));return new d(h,n.typeInfo)}if(S(a)){const c=i,h=a.map(((m,f)=>c%m));return new d(h,s.typeInfo)}const o=i,l=a,u=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new v(o%l,u)}case"/":{if(S(i)&&S(a)){const c=i,h=a;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const m=c.map(((f,w)=>f/h[w]));return new d(m,n.typeInfo)}if(S(i)){const c=a,h=i.map(((m,f)=>m/c));return new d(h,n.typeInfo)}if(S(a)){const c=i,h=a.map(((m,f)=>c/m));return new d(h,s.typeInfo)}const o=i,l=a,u=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new v(o/l,u)}case"&":{if(S(i)&&S(a)){const c=i,h=a;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const m=c.map(((f,w)=>f&h[w]));return new d(m,n.typeInfo)}if(S(i)){const c=a,h=i.map(((m,f)=>m&c));return new d(h,n.typeInfo)}if(S(a)){const c=i,h=a.map(((m,f)=>c&m));return new d(h,s.typeInfo)}const o=i,l=a,u=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new v(o&l,u)}case"|":{if(S(i)&&S(a)){const c=i,h=a;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const m=c.map(((f,w)=>f|h[w]));return new d(m,n.typeInfo)}if(S(i)){const c=a,h=i.map(((m,f)=>m|c));return new d(h,n.typeInfo)}if(S(a)){const c=i,h=a.map(((m,f)=>c|m));return new d(h,s.typeInfo)}const o=i,l=a,u=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new v(o|l,u)}case"^":{if(S(i)&&S(a)){const c=i,h=a;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const m=c.map(((f,w)=>f^h[w]));return new d(m,n.typeInfo)}if(S(i)){const c=a,h=i.map(((m,f)=>m^c));return new d(h,n.typeInfo)}if(S(a)){const c=i,h=a.map(((m,f)=>c^m));return new d(h,s.typeInfo)}const o=i,l=a,u=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new v(o^l,u)}case"<<":{if(S(i)&&S(a)){const c=i,h=a;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const m=c.map(((f,w)=>f<<h[w]));return new d(m,n.typeInfo)}if(S(i)){const c=a,h=i.map(((m,f)=>m<<c));return new d(h,n.typeInfo)}if(S(a)){const c=i,h=a.map(((m,f)=>c<<m));return new d(h,s.typeInfo)}const o=i,l=a,u=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new v(o<<l,u)}case">>":{if(S(i)&&S(a)){const c=i,h=a;if(c.length!==h.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const m=c.map(((f,w)=>f>>h[w]));return new d(m,n.typeInfo)}if(S(i)){const c=a,h=i.map(((m,f)=>m>>c));return new d(h,n.typeInfo)}if(S(a)){const c=i,h=a.map(((m,f)=>c>>m));return new d(h,s.typeInfo)}const o=i,l=a,u=this._maxFormatTypeInfo([n.typeInfo,s.typeInfo]);return new v(o>>l,u)}case">":if(S(i)&&S(a)){const o=i,l=a;if(o.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const u=o.map(((c,h)=>c>l[h]?1:0));return new d(u,n.typeInfo)}if(S(i)){const o=a,l=i.map(((u,c)=>u>o?1:0));return new d(l,n.typeInfo)}if(S(a)){const o=i,l=a.map(((u,c)=>o>u?1:0));return new d(l,s.typeInfo)}return new v(i>a?1:0,this.getTypeInfo("bool"));case"<":if(S(i)&&S(a)){const o=i,l=a;if(o.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const u=o.map(((c,h)=>c<l[h]?1:0));return new d(u,n.typeInfo)}if(S(i)){const o=a,l=i.map(((u,c)=>u<o?1:0));return new d(l,n.typeInfo)}if(S(a)){const o=i,l=a.map(((u,c)=>o<u?1:0));return new d(l,s.typeInfo)}return new v(i<a?1:0,this.getTypeInfo("bool"));case"==":if(S(i)&&S(a)){const o=i,l=a;if(o.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const u=o.map(((c,h)=>c===l[h]?1:0));return new d(u,n.typeInfo)}if(S(i)){const o=a,l=i.map(((u,c)=>u==o?1:0));return new d(l,n.typeInfo)}if(S(a)){const o=i,l=a.map(((u,c)=>o==u?1:0));return new d(l,s.typeInfo)}return new v(i===a?1:0,this.getTypeInfo("bool"));case"!=":if(S(i)&&S(a)){const o=i,l=a;if(o.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const u=o.map(((c,h)=>c!==l[h]?1:0));return new d(u,n.typeInfo)}if(S(i)){const o=a,l=i.map(((u,c)=>u!==o?1:0));return new d(l,n.typeInfo)}if(S(a)){const o=i,l=a.map(((u,c)=>o!==u?1:0));return new d(l,s.typeInfo)}return new v(i!==a?1:0,this.getTypeInfo("bool"));case">=":if(S(i)&&S(a)){const o=i,l=a;if(o.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const u=o.map(((c,h)=>c>=l[h]?1:0));return new d(u,n.typeInfo)}if(S(i)){const o=a,l=i.map(((u,c)=>u>=o?1:0));return new d(l,n.typeInfo)}if(S(a)){const o=i,l=a.map(((u,c)=>o>=u?1:0));return new d(l,s.typeInfo)}return new v(i>=a?1:0,this.getTypeInfo("bool"));case"<=":if(S(i)&&S(a)){const o=i,l=a;if(o.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const u=o.map(((c,h)=>c<=l[h]?1:0));return new d(u,n.typeInfo)}if(S(i)){const o=a,l=i.map(((u,c)=>u<=o?1:0));return new d(l,n.typeInfo)}if(S(a)){const o=i,l=a.map(((u,c)=>o<=u?1:0));return new d(l,s.typeInfo)}return new v(i<=a?1:0,this.getTypeInfo("bool"));case"&&":if(S(i)&&S(a)){const o=i,l=a;if(o.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const u=o.map(((c,h)=>c&&l[h]?1:0));return new d(u,n.typeInfo)}if(S(i)){const o=a,l=i.map(((u,c)=>u&&o?1:0));return new d(l,n.typeInfo)}if(S(a)){const o=i,l=a.map(((u,c)=>o&&u?1:0));return new d(l,s.typeInfo)}return new v(i&&a?1:0,this.getTypeInfo("bool"));case"||":if(S(i)&&S(a)){const o=i,l=a;if(o.length!==l.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const u=o.map(((c,h)=>c||l[h]?1:0));return new d(u,n.typeInfo)}if(S(i)){const o=a,l=i.map(((u,c)=>u||o?1:0));return new d(l,n.typeInfo)}if(S(a)){const o=i,l=a.map(((u,c)=>o||u?1:0));return new d(l,s.typeInfo)}return new v(i||a?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const n=t.clone();n.currentFunctionName=e.name;const s=t.getFunction(e.name);if(!s)return e.isBuiltin?this._callBuiltinFunction(e,n):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let i=0;i<s.node.args.length;++i){const a=s.node.args[i],o=this.evalExpression(e.args[i],n);n.createVariable(a.name,o,a)}return this._execStatements(s.node.body,n)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothStep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const n=t.getFunction(e.name);if(n){const s=t.clone();for(let i=0;i<n.node.args.length;++i){const a=n.node.args[i],o=this.evalExpression(e.args[i],s);s.setVariable(a.name,o,a)}return this._execStatements(n.node.body,s)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new v(0,this.getTypeInfo(e.type));const n=this.evalExpression(e.args[0],t);return n.typeInfo=this.getTypeInfo(e.type),n.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const n=this.getTypeInfo(e.type),s=e.type.getTypeName(),i=dr[s];if(i===void 0)return console.error(`Invalid vec constructor ${s}. Line ${e.line}`),null;const a=[];if(e instanceof J)if(e.isVector){const o=e.vectorValue;for(const l of o)a.push(l)}else a.push(e.scalarValue);else if(e.args)for(const o of e.args){const l=this.evalExpression(o,t);if(l instanceof d){const u=l.data;for(let c=0;c<u.length;++c){let h=u[c];a.push(h)}}else if(l instanceof v){let u=l.value;a.push(u)}}if(e.type instanceof _&&e.type.format===null&&(e.type.format=_.f32),a.length===0){const o=new Array(i).fill(0);return new d(o,n).getSubData(this,e.postfix,t)}if(a.length===1)for(;a.length<i;)a.push(a[0]);return a.length<i?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new d(a.length>i?a.slice(0,i):a,n).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const n=this.getTypeInfo(e.type),s=e.type.getTypeName(),i=ae[s];if(i===void 0)return console.error(`Invalid matrix constructor ${s}. Line ${e.line}`),null;const a=[];if(e instanceof J)if(e.isVector){const o=e.vectorValue;for(const l of o)a.push(l)}else a.push(e.scalarValue);else if(e.args)for(const o of e.args){const l=this.evalExpression(o,t);l instanceof d?a.push(...l.data):l instanceof v?a.push(l.value):l instanceof V&&a.push(...l.data)}if(n instanceof mt&&n.format===null&&(n.format=this.getTypeInfo("f32")),a.length===0){const o=new Array(i[2]).fill(0);return new V(o,n).getSubData(this,e.postfix,t)}return a.length!==i[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new V(a,n).getSubData(this,e.postfix,t)}}ie._breakObj=new ye(new xe("BREAK",null),null),ie._continueObj=new ye(new xe("CONTINUE",null),null),ie._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class vd{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class gd{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new vd,this._exec=new ie,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const n=this._global_decl_or_directive();if(!n)break;t.push(n)}if(this._deferArrayCountEval.length>0){for(const n of this._deferArrayCountEval){const s=n.arrayType,i=n.countNode;if(i instanceof ve){const a=i.name,o=this._context.constants.get(a);if(o)try{const l=o.constEvaluate(this._exec);s.count=l}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const n of t)n.search((s=>{s instanceof ni||s instanceof Ln?s.type=this._forwardType(s.type):s instanceof en?s.format=this._forwardType(s.format):s instanceof Ge||s instanceof Jt||s instanceof Vn?s.type=this._forwardType(s.type):s instanceof cn?s.returnType=this._forwardType(s.returnType):s instanceof ti&&(s.type=this._forwardType(s.type))}));return t}_forwardType(e){if(e instanceof ei){const t=this._getType(e.name);if(t)return t}else e instanceof Ln?e.type=this._forwardType(e.type):e instanceof en&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const t=new od(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==p.eof}_match(e){if(e instanceof b)return!!this._check(e)&&(this._advance(),!0);for(let t=0,n=e.length;t<n;++t){const s=e[t];if(this._check(s))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const n=t.type;let s=!1;for(const i of e){if(n===i)return!0;i===p.tokens.name&&(s=!0)}if(s){const i=p.tokens.name.rule.exec(t.lexeme);if(i&&i.index==0&&i[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===p.tokens.name){const n=p.tokens.name.rule.exec(t.lexeme);return n&&n.index==0&&n[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(p.tokens.semicolon)&&!this._isAtEnd(););if(this._match(p.keywords.alias)){const t=this._type_alias();return this._consume(p.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(p.keywords.diagnostic)){const t=this._diagnostic();return this._consume(p.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(p.keywords.requires)){const t=this._requires_directive();return this._consume(p.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(p.keywords.enable)){const t=this._enable_directive();return this._consume(p.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(p.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(p.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(p.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(p.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(p.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(p.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(p.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(p.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(p.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(p.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(p.keywords.fn))return null;const e=this._currentLine,t=this._consume(p.tokens.ident,"Expected function name.").toString();this._consume(p.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(p.tokens.paren_right))do{if(this._check(p.tokens.paren_right))break;const o=this._attribute(),l=this._consume(p.tokens.name,"Expected argument name.").toString();this._consume(p.tokens.colon,"Expected ':' for argument type.");const u=this._attribute(),c=this._type_decl();c!=null&&(c.attributes=u,n.push(this._updateNode(new ti(l,c,o))))}while(this._match(p.tokens.comma));this._consume(p.tokens.paren_right,"Expected ')' after function arguments.");let s=null;if(this._match(p.tokens.arrow)){const o=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=o)}const i=this._compound_statement(),a=this._currentLine;return this._updateNode(new cn(t,n,s,i,e,a),e)}_compound_statement(){const e=[];for(this._consume(p.tokens.brace_left,"Expected '{' for block.");!this._check(p.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(p.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(p.tokens.semicolon)&&!this._isAtEnd(););if(this._check(p.tokens.attr)&&this._attribute(),this._check(p.keywords.if))return this._if_statement();if(this._check(p.keywords.switch))return this._switch_statement();if(this._check(p.keywords.loop))return this._loop_statement();if(this._check(p.keywords.for))return this._for_statement();if(this._check(p.keywords.while))return this._while_statement();if(this._check(p.keywords.continuing))return this._continuing_statement();if(this._check(p.keywords.static_assert))return this._static_assert_statement();if(this._check(p.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(p.keywords.return))e=this._return_statement();else if(this._check([p.keywords.var,p.keywords.let,p.keywords.const]))e=this._variable_statement();else if(this._match(p.keywords.discard))e=this._updateNode(new rd);else if(this._match(p.keywords.break)){const t=this._updateNode(new Uo);if(this._currentLoop.length>0){const n=this._currentLoop[this._currentLoop.length-1];t.loopId=n.id}e=t,this._check(p.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(p.keywords.continue)){const t=this._updateNode(new No);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const n=this._currentLoop[this._currentLoop.length-1];t.loopId=n.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(p.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(p.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new ed(t),e)}_while_statement(){if(!this._match(p.keywords.while))return null;const e=this._updateNode(new Po(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(p.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(p.keywords.continuing))return null;const t=this._currentLine,n=this._compound_statement();return this._updateNode(new Sr(n,e),t)}_for_statement(){if(!this._match(p.keywords.for))return null;this._consume(p.tokens.paren_left,"Expected '('.");const e=this._updateNode(new So(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(p.tokens.semicolon)?null:this._for_init(),this._consume(p.tokens.semicolon,"Expected ';'."),e.condition=this._check(p.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(p.tokens.semicolon,"Expected ';'."),e.increment=this._check(p.tokens.paren_right)?null:this._for_increment(),this._consume(p.tokens.paren_right,"Expected ')'."),this._check(p.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(p.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(p.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new Ge(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(p.keywords.let)){const e=this._currentLine,t=this._consume(p.tokens.name,"Expected name for let.").toString();let n=null;if(this._match(p.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}this._consume(p.tokens.equal,"Expected '=' for let.");const s=this._short_circuit_or_expression();return this._updateNode(new Jt(t,n,null,null,s),e)}if(this._match(p.keywords.const)){const e=this._currentLine,t=this._consume(p.tokens.name,"Expected name for const.").toString();let n=null;if(this._match(p.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}this._consume(p.tokens.equal,"Expected '=' for const.");const s=this._short_circuit_or_expression();return n===null&&s instanceof J&&(n=s.type),this._updateNode(new Vn(t,n,null,null,s),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(p.increment_operators))return this._current=e,null;const n=this._consume(p.increment_operators,"Expected increment operator");return this._updateNode(new Ao(n.type===p.tokens.plus_plus?Tt.increment:Tt.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(p.tokens.brace_right))return null;let n=this._match(p.tokens.underscore);if(n||(e=this._unary_expression()),!n&&e==null)return null;const s=this._consume(p.assignment_operators,"Expected assignment operator."),i=this._short_circuit_or_expression();return this._updateNode(new Vo(Xt.parse(s.lexeme),e,i),t)}_func_call_statement(){if(!this._check(p.tokens.ident))return null;const e=this._currentLine,t=this._current,n=this._consume(p.tokens.ident,"Expected function name."),s=this._argument_expression_list();return s===null?(this._current=t,null):this._updateNode(new ps(n.lexeme,s),e)}_loop_statement(){if(!this._match(p.keywords.loop))return null;this._check(p.tokens.attr)&&this._attribute(),this._consume(p.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new Lo([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let n of t)e.body.push(n);else e.body.push(t);if(t instanceof Sr){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(p.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(p.keywords.switch))return null;const e=this._updateNode(new Do(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(p.tokens.attr)&&this._attribute(),this._consume(p.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(p.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([p.keywords.default,p.keywords.case]);){if(this._match(p.keywords.case)){const n=this._case_selectors();for(const i of n)if(i instanceof Dn){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(p.tokens.colon),this._check(p.tokens.attr)&&this._attribute(),this._consume(p.tokens.brace_left,"Exected '{' for switch case.");const s=this._case_body();this._consume(p.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new Go(n,s)))}if(this._match(p.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(p.tokens.colon),this._check(p.tokens.attr)&&this._attribute(),this._consume(p.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(p.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new jo(n)))}}return e}_case_selectors(){const e=[];for(this._match(p.keywords.default)?e.push(this._updateNode(new Dn)):e.push(this._shift_expression());this._match(p.tokens.comma);)this._match(p.keywords.default)?e.push(this._updateNode(new Dn)):e.push(this._shift_expression());return e}_case_body(){if(this._match(p.keywords.fallthrough))return this._consume(p.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(p.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(p.tokens.attr)&&this._attribute();const n=this._compound_statement();let s=[];this._match_elseif()&&(this._check(p.tokens.attr)&&this._attribute(),s=this._elseif_statement(s));let i=null;return this._match(p.keywords.else)&&(this._check(p.tokens.attr)&&this._attribute(),i=this._compound_statement()),this._updateNode(new Mo(t,n,s,i),e)}_match_elseif(){return this._tokens[this._current].type===p.keywords.else&&this._tokens[this._current+1].type===p.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),n=this._compound_statement();return e.push(this._updateNode(new sd(t,n))),this._match_elseif()&&(this._check(p.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(p.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new Oo(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(p.tokens.or_or);)e=this._updateNode(new Te(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(p.tokens.and_and);)e=this._updateNode(new Te(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(p.tokens.or);)e=this._updateNode(new Te(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(p.tokens.xor);)e=this._updateNode(new Te(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(p.tokens.and);)e=this._updateNode(new Te(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([p.tokens.equal_equal,p.tokens.not_equal])?this._updateNode(new Te(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([p.tokens.less_than,p.tokens.greater_than,p.tokens.less_than_equal,p.tokens.greater_than_equal]);)e=this._updateNode(new Te(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([p.tokens.shift_left,p.tokens.shift_right]);)e=this._updateNode(new Te(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([p.tokens.plus,p.tokens.minus]);)e=this._updateNode(new Te(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([p.tokens.star,p.tokens.forward_slash,p.tokens.modulo]);)e=this._updateNode(new Te(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([p.tokens.minus,p.tokens.bang,p.tokens.tilde,p.tokens.star,p.tokens.and])?this._updateNode(new Z(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(p.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(p.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new Dt(e)),n=this._postfix_expression();return n&&(t.postfix=n),t}if(this._match(p.tokens.period)){const e=this._consume(p.tokens.name,"Expected member name."),t=this._postfix_expression(),n=this._updateNode(new vt(e.lexeme));return t&&(n.postfix=t),n}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return C.void;case"bool":return C.bool;case"i32":return C.i32;case"u32":return C.u32;case"f32":return C.f32;case"f16":return C.f16;case"vec2f":return _.vec2f;case"vec3f":return _.vec3f;case"vec4f":return _.vec4f;case"vec2i":return _.vec2i;case"vec3i":return _.vec3i;case"vec4i":return _.vec4i;case"vec2u":return _.vec2u;case"vec3u":return _.vec3u;case"vec4u":return _.vec4u;case"vec2h":return _.vec2h;case"vec3h":return _.vec3h;case"vec4h":return _.vec4h;case"mat2x2f":return _.mat2x2f;case"mat2x3f":return _.mat2x3f;case"mat2x4f":return _.mat2x4f;case"mat3x2f":return _.mat3x2f;case"mat3x3f":return _.mat3x3f;case"mat3x4f":return _.mat3x4f;case"mat4x2f":return _.mat4x2f;case"mat4x3f":return _.mat4x3f;case"mat4x4f":return _.mat4x4f;case"mat2x2h":return _.mat2x2h;case"mat2x3h":return _.mat2x3h;case"mat2x4h":return _.mat2x4h;case"mat3x2h":return _.mat3x2h;case"mat3x3h":return _.mat3x3h;case"mat3x4h":return _.mat3x4h;case"mat4x2h":return _.mat4x2h;case"mat4x3h":return _.mat4x3h;case"mat4x4h":return _.mat4x4h;case"mat2x2i":return _.mat2x2i;case"mat2x3i":return _.mat2x3i;case"mat2x4i":return _.mat2x4i;case"mat3x2i":return _.mat3x2i;case"mat3x3i":return _.mat3x3i;case"mat3x4i":return _.mat3x4i;case"mat4x2i":return _.mat4x2i;case"mat4x3i":return _.mat4x3i;case"mat4x4i":return _.mat4x4i;case"mat2x2u":return _.mat2x2u;case"mat2x3u":return _.mat2x3u;case"mat2x4u":return _.mat2x4u;case"mat3x2u":return _.mat3x2u;case"mat3x3u":return _.mat3x3u;case"mat3x4u":return _.mat3x4u;case"mat4x2u":return _.mat4x2u;case"mat4x3u":return _.mat4x3u;case"mat4x4u":return _.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(p.tokens.ident)){const n=this._previous().toString();if(this._check(p.tokens.paren_left)){const s=this._argument_expression_list(),i=this._getType(n);return i!==null?this._updateNode(new De(i,s)):this._updateNode(new fs(n,s))}if(this._context.constants.has(n)){const s=this._context.constants.get(n);return this._updateNode(new Fo(n,s.value))}return this._updateNode(new ve(n))}if(this._match(p.tokens.int_literal)){const n=this._previous().toString();let s=n.endsWith("i")||n.endsWith("i")?C.i32:n.endsWith("u")||n.endsWith("U")?C.u32:C.x32;const i=parseInt(n);return this._validateTypeRange(i,s),this._updateNode(new J(new v(i,this._exec.getTypeInfo(s)),s))}if(this._match(p.tokens.uint_literal)){const n=parseInt(this._previous().toString());return this._validateTypeRange(n,C.u32),this._updateNode(new J(new v(n,this._exec.getTypeInfo(C.u32)),C.u32))}if(this._match([p.tokens.decimal_float_literal,p.tokens.hex_float_literal])){let n=this._previous().toString(),s=n.endsWith("h");s&&(n=n.substring(0,n.length-1));const i=parseFloat(n);this._validateTypeRange(i,s?C.f16:C.f32);const a=s?C.f16:C.f32;return this._updateNode(new J(new v(i,this._exec.getTypeInfo(a)),a))}if(this._match([p.keywords.true,p.keywords.false])){let n=this._previous().toString()===p.keywords.true.rule;return this._updateNode(new J(new v(n?1:0,this._exec.getTypeInfo(C.bool)),C.bool))}if(this._check(p.tokens.paren_left))return this._paren_expression();if(this._match(p.keywords.bitcast)){this._consume(p.tokens.less_than,"Expected '<'.");const n=this._type_decl();this._consume(p.tokens.greater_than,"Expected '>'.");const s=this._paren_expression();return this._updateNode(new $o(n,s))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new De(e,t))}_argument_expression_list(){if(!this._match(p.tokens.paren_left))return null;const e=[];do{if(this._check(p.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(p.tokens.comma));return this._consume(p.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(p.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(p.tokens.paren_right),e}_paren_expression(){this._consume(p.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(p.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(p.keywords.struct))return null;const e=this._currentLine,t=this._consume(p.tokens.ident,"Expected name for struct.").toString();this._consume(p.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(p.tokens.brace_right);){const a=this._attribute(),o=this._consume(p.tokens.name,"Expected variable name.").toString();this._consume(p.tokens.colon,"Expected ':' for struct member type.");const l=this._attribute(),u=this._type_decl();u!=null&&(u.attributes=l),this._check(p.tokens.brace_right)?this._match(p.tokens.comma):this._consume(p.tokens.comma,"Expected ',' for struct member."),n.push(this._updateNode(new ni(o,u,a)))}this._consume(p.tokens.brace_right,"Expected '}' after struct body.");const s=this._currentLine,i=this._updateNode(new ze(t,n,e,s),e);return this._context.structs.set(t,i),i}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(p.tokens.equal)){const t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof J){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof J&&(e.type=e.value.type.name==="x32"?C.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(p.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(p.keywords.const))return null;const t=this._consume(p.tokens.name,"Expected variable name"),n=this._currentLine;let s=null;if(this._match(p.tokens.colon)){const l=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=l)}let i=null;this._consume(p.tokens.equal,"const declarations require an assignment");const a=this._short_circuit_or_expression();try{let l=[C.f32],u=a.constEvaluate(this._exec,l);u instanceof v&&this._validateTypeRange(u.value,l[0]),l[0]instanceof _&&l[0].format===null&&u.typeInfo instanceof mt&&u.typeInfo.format!==null&&(u.typeInfo.format.name==="f16"?l[0].format=C.f16:u.typeInfo.format.name==="f32"?l[0].format=C.f32:u.typeInfo.format.name==="i32"?l[0].format=C.i32:u.typeInfo.format.name==="u32"?l[0].format=C.u32:u.typeInfo.format.name==="bool"?l[0].format=C.bool:console.error(`TODO: impelement template format type ${u.typeInfo.format.name}`)),i=this._updateNode(new J(u,l[0])),this._exec.context.setVariable(t.toString(),u)}catch{i=a}if(s!==null&&i instanceof J){if(i.type.name!=="x32"&&s.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${s.name}. Line:${this._currentLine}`);i.type=s,i.isScalar&&this._validateTypeRange(i.scalarValue,i.type)}else s===null&&i instanceof J&&(s=(e=i?.type)!==null&&e!==void 0?e:C.f32,s===C.x32&&(s=C.i32));const o=this._updateNode(new Vn(t.toString(),s,"","",i),n);return this._context.constants.set(o.name,o),o}_global_let_decl(){if(!this._match(p.keywords.let))return null;const e=this._currentLine,t=this._consume(p.tokens.name,"Expected variable name");let n=null;if(this._match(p.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}let s=null;if(this._match(p.tokens.equal)&&(s=this._const_expression()),n!==null&&s instanceof J){if(s.type.name!=="x32"&&n.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${n.name}. Line:${this._currentLine}`);s.type=n}else n===null&&s instanceof J&&(n=s.type.name==="x32"?C.i32:s.type);return s instanceof J&&s.isScalar&&this._validateTypeRange(s.scalarValue,n),this._updateNode(new Jt(t.toString(),n,"","",s),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(p.keywords.var))return null;const e=this._currentLine;let t="",n="";this._match(p.tokens.less_than)&&(t=this._consume(p.storage_class,"Expected storage_class.").toString(),this._match(p.tokens.comma)&&(n=this._consume(p.access_mode,"Expected access_mode.").toString()),this._consume(p.tokens.greater_than,"Expected '>'."));const s=this._consume(p.tokens.name,"Expected variable name");let i=null;if(this._match(p.tokens.colon)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}return this._updateNode(new Ge(s.toString(),i,t,n,null),e)}_override_decl(){if(!this._match(p.keywords.override))return null;const e=this._consume(p.tokens.name,"Expected variable name");let t=null;if(this._match(p.tokens.colon)){const n=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=n)}return this._updateNode(new hs(e.toString(),t,null))}_diagnostic(){this._consume(p.tokens.paren_left,"Expected '('");const e=this._consume(p.tokens.ident,"Expected severity control name.");this._consume(p.tokens.comma,"Expected ','");let t=this._consume(p.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(p.tokens.period)&&(t+=`.${this._consume(p.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(p.tokens.paren_right,"Expected ')'"),this._updateNode(new Bo(e.toString(),t))}_enable_directive(){const e=this._consume(p.tokens.ident,"identity expected.");return this._updateNode(new td(e.toString()))}_requires_directive(){const e=[this._consume(p.tokens.ident,"identity expected.").toString()];for(;this._match(p.tokens.comma);){const t=this._consume(p.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new nd(e))}_type_alias(){const e=this._consume(p.tokens.ident,"identity expected.");this._consume(p.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const n=this._updateNode(new ds(e.toString(),t));return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([p.tokens.ident,...p.texel_format,p.keywords.bool,p.keywords.f32,p.keywords.i32,p.keywords.u32])){const n=this._advance().toString();if(this._context.structs.has(n))return this._context.structs.get(n);if(this._context.aliases.has(n))return this._context.aliases.get(n).type;if(!this._getType(n)){const s=this._updateNode(new ei(n));return this._forwardTypeCount++,s}return this._updateNode(new C(n))}let e=this._texture_sampler_types();if(e)return e;if(this._check(p.template_types)){let n=this._advance().toString(),s=null,i=null;return this._match(p.tokens.less_than)&&(s=this._type_decl(),i=null,this._match(p.tokens.comma)&&(i=this._consume(p.access_mode,"Expected access_mode for pointer").toString()),this._consume(p.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new _(n,s,i))}if(this._match(p.keywords.ptr)){let n=this._previous().toString();this._consume(p.tokens.less_than,"Expected '<' for pointer.");const s=this._consume(p.storage_class,"Expected storage_class for pointer");this._consume(p.tokens.comma,"Expected ',' for pointer.");const i=this._type_decl();let a=null;return this._match(p.tokens.comma)&&(a=this._consume(p.access_mode,"Expected access_mode for pointer").toString()),this._consume(p.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Ln(n,s.toString(),i,a))}const t=this._attribute();if(this._match(p.keywords.array)){let n=null,s=-1;const i=this._previous();let a=null;if(this._match(p.tokens.less_than)){n=this._type_decl(),this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);let l="";if(this._match(p.tokens.comma)){a=this._shift_expression();try{l=a.constEvaluate(this._exec).toString(),a=null}catch{l="1"}}this._consume(p.tokens.greater_than,"Expected '>' for array."),s=l?parseInt(l):0}const o=this._updateNode(new en(i.toString(),t,n,s));return a&&this._deferArrayCountEval.push({arrayType:o,countNode:a}),o}return null}_texture_sampler_types(){if(this._match(p.sampler_type))return this._updateNode(new Zt(this._previous().toString(),null,null));if(this._match(p.depth_texture_type))return this._updateNode(new Zt(this._previous().toString(),null,null));if(this._match(p.sampled_texture_type)||this._match(p.multisampled_texture_type)){const e=this._previous();this._consume(p.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(p.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Zt(e.toString(),t,null))}if(this._match(p.storage_texture_type)){const e=this._previous();this._consume(p.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(p.texel_format,"Invalid texel format.").toString();this._consume(p.tokens.comma,"Expected ',' after texel format.");const n=this._consume(p.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(p.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Zt(e.toString(),t,n))}return null}_attribute(){let e=[];for(;this._match(p.tokens.attr);){const t=this._consume(p.attribute_name,"Expected attribute name"),n=this._updateNode(new qo(t.toString(),null));if(this._match(p.tokens.paren_left)){if(n.value=this._consume(p.literal_or_ident,"Expected attribute value").toString(),this._check(p.tokens.comma)){this._advance();do{const s=this._consume(p.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(s)}while(this._match(p.tokens.comma))}this._consume(p.tokens.paren_right,"Expected ')'")}e.push(n)}return e.length==0?null:e}}class bd extends Oe{constructor(e){super(),e&&this.update(e)}update(e){const t=new gd().parse(e);this.updateAST(t)}}function Ct(r,e){return Object.fromEntries(e.map(t=>{const n=kd(r,t,0);return[t.name,{typeDefinition:n,group:t.group,binding:t.binding,size:n.size}]}))}function Ho(r,e,t){return{fields:Object.fromEntries(e.members.map(s=>[s.name,{offset:s.offset,type:_s(r,s.type,0)}])),size:e.size,offset:t}}function _d(r){if(r.name.includes("depth"))return"depth";switch(r.format?.name){case"f32":return"float";case"i32":return"sint";case"u32":return"uint";default:throw new Error("unknown texture sample type")}}function ii(r){return r.name.includes("2d_array")?"2d-array":r.name.includes("cube_array")?"cube-array":r.name.includes("3d")?"3d":r.name.includes("1d")?"1d":r.name.includes("cube")?"cube":"2d"}function wd(r){switch(r.access){case"read":return"read-only";case"write":return"write-only";case"read_write":return"read-write";default:throw new Error("unknonw storage texture access")}}function xd(r){return r.name.endsWith("_comparison")?"comparison":"filtering"}function yd(r,e){const{binding:t,access:n,type:s}=r;switch(r.resourceType){case te.Uniform:return{binding:t,visibility:e,buffer:{...r.size&&{minBindingSize:r.size}}};case te.Storage:return{binding:t,visibility:e,buffer:{type:n===""||n==="read"?"read-only-storage":"storage",...r.size&&{minBindingSize:r.size}}};case te.Texture:{if(s.name==="texture_external")return{binding:t,visibility:e,externalTexture:{}};const i=s.name.includes("multisampled");return{binding:t,visibility:e,texture:{sampleType:_d(s),viewDimension:ii(s),multisampled:i}}}case te.Sampler:return{binding:t,visibility:e,sampler:{type:xd(s)}};case te.StorageTexture:return{binding:t,visibility:e,storageTexture:{access:wd(s),format:s.format.name,viewDimension:ii(s)}};default:throw new Error("unknown resource type")}}function fr(r,e){const t={};for(const n of r)t[n.name]={stage:e,resources:n.resources.map(s=>{const{name:i,group:a}=s;return{name:i,group:a,entry:yd(s,e)}})};return t}function Ko(r){const e=new bd(r),t=Object.fromEntries(e.structs.map(c=>[c.name,Ho(e,c,0)])),n=Ct(e,e.uniforms),s=Ct(e,e.storage.filter(c=>c.resourceType===te.Storage)),i=Ct(e,e.storage.filter(c=>c.resourceType===te.StorageTexture)),a=Ct(e,e.textures.filter(c=>c.type.name!=="texture_external")),o=Ct(e,e.textures.filter(c=>c.type.name==="texture_external")),l=Ct(e,e.samplers),u={...fr(e.entry.vertex,GPUShaderStage.VERTEX),...fr(e.entry.fragment,GPUShaderStage.FRAGMENT),...fr(e.entry.compute,GPUShaderStage.COMPUTE)};return{externalTextures:o,samplers:l,structs:t,storages:s,storageTextures:i,textures:a,uniforms:n,entryPoints:u}}function mr(r,e=""){if(!r)throw new Error(e)}function kd(r,e,t){switch(e.resourceType){case te.Uniform:case te.Storage:case te.StorageTexture:return _s(r,e.type,t);default:return{size:0,type:e.type.name}}}function _s(r,e,t){if(e.isArray){mr(!e.isStruct,"struct array is invalid"),mr(!e.isStruct,"template array is invalid");const n=e;return{size:n.size,elementType:_s(r,n.format,t),numElements:n.count}}else{if(e.isStruct)return mr(!e.isTemplate,"template struct is invalid"),Ho(r,e,t);{const n=e,s=e.isTemplate?`${n.name}<${n.format.name}>`:e.name;return{size:e.size,type:s}}}}const Cd=new Map([[Int8Array,{formats:["sint8","snorm8"],defaultForType:1}],[Uint8Array,{formats:["uint8","unorm8"],defaultForType:1}],[Int16Array,{formats:["sint16","snorm16"],defaultForType:1}],[Uint16Array,{formats:["uint16","unorm16"],defaultForType:1}],[Int32Array,{formats:["sint32","snorm32"],defaultForType:0}],[Uint32Array,{formats:["uint32","unorm32"],defaultForType:0}],[Float16Array,{formats:["float16","float16"],defaultForType:0}],[Float32Array,{formats:["float32","float32"],defaultForType:0}]]);new Map([...Cd.entries()].map(([r,{formats:[e,t]}])=>[[e,r],[t,r]]).flat());class Ed{from=St(1,1,1,1);to=St(0,0,0,1);up=St(0,1,0,0);viewMtx=Yt();invViewMtx=Yt();constructor(e,t,n){this.setFrom(e),this.setTo(t),this.setUp(n)}setFrom(e){this.setVector4(this.from,e)}setTo(e){this.setVector4(this.to,e)}setUp(e){this.setVector4(this.up,e)}setVector4(e,t){const n=t.length;n<3?console.log("len < 3"):n==3?rr(e,t[0],t[1],t[2],1):rr(e,t[0],t[1],t[2],t[3])}_vec3(e){return ol(br(),e[0],e[1],e[2])}_look(){ks(this.viewMtx,this._vec3(this.from),this._vec3(this.to),this._vec3(this.up)),nl(this.invViewMtx,this.viewMtx)}getFrom(){return this.from}getMatrix(){return this._look(),{viewMtx:this.viewMtx,invViewMtx:this.invViewMtx}}getViewMatrix(){return this._look(),this.viewMtx}getRelViewMatrix(){this._look();const e=En(this.from[0],this.from[1],this.from[2]),t=En(this.to[0],this.to[1],this.to[2]),n=En(this.up[0],this.up[1],this.up[2]),s=ul(br(),t,e);return ks(Yt(),En(0,0,0),s,n)}round(e,t){const n=Fe(Et(),this.from,this.viewMtx),s=Fe(Et(),this.to,this.viewMtx),i=this._vec3(n),a=this._vec3(s);cl(i,i,a,e),ll(i,i,a,t),rr(n,i[0],i[1],i[2],1),Fe(this.from,n,this.invViewMtx),this._look()}zoom(e){const t=Et();fl(t,this.to,this.from),dl(t,t,[e,e,e,e]),hl(this.from,this.from,t),this._look()}move(e,t){const n=Fe(Et(),this.from,this.viewMtx),s=Fe(Et(),this.to,this.viewMtx),i=Yt();rl(i,i,[e,t,0]),Fe(n,n,i),Fe(s,s,i),Fe(this.from,n,this.invViewMtx),Fe(this.to,s,this.invViewMtx),this._look()}}const oi=0,ai=1;class Id{camera;canvas;leftButtonDown=!1;wheelButtonDown=!1;lastMouseX=0;lastMouseY=0;handleMouseDownFunc=null;handleMouseMoveFunc=null;handleMouseUpFunc=null;handleMouseLeaveFunc=null;handleMouseWheelFunc=null;constructor(e,t){this.camera=e,this.canvas=t}handleMouseDown(){const e=this;return t=>{t.button==oi?e.leftButtonDown=!0:t.button==ai&&(e.wheelButtonDown=!0),e.lastMouseX=t.clientX,e.lastMouseY=t.clientY}}handleMouseMove(){const e=this;return t=>{if(this.leftButtonDown){const n=t.clientX-e.lastMouseX,s=t.clientY-e.lastMouseY;e.camera.round(-n/200,-s/200)}else if(this.wheelButtonDown){t.preventDefault();const n=t.clientX-e.lastMouseX,s=t.clientY-e.lastMouseY;e.camera.move(-n/5,s/5)}e.lastMouseX=t.clientX,e.lastMouseY=t.clientY}}handleMouseUp(){const e=this;return t=>{t.button==oi&&(e.leftButtonDown=!1),t.button==ai&&(e.wheelButtonDown=!1)}}handleMouseLeave(){const e=this;return t=>{e.leftButtonDown=!1,e.wheelButtonDown=!1}}handleMouseWheel(){return e=>{e.preventDefault(),this.camera.zoom(e.wheelDeltaY/120*(1/10))}}enable(){this.handleMouseDownFunc=this.handleMouseDown(),this.handleMouseMoveFunc=this.handleMouseMove(),this.handleMouseUpFunc=this.handleMouseUp(),this.handleMouseLeaveFunc=this.handleMouseLeave(),this.handleMouseWheelFunc=this.handleMouseWheel(),this.canvas.addEventListener("mousedown",this.handleMouseDownFunc),this.canvas.addEventListener("mousemove",this.handleMouseMoveFunc),this.canvas.addEventListener("mouseup",this.handleMouseUpFunc),this.canvas.addEventListener("mouseleave",this.handleMouseLeaveFunc),this.canvas.addEventListener("wheel",this.handleMouseWheelFunc)}disable(){this.canvas.removeEventListener("mousedown",this.handleMouseDownFunc),this.canvas.removeEventListener("mousemove",this.handleMouseMoveFunc),this.canvas.removeEventListener("mouseup",this.handleMouseUpFunc),this.canvas.removeEventListener("mouseleave",this.handleMouseLeaveFunc),this.canvas.removeEventListener("wheel",this.handleMouseWheelFunc),this.handleMouseDownFunc=null,this.handleMouseMoveFunc=null,this.handleMouseUpFunc=null,this.handleMouseLeaveFunc=null,this.handleMouseWheelFunc=null}}async function Td(r,e){const t=e.getWidth(),n=e.getHeight(),i=(await e.readRasters())[0],a=r.createTexture({label:"geotiff texture",size:[t,n,1],format:"r32float",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST});return r.queue.writeTexture({texture:a},i.buffer,{bytesPerRow:t*4},[t,n]),a}async function Pd(r={}){const e=navigator.gpu,t=await e.requestAdapter();if(t===null)return null;const n=await t?.requestDevice();return n===null?null:{gpu:e,adaptor:t,device:n}}function Sd(r){const e=document.getElementById(r.canvasId);if(e===null)return null;const t=e.getContext("webgpu");return t===null?null:(t.configure(r.config),{canvas:e,context:t})}async function Ad(r,e={level:4}){const t=r.getBoundingBox(),n=r.getWidth(),s=r.getHeight(),i=r.geoKeys;i.ProjectedCSTypeGeoKey||i.GeographicTypeGeoKey;const a=[],o=[],u=(await r.readRasters())[0];function c(f,w){return[(f-t[0])/(t[2]-t[0]),(w-t[1])/(t[3]-t[1])]}function h(f,w){const[k,y,T,P]=t;let E=Math.floor((f-k)/(T-k)*n),I=Math.floor((P-w)/(P-y)*s);E=Math.max(0,Math.min(n-1,E)),I=Math.max(0,Math.min(s-1,I));const A=I*n+E;return u[A]}function m([f,w,k,y],T=0){if(T<e.level){const P=(f+k)/2,E=(w+y)/2,I=[f,w,P,E],A=[P,w,k,E],L=[f,E,P,y],K=[P,E,k,y];m(I,T+1),m(A,T+1),m(L,T+1),m(K,T+1)}else a.push(f,w,h(f,w),k,y,h(k,y),f,y,h(f,y),f,w,h(f,w),k,w,h(k,w),k,y,h(k,y)),o.push(...c(f,w),...c(k,y),...c(f,y),...c(f,w),...c(k,w),...c(k,y))}return m(t,0),{positions:new Float32Array(a),texcoords:new Float32Array(o),vertexCount:a.length/3}}async function Vd(r,e,t){const n="visualizeDEM",{device:s}=r,i=new Ld(r),a=await Ad(t,{level:4}),o={exaggeration:2,derivative:"none"},l=s.createTexture({size:[1,1,1],format:"r32float",usage:GPUTextureUsage.TEXTURE_BINDING});let u=null,c=null,h=[0,Math.PI/2],m=1/0,f=-1/0;for(let Se=2;Se<a.positions.length;Se+=3){const oe=a.positions[Se];oe<m&&(m=oe),oe>f&&(f=oe)}const w=`

        struct Camemra {
            eye: vec3f,
            to: vec3f,
            up: vec3f,
            viewmtx : mat4x4<f32>,
            relViewmtx : mat4x4<f32>
        };

        struct Projection {
            projmtx : mat4x4<f32>
        };

        struct Scene {
            camera : Camemra,
            projection: Projection,
        };

        @group(0) @binding(0) var<uniform> scene : Scene;
        @group(0) @binding(1) var<uniform> hrange : vec2f;
        @group(0) @binding(2) var<uniform> exaggeration : f32;
        @group(1) @binding(0) var<uniform> hasTexture : u32;
        @group(1) @binding(1) var demTexture: texture_2d<f32>;
        @group(1) @binding(2) var<uniform> pixelRange: vec2f;

        struct VSInput {
            @location(0) position : vec4f,
            @location(1) texcoord : vec2f
        };
        struct VSOutput {
            @builtin(position) position : vec4f,
            @location(0) height: f32,
            @location(1) texcoord : vec2f
        };

        @vertex fn vs(input: VSInput) -> VSOutput {
            var output : VSOutput;
            var worldpos = input.position.xyz;
            worldpos.z = (worldpos.z - hrange.x) * exaggeration + hrange.x;
            let relpos = vec4f((worldpos - scene.camera.eye.xyz), 1.0);
            output.position = scene.projection.projmtx * scene.camera.relViewmtx * relpos;
            output.height = worldpos.z;
            output.texcoord = input.texcoord;
            return output;
        }

        fn demColor(h: f32) -> vec3<f32> {
            let c0 = vec3(0.0, 0.0, 0.5); // low
            let c1 = vec3(0.0, 0.6, 0.6);
            let c2 = vec3(0.2, 0.7, 0.2);
            let c3 = vec3(0.8, 0.8, 0.2);
            let c4 = vec3(0.8, 0.4, 0.1);
            let c5 = vec3(1.0, 1.0, 1.0); // high

            let t = clamp(h, 0.0, 1.0) * 5.0;

            var col = mix(c0, c1, clamp(t, 0.0, 1.0));
            col = mix(col, c2, clamp(t - 1.0, 0.0, 1.0));
            col = mix(col, c3, clamp(t - 2.0, 0.0, 1.0));
            col = mix(col, c4, clamp(t - 3.0, 0.0, 1.0));
            col = mix(col, c5, clamp(t - 4.0, 0.0, 1.0));

            return col;
        }

        @fragment fn fs(input: VSOutput) -> @location(0) vec4f {
            if(hasTexture != 0u) {
                let vmin = pixelRange[0];
                let vmax = pixelRange[1];
                let texcoord = input.texcoord;
                let size = textureDimensions(demTexture);
                let x = u32(f32(size.x) * texcoord.x);
                let y = u32(f32(size.y) * (1-texcoord.y));
                let v = textureLoad(demTexture, vec2<u32>(x,y), 0).r;
                let nv = (v-vmin)/vmax;
                let color = vec4f(demColor(nv), 1.0);
                return color;
            } else {
                let hmin = hrange.x;
                let hmax = (hrange.y-hrange.x) * exaggeration + hrange.x;
                let r = (input.height - hmin) / hmax;
                let color = vec4f(demColor(r),1.0);
                return color;
            }
        }
    `,k=s.createShaderModule({label:n,code:w}),y=s.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:2,visibility:GPUShaderStage.VERTEX|GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]}),T=s.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.FRAGMENT,texture:{sampleType:"unfilterable-float",viewDimension:"2d",multisampled:!1}},{binding:2,visibility:GPUShaderStage.FRAGMENT,buffer:{type:"uniform"}}]}),P=s.createPipelineLayout({bindGroupLayouts:[y,T]}),E=s.createRenderPipeline({label:n,layout:P,vertex:{module:k,buffers:[{arrayStride:12,attributes:[{shaderLocation:0,offset:0,format:"float32x3"}]},{arrayStride:8,attributes:[{shaderLocation:1,offset:0,format:"float32x2"}]}]},fragment:{module:k,targets:[{format:e.context.getConfiguration().format}]},primitive:{topology:"triangle-list",cullMode:"none"},depthStencil:{depthWriteEnabled:!0,depthCompare:"less",format:"depth24plus"}}),I=s.createBuffer({label:`${n} positionBuffer`,size:a.positions.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST});s.queue.writeBuffer(I,0,a.positions.buffer);const A=s.createBuffer({label:`${n} texcoordBuffer`,size:a.texcoords.byteLength,usage:GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST});s.queue.writeBuffer(A,0,a.texcoords.buffer);const L=t.getBoundingBox(),K=[(L[0]+L[2])/2,(L[1]+L[3])/2],z=St(K[0],K[1],0,1),ne=St(K[0]+200,K[1]+800,1e3,1),he=St(0,0,1,1),R=new Ed(ne,z,he);new Id(R,e.canvas).enable();const pe=Ko(w),j=It(pe.uniforms.scene),Ee=It(pe.uniforms.hrange),xn=It(pe.uniforms.exaggeration),zt=It(pe.uniforms.hasTexture),_t=It(pe.uniforms.pixelRange),Xe=s.createBuffer({label:`${n} sceneUniform`,size:j.arrayBuffer.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),lt=s.createBuffer({label:`${n} hrangeUniform`,size:Ee.arrayBuffer.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});Ee.set([m,f]),s.queue.writeBuffer(lt,0,Ee.arrayBuffer);const yn=s.createBuffer({label:`${n} exaggerationUniform`,size:Ee.arrayBuffer.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),Rt=s.createBuffer({label:`${n} hasTextureUniform`,size:zt.arrayBuffer.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),Gt=s.createBuffer({label:`${n} pixelRangeUniform`,size:Ee.arrayBuffer.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),Yn=s.createBindGroup({label:n,layout:E.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:Xe}},{binding:1,resource:{buffer:lt}},{binding:2,resource:{buffer:yn}}]}),Xn=l;let Ze=s.createBindGroup({label:n,layout:E.getBindGroupLayout(1),entries:[{binding:0,resource:Rt},{binding:1,resource:Xn},{binding:2,resource:{buffer:Gt}}]}),Ie=s.createTexture({size:[e.canvas.width,e.canvas.height],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT});function kn(){const Se=R.getViewMatrix(),oe=il(Yt(),Math.PI/2,e.canvas.width/e.canvas.height,.1,1e4);j.set({camera:{eye:[R.from[0],R.from[1],R.from[2]],to:[R.to[0],R.to[1],R.to[2]],up:[R.up[0],R.up[1],R.up[2]],viewmtx:Se,relViewmtx:R.getRelViewMatrix()},projection:{projmtx:oe}}),s.queue.writeBuffer(Xe,0,j.arrayBuffer),xn.set(o.exaggeration),s.queue.writeBuffer(yn,0,xn.arrayBuffer),zt.set(o.derivative==="none"?0:1),s.queue.writeBuffer(Rt,0,zt.arrayBuffer),_t.set(h),s.queue.writeBuffer(Gt,0,_t.arrayBuffer),(Ie.height!==e.canvas.height||Ie.width!==e.canvas.width)&&(Ie.destroy(),Ie=s.createTexture({size:[e.canvas.width,e.canvas.height],format:"depth24plus",usage:GPUTextureUsage.RENDER_ATTACHMENT}));const jt=s.createCommandEncoder({label:n}),Ne=jt.beginRenderPass({label:n,colorAttachments:[{clearValue:[.3,.3,.3,1],loadOp:"clear",storeOp:"store",view:e.context.getCurrentTexture().createView()}],depthStencilAttachment:{view:Ie.createView(),depthClearValue:1,depthLoadOp:"clear",depthStoreOp:"store"}});Ne.setPipeline(E),Ne.setBindGroup(0,Yn),Ne.setBindGroup(1,Ze),Ne.setVertexBuffer(0,I),Ne.setVertexBuffer(1,A),Ne.draw(a.vertexCount),Ne.end();const Qn=jt.finish({label:n});s.queue.submit([Qn]),requestAnimationFrame(kn)}new ResizeObserver(Se=>{for(const oe of Se){const jt=oe.target,Ne=oe.contentBoxSize[0].inlineSize,Qn=oe.contentBoxSize[0].blockSize;jt.width=Math.max(1,Math.min(Ne,s.limits.maxTextureDimension2D)),jt.height=Math.max(1,Math.min(Qn,s.limits.maxTextureDimension2D))}}).observe(e.canvas);const ct=new Up({title:"",expanded:!0});ct.addBinding(o,"exaggeration",{min:0,max:10,step:.1,label:"exaggeration"}),ct.addBinding(o,"derivative",{options:{:"none",:"slope",:"aspect"}}).on("change",async Se=>{let oe=null;Se.value==="slope"?(u===null&&(u=await i.computeSlope(t)),oe=u,h=[0,Math.PI/2]):Se.value==="aspect"?(c===null&&(c=await i.computeAspect(t)),oe=c,h=[0,360]):oe=l,Ze=s.createBindGroup({label:n,layout:E.getBindGroupLayout(1),entries:[{binding:0,resource:Rt},{binding:1,resource:oe},{binding:2,resource:{buffer:Gt}}]})}),requestAnimationFrame(kn)}class Ld{gpuinfo;workGroupSizeX=8;workGroupSizeY=8;workGroupSizeZ=1;slopeComputeInfo;slopeTexture=null;aspectComputeInfo;aspectTexture=null;slopeKernel=`
    
        fn kernel(
            z1:f32,z2:f32,z3:f32,
            z4:f32,z5:f32,z6:f32,
            z7:f32,z8:f32,z9:f32
        ) -> f32 {
            let dx = ((z3 + 2 * z6 + z9) - (z1 + 2 * z4 + z7)) * demInfo.zfactor / (8 * demInfo.resolution.x);
            let dy = ((z7 + 2*z8 + z9) - (z1 + 2*z2 + z3)) * demInfo.zfactor  / (8 * demInfo.resolution.y);
            let s = atan(sqrt(pow(dx,2)+pow(dy,2)));
            return s;
        }

    `;aspectKernel=`
    
        fn kernel(
            z1:f32,z2:f32,z3:f32,
            z4:f32,z5:f32,z6:f32,
            z7:f32,z8:f32,z9:f32
        ) -> f32 {
            
            let fx = ((z3+2*z6+z9)-(z1+2*z4+z7)) / (8 * demInfo.resolution.x);
            let fy = ((z1+2*z2+z3)-(z7+2*z8+z9)) / (8 * demInfo.resolution.y);
            if(fx==0.0 && fy==0.0) {
                return 0.0;
            }
            let aspect_rad = atan2(fy, -fx);
            let aspect_deg = degrees(aspect_rad);
            var aspect = 90 - aspect_deg;
            if(aspect < 0.0) {
                aspect += 360;
            }
            return aspect;
        }

    `;constructor(e){this.gpuinfo=e;const t=e.device.limits;this.workGroupSizeX=Math.min(Math.sqrt(t.maxComputeInvocationsPerWorkgroup),t.maxComputeWorkgroupSizeX),this.workGroupSizeY=Math.min(Math.sqrt(t.maxComputeInvocationsPerWorkgroup),t.maxComputeWorkgroupSizeY),this.workGroupSizeZ=1,this.slopeComputeInfo=this.createCovolution3x3Pipeline(e,"slope compute",this.slopeKernel),this.aspectComputeInfo=this.createCovolution3x3Pipeline(e,"aspect compute",this.aspectKernel)}async computeSlope(e){if(this.slopeTexture===null){const t=await this.convolute3x3(this.gpuinfo,this.slopeComputeInfo,e);this.slopeTexture=t}return this.slopeTexture}async computeAspect(e){if(this.aspectTexture===null){const t=await this.convolute3x3(this.gpuinfo,this.aspectComputeInfo,e);this.aspectTexture=t}return this.aspectTexture}createCovolution3x3Pipeline(e,t,n){const{device:s}=e,i=`

            override workGroupSizeX : u32 = 8u;
            override workGroupSizeY : u32 = 8u;
            override workGroupSizeZ : u32 = 1u;
            struct DEMInfo {
                resolution : vec2f,
                zfactor : f32
            }
            @group(0) @binding(0) var dem : texture_2d<f32>;
            @group(0) @binding(1) var outTexture : texture_storage_2d<r32float, read_write>;
            @group(0) @binding(2) var<uniform> demInfo : DEMInfo;
            ${n}
            @compute @workgroup_size(workGroupSizeX, workGroupSizeY, workGroupSizeZ) fn cs(
                @builtin(workgroup_id) wid : vec3<u32>,
                @builtin(global_invocation_id) gid : vec3<u32>,
                @builtin(local_invocation_id) lid : vec3<u32>
            ) {
                let size = textureDimensions(dem);
                let w = size.x;
                let h = size.y;
                let x = gid.x;
                let y = gid.y;
                let coords = vec2<u32>(x,y);
                let cmin = vec2<u32>(0,0);
                let cmax = vec2<u32>(w-1,h-1);
                let c1 = clamp(vec2<u32>(x-1,y-1),cmin,cmax);
                let c2 = clamp(vec2<u32>(x-1,y),cmin,cmax);
                let c3 = clamp(vec2<u32>(x-1,y+1),cmin,cmax);
                let c4 = clamp(vec2<u32>(x,y-1),cmin,cmax);
                let c5 = clamp(vec2<u32>(x,y),cmin,cmax);
                let c6 = clamp(vec2<u32>(x,y+1),cmin,cmax);
                let c7 = clamp(vec2<u32>(x+1,y-1),cmin,cmax);
                let c8 = clamp(vec2<u32>(x+1,y),cmin,cmax);
                let c9 = clamp(vec2<u32>(x+1,y+1),cmin,cmax);
                let z1 = textureLoad(dem, c1, 0).r;
                let z2 = textureLoad(dem, c2, 0).r;
                let z3 = textureLoad(dem, c3, 0).r;
                let z4 = textureLoad(dem, c4, 0).r;
                let z5 = textureLoad(dem, c5, 0).r;
                let z6 = textureLoad(dem, c6, 0).r;
                let z7 = textureLoad(dem, c7, 0).r;
                let z8 = textureLoad(dem, c8, 0).r;
                let z9 = textureLoad(dem, c9, 0).r;
                let s = kernel(z1,z2,z3,z4,z5,z6,z7,z8,z9);
                textureStore(outTexture, coords, vec4f(s,0,0,0));
            }
    
        `,a=s.createShaderModule({label:t,code:i});return{pipeline:s.createComputePipeline({label:t,layout:"auto",compute:{module:a,constants:{workGroupSizeX:this.workGroupSizeX,workGroupSizeY:this.workGroupSizeY,workGroupSizeZ:this.workGroupSizeZ}}}),definations:Ko(i)}}async convolute3x3(e,t,n){const{device:s}=e,{pipeline:i,definations:a}=t,o="convolute3x3",l=await Td(s,n),u=n.getWidth(),c=n.getHeight(),h=Math.ceil(u/this.workGroupSizeX),m=Math.ceil(c/this.workGroupSizeY),f=s.createTexture({label:o,size:[u,c],format:"r32float",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.STORAGE_BINDING|GPUTextureUsage.COPY_DST}),w=n.getResolution().slice(0,2),k=1,y=It(a.uniforms.demInfo);y.set({resolution:w,zfactor:k});const T=s.createBuffer({label:o,size:y.arrayBuffer.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});s.queue.writeBuffer(T,0,y.arrayBuffer);const P=s.createBindGroup({label:o,layout:i.getBindGroupLayout(0),entries:[{binding:0,resource:l},{binding:1,resource:f},{binding:2,resource:{buffer:T}}]}),E=s.createCommandEncoder(),I=E.beginComputePass();I.setPipeline(i),I.setBindGroup(0,P),I.dispatchWorkgroups(h,m,1),I.end();const A=E.finish();return s.queue.submit([A]),l.destroy(),f}}async function Dd(r){const e=await fetch(r);if(!e.ok)throw new Error(`Failed to fetch image: ${e.status}`);const t=await e.blob();return await(await el(t)).getImage()}const Md=""+new URL("../data/dem/dem_bh29_2021.tif",import.meta.url).href;async function Od(){const r=await Pd();if(r===null){console.error("GPU INFO is NULL");return}const t=Sd({canvasId:"webgpu-canvas",config:{device:r.device,format:r.gpu.getPreferredCanvasFormat()}});if(t===null){console.error("canvasInfo is NULL");return}const n=await Dd(Md);Vd(r,t,n)}Od();export{Ud as L,Nd as a};
