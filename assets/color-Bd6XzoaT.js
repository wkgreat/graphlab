import{c as L,a as z,m as j}from"./webgpu-utils.module-DPkR54bZ.js";import{n as B,h as u,s as g,j as S,z as v,k as P,g as d,m as b,r as w,A as T,e as R,c as F}from"./camera-DXA52umf.js";function k(i){const t=i.device;let e=i.color1,s=i.color2;const r=Math.max(i.density-i.density%2,2);e.every(l=>l<=1)&&(e=e.map(l=>l*255),e[3]=255),s.every(l=>l<=1)&&(s=s.map(l=>l*255),s[3]=255);const n=r,a=r,o=[];for(let l=0;l<n;++l)for(let p=0;p<a;++p)(l+p)%2===0?o.push(...e):o.push(...s);const h=new Uint8Array(o),c=t.createTexture({format:"rgba8unorm",size:[n,a,1],usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_DST});t.queue.writeTexture({texture:c,mipLevel:0,origin:{x:0,y:0,z:0}},h,{offset:0,bytesPerRow:n*4},{width:n,height:a,depthOrArrayLayers:1});const f=t.createSampler({minFilter:"nearest",magFilter:"nearest",addressModeU:"repeat",addressModeV:"repeat"});return{texture:c,sampler:f}}class N{p0=d(0,0,0);p1=d(1,0,0);p2=d(0,1,0);constructor(t,e,s){this.p0=t,this.p1=e,this.p2=s}computeArea(){const t=g(u(),this.p1,this.p0),e=g(u(),this.p2,this.p0),s=S(u(),t,e);return w(s)/2}#t(t){return t===0?[this.p0,this.p1,this.p2]:t===1?[this.p1,this.p2,this.p0]:[this.p2,this.p0,this.p1]}computeRadians(t){const[e,s,r]=this.#t(t),n=u(),a=u();return g(n,s,e),B(n,n),g(a,r,e),B(a,a),Math.acos(v(n,a))}computeBarycentricCellArea(t){const[e,s,r]=this.#t(t),n=u(),a=u(),o=u();b(n,e,s),P(n,n,.5),b(a,e,r),P(a,a,.5),b(o,e,s),b(o,o,r),P(o,o,1/3);const h=new N(e,o,a),c=new N(e,n,o),f=h.computeArea(),l=c.computeArea();return f+l}computeVoronoiCellArea(t){return 0}computeMixedVoronoiCellArea(t){return 0}}class Z{origin;direct;constructor(t,e){this.origin=t,this.direct=B(u(),e)}crossTriangle(t){const s=g(u(),t.p1,t.p0),r=g(u(),t.p2,t.p0),n=S(u(),this.direct,r),a=v(s,n);if(Math.abs(a)<1e-6)return{cross:!1,point:null,distance:null,uvt:[0,0,0]};const o=1/a,h=g(u(),this.origin,t.p0),c=o*v(h,n);if(c<0)return{cross:!1,point:null,distance:null,uvt:[0,0,0]};const f=S(u(),h,s),l=o*v(this.direct,f);if(l<0||c+l>1)return{cross:!1,point:null,distance:null,uvt:[0,0,0]};const p=o*v(r,f),M=P(u(),t.p0,c),y=P(u(),t.p1,l),I=P(u(),t.p2,p),m=d(0,0,0);b(m,m,M),b(m,m,y),b(m,m,I);const A=g(u(),m,this.origin),U=w(A);return{cross:!0,point:m,distance:U,uvt:[c,l,p]}}distanceOfPoint(t){const e=this.origin;this.direct;const s=t,r=g(u(),s,e),n=w(r),a=v(B(u(),this.direct),B(u(),r));if(a<=0)return n;{const o=Math.sin(Math.acos(a));return n*o}}dwithinPoint(t,e){return this.distanceOfPoint(t)<=e}}class X{positions=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];normals=[0,0,1,0,0,1,0,0,1,0,0,1];texcoords=[0,0,1,0,1,1,0,1];indices=[0,1,2,0,2,3];definition=null;sceneUniform=null;vertexBuffer=null;indexBuffer=null;module=null;pipeline=null;texture=null;sampler=null;constructor(t=100,e=100){const s=t/2,r=e/2;for(let n=0;n<this.positions.length;++n)n%3===0?this.positions[n]*=s:n%3===1&&(this.positions[n]*=r)}refreshVertexBuffer(t){const e=L(t,{position:{data:new Float32Array(this.positions),numComponents:3},texcoord:{data:new Float32Array(this.texcoords),numComponents:2},normal:{data:new Float32Array(this.normals),numComponents:3}}),s=new Uint32Array(this.indices),r=t.createBuffer({size:s.byteLength,usage:GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST});t.queue.writeBuffer(r,0,s),this.vertexBuffer=e,this.indexBuffer=r}refreshTexture(t){if(!this.texture||!this.sampler){const e=k({device:t,color1:[.7,.7,.7,1],color2:[.3,.3,.3,1],density:15});this.texture&&this.texture.destroy(),this.texture=e.texture,this.sampler=e.sampler}}refreshUniforms(t,e,s){if(!this.definition){console.error("definition is null");return}const r=z(this.definition.uniforms.scene);r.set({viewmtx:e.viewMtx,projmtx:s.perspectiveMatrixZO}),this.sceneUniform||(this.sceneUniform=t.createBuffer({size:r.arrayBuffer.byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST})),t.queue.writeBuffer(this.sceneUniform,0,r.arrayBuffer)}initWebGPU(t,e){const s=t.device;this.refreshVertexBuffer(s);const r=`

        struct SceneUniform {
            viewmtx: mat4x4f,
            projmtx: mat4x4f
        }

        @group(0) @binding(0) var<uniform> scene: SceneUniform;

        @group(1) @binding(0) var theTexture: texture_2d<f32>;
        @group(1) @binding(1) var theSampler: sampler;
        
        struct VSInput {
            @location(0) position: vec3f,
            @location(1) texcoord: vec2f,
            @location(2) normal: vec3f
        }

        struct VSOutput {
            @builtin(position) position: vec4f,
            @location(0) texcoord: vec2f,
            @location(1) normal: vec3f
        }

        @vertex fn vs(input: VSInput) -> VSOutput {

            let worldpos = vec4f(input.position, 1.0);
            let ndcpos = scene.projmtx * scene.viewmtx * worldpos;
            var output: VSOutput;
            output.position = ndcpos;
            output.texcoord = input.texcoord;
            output.normal = input.normal;

            return output;

        }
        @fragment fn fs(input: VSOutput) -> @location(0) vec4f {

            var color = textureSample(theTexture, theSampler, input.texcoord);

            return color;
        }
        `;this.definition=j(r),this.module=s.createShaderModule({label:"Ground",code:r}),this.pipeline=s.createRenderPipeline({label:"Ground",layout:"auto",vertex:{module:this.module,buffers:this.vertexBuffer.bufferLayouts},fragment:{module:this.module,targets:[{format:e.context.getConfiguration().format}]},primitive:{topology:"triangle-list"},depthStencil:{format:"depth32float",depthWriteEnabled:!0,depthCompare:"less-equal"}})}draw(t,e,s,r){const n=t.device;this.refreshTexture(n),this.refreshUniforms(n,e,s);const a=n.createBindGroup({label:"Ground",layout:this.pipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:this.sceneUniform}}]}),o=n.createBindGroup({label:"Ground",layout:this.pipeline.getBindGroupLayout(1),entries:[{binding:0,resource:this.texture},{binding:1,resource:this.sampler}]});r.setPipeline(this.pipeline),r.setBindGroup(0,a),r.setBindGroup(1,o),r.setVertexBuffer(0,this.vertexBuffer.buffers[0]),r.setIndexBuffer(this.indexBuffer,"uint32"),r.drawIndexed(6)}}class Y{positions=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,-1,-1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,-1,-1,-1,1,1,-1,1,-1]);normals=new Float32Array([...Array(6).fill([0,0,1]).flat(),...Array(6).fill([0,0,-1]).flat(),...Array(6).fill([0,1,0]).flat(),...Array(6).fill([0,-1,0]).flat(),...Array(6).fill([1,0,0]).flat(),...Array(6).fill([-1,0,0]).flat()]);texcoords=new Float32Array([...Array(6).fill([0,1,1,1,1,0,0,1,1,0,0,0]).flat()]);colors=null;vertexCount=36;inputColors;colorMode;constructor(t){t.colors&&t.colors.length!==0?this.inputColors=t.colors:this.inputColors=[[1,1,1,1]],this.colorMode=t.colormode||"face",this.genCubeColors()}genCubeColors(){let t=0;this.colorMode==="vertex"?t=1:this.colorMode==="triangle"?t=3:this.colorMode==="face"&&(t=6);const e=[],s=this.inputColors.length;for(let r=0;r<this.vertexCount;++r){const n=Math.floor(r/t)%s,a=this.inputColors[n];e.push(a)}this.colors=new Float32Array(e.flat())}}class $ extends Y{positions=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,0,-1,1,0,1,1,0,-1,-1,0,1,1,0,1,-1,0,-1,1,0,-1,1,1,1,1,1,-1,1,0,1,1,1,1,1,0,-1,-1,0,1,-1,0,1,-1,1,-1,-1,0,1,-1,1,-1,-1,1,1,-1,0,1,1,0,1,1,1,1,-1,0,1,1,1,1,-1,1,-1,-1,0,-1,-1,1,-1,1,1,-1,-1,0,-1,1,1,-1,1,0]);normals=new Float32Array([...Array(6).fill([0,0,1]).flat(),...Array(6).fill([0,0,-1]).flat(),...Array(6).fill([0,1,0]).flat(),...Array(6).fill([0,-1,0]).flat(),...Array(6).fill([1,0,0]).flat(),...Array(6).fill([-1,0,0]).flat()]);texcoords=new Float32Array([...Array(6).fill([0,1,1,1,1,0,0,1,1,0,0,0]).flat()]);constructor(t){super(t)}}function G(i,t,e,s){return[i[0]+t,i[1]+e,i[2]+s]}function C(i,t,e){const s=i*Math.sin(e)*Math.cos(t),r=i*Math.sin(e)*Math.sin(t),n=i*Math.cos(e);return[s,r,n]}function _(i=1,t=10,e=10,s=[0,0,0]){const r=[],n=[],a=[],o=2*Math.PI/t,h=Math.PI/e;for(let c=0;c<t;++c)for(let f=0;f<e;++f){const l=-Math.PI+c*o,p=-Math.PI+(c+1)*o,M=-Math.PI/2+f*h,y=-Math.PI/2+(f+1)*h,I=G(C(i,l,Math.PI/2-M),s[0],s[1],s[2]),m=G(C(i,p,Math.PI/2-M),s[0],s[1],s[2]),A=G(C(i,p,Math.PI/2-y),s[0],s[1],s[2]),U=G(C(i,l,Math.PI/2-y),s[0],s[1],s[2]),O=T(u(),d(...I),d(...s)),V=T(u(),d(...m),d(...s)),D=T(u(),d(...A),d(...s)),E=T(u(),d(...U),d(...s));r.push(...I),n.push(...O),a.push((l+Math.PI)/(2*Math.PI),(M+Math.PI/2)/Math.PI),r.push(...A),n.push(...D),a.push((p+Math.PI)/(2*Math.PI),(y+Math.PI/2)/Math.PI),r.push(...U),n.push(...E),a.push((l+Math.PI)/(2*Math.PI),(y+Math.PI/2)/Math.PI),r.push(...I),n.push(...O),a.push((l+Math.PI)/(2*Math.PI),(M+Math.PI/2)/Math.PI),r.push(...m),n.push(...V),a.push((p+Math.PI)/(2*Math.PI),(M+Math.PI/2)/Math.PI),r.push(...A),n.push(...D),a.push((p+Math.PI)/(2*Math.PI),(y+Math.PI/2)/Math.PI)}return{hasIndices:!1,nvertices:r.length/3,verticeSize:3,vertices:new Float32Array(r),normals:new Float32Array(n),texcoords:new Float32Array(a)}}class K{#t=Math.PI/3;#e=1;#s=.1;#r=1e10;constructor(t,e,s,r){this.#t=t,this.#e=e,this.#s=s,this.#r=r}get perspectiveMatrix(){return R(F(),this.#t,this.#e,this.#s,this.#r)}get perspectiveMatrixZO(){return R(F(),this.#t,this.#e,this.#s,this.#r)}get fovy(){return this.#t}get fovx(){const t=this.#t/2,e=Math.tan(t);return 2*Math.atan(e*this.aspect)}get near(){return this.#s}get far(){return this.#r}set aspect(t){this.#e!==t&&(this.#e=t)}get aspect(){return this.#e}}function J(i){let t="clear";return i.first?t="clear":t="load",{label:i.label,colorAttachments:[{clearValue:i.clearColor,loadOp:t,storeOp:"store",view:i.colorTexture}],depthStencilAttachment:{view:i.depthTexture,depthClearValue:i.clearDepth,depthLoadOp:t,depthStoreOp:"store"}}}function Q(i,t,e,s="depth32float"){return i.device.createTexture({label:"depthTexture",size:[t,e],format:s,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_DST})}class tt{static white=[1,1,1,1];static black=[0,0,0,1];static red=[1,0,0,1];static green=[0,1,0,1];static blue=[0,0,1,1];static transparent=[0,0,0,0];static silver=[.9,.9,.9,1];static lightGray=[.75,.75,.75,1];static gray=[.5,.5,.5,1];static darkGray=[.25,.25,.25,1];static cyan=[0,1,1,1];static magenta=[1,0,1,1];static neonGreen=[.22,1,.08,1];static electricBlue=[0,.47,1,1];static hotPink=[1,.05,.6,1];static forestGreen=[.13,.55,.13,1];static seafoam=[.44,.9,.69,1];static sand=[.76,.7,.5,1];static deepSea=[0,.1,.2,1];static errorRed=[1,0,0,1];static warningYellow=[1,.9,0,1];static successGreen=[0,.8,0,1];static infoBlue=[.1,.6,1,1];static skyBlue=[.53,.81,.92,1];static orange=[1,.65,0,1];static lime=[.75,1,0,1];static purple=[.5,0,.5,1];static slate=[.27,.35,.39,1];static gold=[1,.84,0,1];static crimson=[.86,.08,.24,1];static random(){return[Math.random(),Math.random(),Math.random(),1]}static mix(t,e,s){return[(1-s)*t[0]+s*e[0],(1-s)*t[1]+s*e[1],(1-s)*t[2]+s*e[2],(1-s)*t[3]+s*e[3]]}}class x{r=0;g=0;b=0;a=0;constructor(t,e,s,r){this.r=t,this.g=e,this.b=s,this.a=r}clone(){return new x(this.r,this.g,this.b,this.a)}static of(t){if(t instanceof x)return t.clone();if(typeof t=="string"){const e=q(t);return e===null?null:new x(e[0]/255,e[1]/255,e[2]/255,e[3])}else{const e=t.length;let s=[];if(e>4)s=t.slice(0,4);else if(e<4){s=[...t];for(let n=e;n<=4;++n)s.push(0)}const r=s;return(r[0]>1||r[0]>1||r[0]>1)&&(r[0]/=255,r[1]/=255,r[2]/=255),r[0]<0&&(r[0]=0),r[1]<0&&(r[1]=0),r[2]<0&&(r[2]=0),r[3]<0&&(r[2]=0),r[3]>1&&(r[2]=1),new x(r[0],r[1],r[2],r[3])}}toHex(){return"#"+[this.r,this.g,this.b].map(e=>{const s=(e*255).toString(16);return s.length===1?"0"+s:s}).join("")}setAlpha(t){this.a=t}mix(t,e){return e=Math.max(e,0),e=Math.min(e,1),new x(this.r*(1-e)+t.r*e,this.g*(1-e)+t.g*e,this.b*(1-e)+t.b*e,this.a*(1-e)+t.a*e)}toArray(){return[this.r,this.g,this.b,this.a]}static random(){return new x(Math.random(),Math.random(),Math.random(),1)}static interpolate(t,e){const s=t.map(l=>x.of(l));if(s.length===0)return new x(0,0,0,0);if(s.length===1)return s[0];const n=Math.max(0,Math.min(1,e))*(s.length-1),a=Math.floor(n),o=Math.min(a+1,s.length-1),h=n-a,c=s[a],f=s[o];return new x(c.r+(f.r-c.r)*h,c.g+(f.g-c.g)*h,c.b+(f.b-c.b)*h,c.a+(f.a-c.a)*h)}}function q(i){if(!i||typeof i!="string")return null;const t=i.trim().toLowerCase(),e=t.match(/^#?([0-9a-f]{3,8})$/i);if(e){let r=e[1];(r.length===3||r.length===4)&&(r=Array.from(r).map(c=>c+c).join(""));const n=parseInt(r.substring(0,2),16),a=parseInt(r.substring(2,4),16),o=parseInt(r.substring(4,6),16);let h=1;if(r.length===8){const c=r.substring(6,8);h=parseInt(c,16)/255}return[n,a,o,h]}const s=t.match(/^(rgb|rgba)\s*\(([^)]+)\)$/);if(s){const n=s[2].split(/[,\s/]/).map(f=>f.trim()).filter(f=>f.length>0),a=parseInt(n[0],10),o=parseInt(n[1],10),h=parseInt(n[2],10);let c=1;return n.length>=4&&(c=parseFloat(n[3])),isNaN(a)||isNaN(o)||isNaN(h)||a<0||a>255||o<0||o>255||h<0||h>255?null:[a,o,h,Math.min(1,Math.max(0,c))]}return null}class et{static VIRIDIS=["#440154","#3b528b","#21908d","#5dc963","#fde725"];static MAGMA=["#000004","#3b0f70","#8c2981","#fe9f6d","#fcfdbf"];static INFERNO=["#000004","#420a68","#ae2891","#f1605d","#ffbd33"];static TRAFFIC=["#52c41a","#fadb14","#ff4d4f"];static COOLWARN=["#00d2ff","#92fe9d","#ff9a9e","#f1c40f","#e74c3c"];static CYBERPUNK=["#00f2fe","#4facfe","#7367f0","#ce9ffc"];static OCEAN=["#2193b0","#6dd5ed"];static SUNSET=["#ff5f6d","#ffc371"];static RD_BU=["#d73027","#f46d43","#fdae61","#ffffff","#abd9e9","#74add1","#4575b4"]}export{tt as C,X as G,$ as N,K as P,Z as R,N as T,J as a,_ as b,Q as c,x as d,et as e};
